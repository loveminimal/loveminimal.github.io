<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Python 那些事儿 - https://aituyaa.com/python-%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">
    <meta name="author" content="Jack - https://aituyaa.com/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Python 那些事儿</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://aituyaa.com/style.min.7a1211384e00d894dc501a9708ae5fb349825c010d5348b62a8727d135f41615.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        
        <div class="cool-before" style="background: url('/imgs/bg/color.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">Python 那些事儿</h1>
    
        
        
            <div id="toc">📜</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    <div class="rel">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <div class="curtag-desc">
            <a href="https://aituyaa.com/tags/ols/"><img src="/imgs/icons/tag.svg" width="16" /> 相关文章：OLs <sup>13</sup></a>
        </div>

        <div class="curtag-post">
            
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/css-%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%95%88/">CSS 中的动效</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/emacs-lisp/">Emacs Lisp</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/git/">Git</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/git-%E6%8F%90%E4%BA%A4%E6%B6%88%E6%81%AF%E7%BA%A6%E5%AE%9A/">Git 提交消息约定</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/json-web-tokens/">Json Web Tokens</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/lua-%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">Lua 那些事儿</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/poetry-%E7%9A%84%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E/">Poetry 的简要说明</a>
                </div>
                
                
            
            
                <div class="curtag-post-item curtag-post-item--active">
                    <a href="https://aituyaa.com/python-%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">Python 那些事儿</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/shell-%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">Shell 那些事儿</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/sql/">SQL</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/">字符集和字符编码</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E8%BF%9B%E5%88%B6%E5%8F%8A%E8%BD%AC%E6%8D%A2/">进制及转换</a>
                </div>
                
                
        </div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2024-12-15&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2025-03-18&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            12731 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            26 分钟</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/ols">OLs</a>
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#基础">基础</a>
      <ul>
        <li><a href="#数据类型">数据类型</a></li>
        <li><a href="#字符串">字符串</a></li>
        <li><a href="#列表和元组">列表和元组</a></li>
        <li><a href="#分支和循环">分支和循环</a></li>
        <li><a href="#字典和集合">字典和集合</a></li>
        <li><a href="#切片迭代生成器">切片、迭代、生成器</a></li>
        <li><a href="#函数">函数</a></li>
        <li><a href="#函数式编程">函数式编程</a>
          <ul>
            <li><a href="#高阶函数">高阶函数</a></li>
            <li><a href="#返回函数">返回函数</a></li>
            <li><a href="#匿名函数">匿名函数</a></li>
            <li><a href="#装饰器">装饰器</a></li>
            <li><a href="#偏函数">偏函数</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#模块">模块</a></li>
    <li><a href="#常用内建模块">常用内建模块</a>
      <ul>
        <li><a href="#venv">venv</a></li>
      </ul>
    </li>
    <li><a href="#附录">附录</a>
      <ul>
        <li><a href="#python-项目组织结构">python 项目组织结构</a></li>
        <li><a href="#python-中获取时间和格式化">python 中获取时间和格式化</a></li>
        <li><a href="#pyenv-版本管理">pyenv 版本管理</a></li>
        <li><a href="#venvpyenv-和-poetry-中虚拟环境的区别和联系">venv、pyenv 和 poetry 中虚拟环境的区别和联系</a></li>
        <li><a href="#pypi-换源">PyPI 换源</a></li>
        <li><a href="#切片">切片</a></li>
        <li><a href="#斐波那契数列">斐波那契数列</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <p>![[assets/Pasted image 20241215124829.png]]</p>
<p>官方文档请参阅 📖 <a href="https://docs.python.org/zh-cn/3/tutorial/index.html">Python 教程 — Python 3.13.1 文档</a>。</p>
<p>本语言的命名源自 BBC 的 “Monty Python 飞行马戏团”，与爬行动物无关（Python 原义为“蟒蛇”）。</p>
<h2 id="基础">基础</h2>
<p>计算机编程语言和我们日常使用的自然语言有所不同，最大的区别就是，自然语言在不同的语境下有不同的理解，而计算机要根据编程语言执行任务，就必须保证编程语言写出的程序决不能有歧义。所以，任何一种编程语言都有自己的一套语法，编译器或者解释器就是负责把符合语法的程序代码转换成 CPU 能够执行的机器码，然后执行。</p>
<h3 id="数据类型">数据类型</h3>
<p><code>&gt; Python 中常用的数据类型</code></p>
<table>
<thead>
<tr>
<th><strong>类别</strong></th>
<th><strong>数据类型</strong></th>
<th><strong>描述</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>基本数据类型</strong></td>
<td><code>int</code></td>
<td>整数类型，表示整数值</td>
<td><code>42</code>, <code>-10</code></td>
</tr>
<tr>
<td></td>
<td><code>float</code></td>
<td>浮点数类型，表示带小数点的数值</td>
<td><code>3.14</code>, <code>-0.001</code></td>
</tr>
<tr>
<td></td>
<td><code>bool</code></td>
<td>布尔类型，表示真或假</td>
<td><code>True</code>, <code>False</code></td>
</tr>
<tr>
<td></td>
<td><code>str</code></td>
<td>字符串类型，表示文本数据</td>
<td><code>&quot;hello&quot;</code>, <code>'Python'</code></td>
</tr>
<tr>
<td><strong>复合数据类型</strong></td>
<td><code>list</code></td>
<td>列表类型，有序且可变的集合</td>
<td><code>[1, 2, 3]</code>, <code>['a', 'b', 'c']</code></td>
</tr>
<tr>
<td></td>
<td><code>tuple</code></td>
<td>元组类型，有序且不可变的集合</td>
<td><code>(1, 2, 3)</code>, <code>('a', 'b', 'c')</code></td>
</tr>
<tr>
<td></td>
<td><code>set</code></td>
<td>集合类型，无序且不重复的集合</td>
<td><code>{1, 2, 3}</code>, <code>{'a', 'b', 'c'}</code></td>
</tr>
<tr>
<td></td>
<td><code>dict</code></td>
<td>字典类型，键值对的集合</td>
<td><code>{'name': 'Alice', 'age': 25}</code></td>
</tr>
<tr>
<td><strong>特殊数据类型</strong></td>
<td><code>NoneType</code></td>
<td>空值类型，表示没有值</td>
<td><code>None</code></td>
</tr>
<tr>
<td></td>
<td><code>bytes</code></td>
<td>字节类型，表示二进制数据</td>
<td><code>b'hello'</code></td>
</tr>
<tr>
<td></td>
<td><code>bytearray</code></td>
<td>字节数组类型，可变的二进制数据</td>
<td><code>bytearray(b'hello')</code></td>
</tr>
<tr>
<td></td>
<td><code>range</code></td>
<td>范围类型，表示一个不可变的数字序列</td>
<td><code>range(0, 10)</code></td>
</tr>
<tr>
<td><strong>自定义数据类型</strong></td>
<td><code>class</code></td>
<td>类类型，用户自定义的数据结构</td>
<td><code>class MyClass: pass</code></td>
</tr>
<tr>
<td></td>
<td><code>object</code></td>
<td>对象类型，类的实例</td>
<td><code>obj = MyClass()</code></td>
</tr>
<tr>
<td><strong>其他数据类型</strong></td>
<td><code>complex</code></td>
<td>复数类型，表示复数</td>
<td><code>1 + 2j</code></td>
</tr>
<tr>
<td></td>
<td><code>enum.Enum</code></td>
<td>枚举类型，表示一组命名的常量</td>
<td><code>class Color(Enum): RED = 1</code></td>
</tr>
<tr>
<td></td>
<td><code>function</code></td>
<td>函数类型，表示可调用的代码块</td>
<td><code>def my_function(): pass</code></td>
</tr>
</tbody>
</table>
<p>你可能不知道的：</p>
<p>¹ Python允许在数字中间以 <code>_</code> 分隔，因此，写成 <code>10_000_000_000</code> 和 <code>10000000000</code> 是完全一样的。</p>
<p>² Python还允许用 <code>r''</code> 表示 <code>''</code> 内部的字符串默认不转义。</p>
<p>³ Python允许用 <code>'''...'''</code> 的格式表示多行内容。同样，它前面也可以加上 <code>r</code> 和 <code>f</code> 执行非转义和便捷格式化。</p>
<h3 id="字符串">字符串</h3>
<p>关于字符编码，可以阅读另一篇文章「 [[字符集和字符编码]] 」。</p>
<p>在最新的 Python 3 版本中，字符串是以 Unicode 编码的。对于单个字符的编码，Python 提供了 <code>ord()</code> 函数获取字符的整数表示，<code>chr()</code> 函数把编码转换为对应的字符。</p>
<p>由于 Python 的字符串类型是 <code>str</code>，在内存中以Unicode表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把 <code>str</code> 变为以字节为单位的 <code>bytes</code>。</p>
<p>Python 对 <code>bytes</code> 类型的数据用带 <code>b</code> 前缀的单引号或双引号表示，如 <code>b'ABC'</code> 。</p>
<p>以 Unicode 表示的 <code>str</code> 通过 <code>encode()</code> 方法可以编码为指定的 <code>bytes</code>。</p>
<p>反过来，如果我们从网络或磁盘上读取了字节流，那么读到的数据就是 <code>bytes</code>。要把 <code>bytes</code> 变为 <code>str</code>，就需要用 <code>decode()</code> 方法。</p>
<pre tabindex="0"><code>&gt;&gt;&gt; &#39;中文&#39;.encode(&#39;utf-8&#39;)
b&#39;\xe4\xb8\xad\xe6\x96\x87&#39;

&gt;&gt;&gt; b&#39;\xe4\xb8\xad\xe6\x96\x87&#39;.decode(&#39;utf-8&#39;)
&#39;中文&#39;
</code></pre><p><code>len()</code> 函数计算的是 <code>str</code> 的字符数，如果换成 <code>bytes</code>，<code>len()</code> 函数就计算字节数。</p>
<p>🔔 在操作字符串时，我们经常遇到 <code>str</code> 和 <code>bytes</code> 的互相转换。为了避免乱码问题，应当始终坚持使用 UTF-8 编码对 <code>str</code> 和 <code>bytes</code> 进行转换。</p>
<p>UTF-8 编码把一个 Unicode 字符根据不同的数字大小编码成 1-6 个字节，常用的英文字母被编码成 1 个字节，汉字通常是 3 个字节，只有很生僻的字符才会被编码成 4-6 个字节。</p>
<p><strong>如何输出格式化的字符串？</strong> 和 C 语言是一致的，用 <code>%</code> 实现。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%2d</span><span style="color:#d14">-</span><span style="color:#d14">%02d</span><span style="color:#d14">&#39;</span> <span style="color:#000;font-weight:bold">%</span> (<span style="color:#099">3</span>, <span style="color:#099">1</span>)) <span style="color:#998;font-style:italic"># 3-01  </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>还有？</p>
<p>使用字符串的 <code>format()</code> 方法，它会用传入的参数依次替换字符串内的占位符 <code>{0}</code>、<code>{1}</code> ……</p>
<pre tabindex="0"><code>&gt;&gt;&gt; &#39;Hello, {0}, 成绩提升了 {1:.1f}%&#39;.format(&#39;小明&#39;, 17.125)
&#39;Hello, 小明, 成绩提升了 17.1%&#39;
</code></pre><p>🌟 使用以 <code>f</code> 开头的字符串，称之为 <code>f-string</code>，它和普通字符串不同之处在于，字符串如果包含 <code>{xxx}</code>，就会以对应的变量替换。</p>
<pre tabindex="0"><code>&gt;&gt;&gt; r = 2.5
&gt;&gt;&gt; s = 3.14 * r ** 2
&gt;&gt;&gt; print(f&#39;The area of a circle with radius {r} is {s:.2f}&#39;)
The area of a circle with radius 2.5 is 19.62
</code></pre><blockquote>
<p>:: 最后一种最 shuhu 👻</p>
</blockquote>
<p><code>str</code> 不能直接和整数比较，必须先把 <code>str</code> 转换成整数。Python提供了 <code>int()</code> 函数来完成这件事情，如果 <code>int()</code> 函数发现一个字符串并不是合法的数字时就会报错，程序就会退出。</p>
<blockquote>
<p>:: 不像 JavaScript 那样在比较的时候可以自动转型。</p>
</blockquote>
<p><code>&gt; str 方法一览</code></p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>描述</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>capitalize()</code></td>
<td>将字符串的第一个字符大写</td>
<td><code>&quot;hello&quot;.capitalize()</code> → <code>&quot;Hello&quot;</code></td>
</tr>
<tr>
<td><code>casefold()</code></td>
<td>将字符串转换为小写，支持更多语言（如德语）</td>
<td><code>&quot;HELLO&quot;.casefold()</code> → <code>&quot;hello&quot;</code></td>
</tr>
<tr>
<td><code>center(width[, fillchar])</code></td>
<td>返回居中后的字符串，<code>width</code> 为总宽度，<code>fillchar</code> 为填充字符（默认为空格）</td>
<td><code>&quot;hi&quot;.center(5, '-')</code> → <code>&quot;--hi--&quot;</code></td>
</tr>
<tr>
<td><code>count(sub[, start[, end]])</code></td>
<td>⭐️返回子字符串 <code>sub</code> 在字符串中出现的次数，可选参数 <code>start</code> 和 <code>end</code> 指定范围</td>
<td><code>&quot;hello&quot;.count('l')</code> → <code>2</code></td>
</tr>
<tr>
<td><code>encode(encoding='utf-8', errors='strict')</code></td>
<td>将字符串编码为字节对象</td>
<td><code>&quot;hello&quot;.encode()</code> → <code>b'hello'</code></td>
</tr>
<tr>
<td><code>endswith(suffix[, start[, end]])</code></td>
<td>检查字符串是否以 <code>suffix</code> 结尾，可选参数 <code>start</code> 和 <code>end</code> 指定范围</td>
<td><code>&quot;hello&quot;.endswith('o')</code> → <code>True</code></td>
</tr>
<tr>
<td><code>expandtabs(tabsize=8)</code></td>
<td>将字符串中的制表符（<code>\t</code>）替换为空格，<code>tabsize</code> 指定空格数</td>
<td><code>&quot;hello\tworld&quot;.expandtabs(4)</code> → <code>&quot;hello world&quot;</code></td>
</tr>
<tr>
<td><code>find(sub[, start[, end]])</code></td>
<td>⭐️返回子字符串 <code>sub</code> 第一次出现的索引，未找到返回 <code>-1</code></td>
<td><code>&quot;hello&quot;.find('l')</code> → <code>2</code></td>
</tr>
<tr>
<td><code>format(*args, **kwargs)</code></td>
<td>格式化字符串，替换 <code>{}</code> 中的内容</td>
<td><code>&quot;{} {}&quot;.format(&quot;Hello&quot;, &quot;World&quot;)</code> → <code>&quot;Hello World&quot;</code></td>
</tr>
<tr>
<td><code>index(sub[, start[, end]])</code></td>
<td>⭐️返回子字符串 <code>sub</code> 第一次出现的索引，未找到抛出 <code>ValueError</code></td>
<td><code>&quot;hello&quot;.index('l')</code> → <code>2</code></td>
</tr>
<tr>
<td><code>isalnum()</code></td>
<td>检查字符串是否只包含字母和数字</td>
<td><code>&quot;hello123&quot;.isalnum()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isalpha()</code></td>
<td>检查字符串是否只包含字母</td>
<td><code>&quot;hello&quot;.isalpha()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isascii()</code></td>
<td>检查字符串是否只包含 ASCII 字符</td>
<td><code>&quot;hello&quot;.isascii()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isdecimal()</code></td>
<td>检查字符串是否只包含十进制数字</td>
<td><code>&quot;123&quot;.isdecimal()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isdigit()</code></td>
<td>检查字符串是否只包含数字</td>
<td><code>&quot;123&quot;.isdigit()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isidentifier()</code></td>
<td>检查字符串是否是有效的 Python 标识符</td>
<td><code>&quot;hello&quot;.isidentifier()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>islower()</code></td>
<td>检查字符串是否全部为小写</td>
<td><code>&quot;hello&quot;.islower()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isnumeric()</code></td>
<td>检查字符串是否只包含数字字符</td>
<td><code>&quot;123&quot;.isnumeric()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isprintable()</code></td>
<td>检查字符串是否全部为可打印字符</td>
<td><code>&quot;hello&quot;.isprintable()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isspace()</code></td>
<td>检查字符串是否只包含空白字符</td>
<td><code>&quot; &quot;.isspace()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>istitle()</code></td>
<td>检查字符串是否每个单词首字母大写</td>
<td><code>&quot;Hello World&quot;.istitle()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>isupper()</code></td>
<td>检查字符串是否全部为大写</td>
<td><code>&quot;HELLO&quot;.isupper()</code> → <code>True</code></td>
</tr>
<tr>
<td><code>join(iterable)</code></td>
<td>⭐️将可迭代对象中的元素用字符串连接</td>
<td><code>&quot;,&quot;.join([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;])</code> → <code>&quot;a,b,c&quot;</code></td>
</tr>
<tr>
<td><code>ljust(width[, fillchar])</code></td>
<td>返回左对齐后的字符串，<code>width</code> 为总宽度，<code>fillchar</code> 为填充字符</td>
<td><code>&quot;hi&quot;.ljust(5, '-')</code> → <code>&quot;hi---&quot;</code></td>
</tr>
<tr>
<td><code>lower()</code></td>
<td>将字符串转换为小写</td>
<td><code>&quot;HELLO&quot;.lower()</code> → <code>&quot;hello&quot;</code></td>
</tr>
<tr>
<td><code>lstrip([chars])</code></td>
<td>⭐️去除字符串左侧的空白字符或指定字符</td>
<td><code>&quot; hello&quot;.lstrip()</code> → <code>&quot;hello&quot;</code></td>
</tr>
<tr>
<td><code>partition(sep)</code></td>
<td>⭐️将字符串按 <code>sep</code> 分割为三部分（分隔符前、分隔符、分隔符后）</td>
<td><code>&quot;hello world&quot;.partition(' ')</code> → <code>('hello', ' ', 'world')</code></td>
</tr>
<tr>
<td><code>replace(old, new[, count])</code></td>
<td>将字符串中的 <code>old</code> 替换为 <code>new</code>，可选参数 <code>count</code> 指定替换次数</td>
<td><code>&quot;hello&quot;.replace('l', 'L')</code> → <code>&quot;heLLo&quot;</code></td>
</tr>
<tr>
<td><code>rfind(sub[, start[, end]])</code></td>
<td>⭐️返回子字符串 <code>sub</code> 最后一次出现的索引，未找到返回 <code>-1</code></td>
<td><code>&quot;hello&quot;.rfind('l')</code> → <code>3</code></td>
</tr>
<tr>
<td><code>rindex(sub[, start[, end]])</code></td>
<td>⭐️返回子字符串 <code>sub</code> 最后一次出现的索引，未找到抛出 <code>ValueError</code></td>
<td><code>&quot;hello&quot;.rindex('l')</code> → <code>3</code></td>
</tr>
<tr>
<td><code>rjust(width[, fillchar])</code></td>
<td>返回右对齐后的字符串，<code>width</code> 为总宽度，<code>fillchar</code> 为填充字符</td>
<td><code>&quot;hi&quot;.rjust(5, '-')</code> → <code>&quot;---hi&quot;</code></td>
</tr>
<tr>
<td><code>rpartition(sep)</code></td>
<td>将字符串按 <code>sep</code> 从右分割为三部分</td>
<td><code>&quot;hello world&quot;.rpartition(' ')</code> → <code>('hello', ' ', 'world')</code></td>
</tr>
<tr>
<td><code>rsplit(sep=None, maxsplit=-1)</code></td>
<td>从右开始分割字符串，<code>sep</code> 为分隔符，<code>maxsplit</code> 为最大分割次数</td>
<td><code>&quot;a,b,c&quot;.rsplit(',')</code> → <code>['a', 'b', 'c']</code></td>
</tr>
<tr>
<td><code>rstrip([chars])</code></td>
<td>⭐️去除字符串右侧的空白字符或指定字符</td>
<td><code>&quot;hello &quot;.rstrip()</code> → <code>&quot;hello&quot;</code></td>
</tr>
<tr>
<td><code>split(sep=None, maxsplit=-1)</code></td>
<td>分割字符串，<code>sep</code> 为分隔符，<code>maxsplit</code> 为最大分割次数</td>
<td><code>&quot;a,b,c&quot;.split(',')</code> → <code>['a', 'b', 'c']</code></td>
</tr>
<tr>
<td><code>splitlines([keepends])</code></td>
<td>⭐️按行分割字符串，<code>keepends</code> 指定是否保留换行符</td>
<td><code>&quot;hello\nworld&quot;.splitlines()</code> → <code>['hello', 'world']</code></td>
</tr>
<tr>
<td><code>startswith(prefix[, start[, end]])</code></td>
<td>⭐️检查字符串是否以 <code>prefix</code> 开头，可选参数 <code>start</code> 和 <code>end</code> 指定范围</td>
<td><code>&quot;hello&quot;.startswith('he')</code> → <code>True</code></td>
</tr>
<tr>
<td><code>strip([chars])</code></td>
<td>⭐️去除字符串两侧的空白字符或指定字符</td>
<td><code>&quot; hello &quot;.strip()</code> → <code>&quot;hello&quot;</code></td>
</tr>
<tr>
<td><code>swapcase()</code></td>
<td>将字符串中的大小写互换</td>
<td><code>&quot;Hello&quot;.swapcase()</code> → <code>&quot;hELLO&quot;</code></td>
</tr>
<tr>
<td><code>title()</code></td>
<td>将字符串中每个单词的首字母大写</td>
<td><code>&quot;hello world&quot;.title()</code> → <code>&quot;Hello World&quot;</code></td>
</tr>
<tr>
<td><code>translate(table)</code></td>
<td>根据映射表 <code>table</code> 转换字符串中的字符</td>
<td><code>&quot;hello&quot;.translate(str.maketrans('el', 'EL'))</code> → <code>&quot;hELLo&quot;</code></td>
</tr>
<tr>
<td><code>upper()</code></td>
<td>将字符串转换为大写</td>
<td><code>&quot;hello&quot;.upper()</code> → <code>&quot;HELLO&quot;</code></td>
</tr>
<tr>
<td><code>zfill(width)</code></td>
<td>在字符串左侧填充 <code>0</code>，直到字符串长度为 <code>width</code></td>
<td><code>&quot;42&quot;.zfill(5)</code> → <code>&quot;00042&quot;</code></td>
</tr>
</tbody>
</table>
<h3 id="列表和元组">列表和元组</h3>
<p>list 是一种有序的集合，可以随时添加和删除其中的元素。另一种有序列表叫元组：tuple。tuple 和 list 非常类似，但是 tuple 一旦初始化就不能修改。</p>
<p>🪧 也就是说，tuple 是个只读状态，什么 <code>append</code> 啦，<code>pop</code> 啦肯定都是不能用的了。只有 1 个元素的 tuple 定义时必须加一个逗号 <code>,</code> ，如 <code>t = (1,)</code> 。</p>
<p><code>&gt; 列表 list 方法一览</code></p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>描述</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>append(x)</code></td>
<td>在列表末尾添加元素 <code>x</code></td>
<td><code>lst = [1, 2]; lst.append(3)</code> → <code>[1, 2, 3]</code></td>
</tr>
<tr>
<td><code>extend(iterable)</code></td>
<td>将可迭代对象 <code>iterable</code> 中的所有元素添加到列表末尾</td>
<td><code>lst = [1, 2]; lst.extend([3, 4])</code> → <code>[1, 2, 3, 4]</code></td>
</tr>
<tr>
<td><code>insert(i, x)</code></td>
<td>在索引 <code>i</code> 处插入元素 <code>x</code></td>
<td><code>lst = [1, 2]; lst.insert(1, 1.5)</code> → <code>[1, 1.5, 2]</code></td>
</tr>
<tr>
<td><code>remove(x)</code></td>
<td>删除列表中第一个值为 <code>x</code> 的元素，如果不存在则抛出 <code>ValueError</code></td>
<td><code>lst = [1, 2, 2]; lst.remove(2)</code> → <code>[1, 2]</code></td>
</tr>
<tr>
<td><code>pop([i])</code></td>
<td>删除并返回索引 <code>i</code> 处的元素，如果未指定 <code>i</code>，则删除并返回最后一个元素</td>
<td><code>lst = [1, 2, 3]; lst.pop()</code> → <code>3</code>，<code>lst</code> → <code>[1, 2]</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>清空列表中的所有元素</td>
<td><code>lst = [1, 2]; lst.clear()</code> → <code>[]</code></td>
</tr>
<tr>
<td><code>index(x[, start[, end]])</code></td>
<td>⭐️ 返回第一个值为 <code>x</code> 的元素的索引，可选参数 <code>start</code> 和 <code>end</code> 指定搜索范围</td>
<td><code>lst = [1, 2, 3, 2]; lst.index(2)</code> → <code>1</code></td>
</tr>
<tr>
<td><code>count(x)</code></td>
<td>返回值为 <code>x</code> 的元素在列表中出现的次数</td>
<td><code>lst = [1, 2, 2, 3]; lst.count(2)</code> → <code>2</code></td>
</tr>
<tr>
<td><code>sort(key=None, reverse=False)</code></td>
<td>对列表进行排序，<code>key</code> 指定排序规则，<code>reverse</code> 控制是否降序</td>
<td><code>lst = [3, 1, 2]; lst.sort()</code> → <code>[1, 2, 3]</code></td>
</tr>
<tr>
<td><code>reverse()</code></td>
<td>反转列表中的元素顺序</td>
<td><code>lst = [1, 2, 3]; lst.reverse()</code> → <code>[3, 2, 1]</code></td>
</tr>
<tr>
<td><code>copy()</code></td>
<td>返回列表的浅拷贝</td>
<td><code>lst = [1, 2]; lst_copy = lst.copy()</code> → <code>lst_copy</code> 是 <code>[1, 2]</code> 的副本</td>
</tr>
</tbody>
</table>
<h3 id="分支和循环">分支和循环</h3>
<p>Python 的循环有两种，一种是 for&hellip;in 循环，依次把 list 或 tuple 中的每个元素迭代出来；第二种循环是 while 循环，只要条件满足，就不断循环，条件不满足时退出循环。</p>
<p>在循环中，<code>break</code> 语句可以提前退出循环。也可以通过 <code>continue</code> 语句，跳过当前的这次循环，直接开始下一次循环。</p>
<h3 id="字典和集合">字典和集合</h3>
<p>Python 内置了字典：dict 的支持，dict 全称 dictionary，在其他语言中也称为 map，使用键-值（key-value）存储，具有极快的查找速度。</p>
<p>正确使用 dict 非常重要，需要牢记的第一条就是 dict 的 key 必须是<strong>不可变对象</strong>。</p>
<pre tabindex="0"><code class="language-__❓思考一下为什么key必须是不可变的呢？" data-lang="__❓思考一下为什么key必须是不可变的呢？">这是因为dict根据key来计算value的存储位置，如果每次计算相同的key得出的结果不同，那dict内部就完全混乱了。

这个通过key计算位置的算法称为哈希算法（Hash）。

要保证hash的正确性，作为key的对象就不能变。在Python中，字符串、整数等都是不可变的，因此，可以放心地作为key。而list是可变的，就不能作为key。
</code></pre><p>set 和 dict 类似，也是一组 key 的集合，但不存储 value。由于 key 不能重复，所以，在 set 中，没有重复的 key。</p>
<p><code>&gt; 字典 dict 的常用方法</code></p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>描述</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>clear()</code></td>
<td>清空字典中的所有键值对</td>
<td><code>d = {'a': 1}; d.clear()</code> → <code>{}</code></td>
</tr>
<tr>
<td><code>copy()</code></td>
<td>返回字典的浅拷贝</td>
<td><code>d = {'a': 1}; d_copy = d.copy()</code> → <code>d_copy</code> 是 <code>{'a': 1}</code> 的副本</td>
</tr>
<tr>
<td><code>fromkeys(seq[, value])</code></td>
<td>创建一个新字典，<code>seq</code> 为键，<code>value</code> 为值（默认为 <code>None</code>）</td>
<td><code>dict.fromkeys(['a', 'b'], 1)</code> → <code>{'a': 1, 'b': 1}</code></td>
</tr>
<tr>
<td><code>get(key[, default])</code></td>
<td>返回键 <code>key</code> 对应的值，如果键不存在则返回 <code>default</code>（⭐️ 默认为 <code>None</code>）</td>
<td><code>d = {'a': 1}; d.get('a')</code> → <code>1</code>，<code>d.get('b', 0)</code> → <code>0</code></td>
</tr>
<tr>
<td><code>items()</code></td>
<td>返回字典中所有键值对的视图（<code>(key, value)</code> 对）</td>
<td><code>d = {'a': 1}; d.items()</code> → <code>dict_items([('a', 1)])</code></td>
</tr>
<tr>
<td><code>keys()</code></td>
<td>返回字典中所有键的视图</td>
<td><code>d = {'a': 1}; d.keys()</code> → <code>dict_keys(['a'])</code></td>
</tr>
<tr>
<td><code>values()</code></td>
<td>返回字典中所有值的视图</td>
<td><code>d = {'a': 1}; d.values()</code> → <code>dict_values([1])</code></td>
</tr>
<tr>
<td><code>pop(key[, default])</code></td>
<td>删除并返回键 <code>key</code> 对应的值，如果键不存在且未提供 <code>default</code> 则抛出 <code>KeyError</code></td>
<td><code>d = {'a': 1}; d.pop('a')</code> → <code>1</code>，<code>d.pop('b', 0)</code> → <code>0</code></td>
</tr>
<tr>
<td><code>popitem()</code></td>
<td>删除并返回字典中的最后一对键值对，如果字典为空则抛出 <code>KeyError</code></td>
<td><code>d = {'a': 1}; d.popitem()</code> → <code>('a', 1)</code></td>
</tr>
<tr>
<td><code>setdefault(key[, default])</code></td>
<td>如果键 <code>key</code> 存在则返回其值，否则插入 <code>key</code> 并设置值为 <code>default</code>（默认为 <code>None</code>）</td>
<td><code>d = {'a': 1}; d.setdefault('b', 2)</code> → <code>2</code>，<code>d</code> → <code>{'a': 1, 'b': 2}</code></td>
</tr>
<tr>
<td><code>update([other])</code></td>
<td>将字典 <code>other</code> 中的键值对更新到当前字典中</td>
<td><code>d = {'a': 1}; d.update({'b': 2})</code> → <code>{'a': 1, 'b': 2}</code></td>
</tr>
<tr>
<td><code>__contains__(key)</code></td>
<td>⭐️检查字典中是否包含键 <code>key</code>（通常用 <code>in</code> 操作符）</td>
<td><code>d = {'a': 1}; 'a' in d</code> → <code>True</code></td>
</tr>
</tbody>
</table>
<h3 id="切片迭代生成器">切片、迭代、生成器</h3>
<blockquote>
<p>在 Python 中，代码不是越多越好，而是越少越好。代码不是越复杂越好，而是越简单越好。</p>
</blockquote>
<p>❶ 切片</p>
<p>取一个 str、list 或 tuple 的部分元素是非常常见的操作。对这种经常取指定索引范围的操作，用循环十分繁琐，因此，Python 提供了切片（Slice）操作符。</p>
<table>
<thead>
<tr>
<th><strong>操作</strong></th>
<th><strong>描述</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sequence[start:stop]</code></td>
<td>从 <code>start</code> 到 <code>stop-1</code> 的子序列</td>
<td><code>&quot;hello&quot;[1:4]</code> → <code>&quot;ell&quot;</code></td>
</tr>
<tr>
<td><code>sequence[start:]</code></td>
<td>从 <code>start</code> 到序列末尾的子序列</td>
<td><code>&quot;hello&quot;[2:]</code> → <code>&quot;llo&quot;</code></td>
</tr>
<tr>
<td><code>sequence[:stop]</code></td>
<td>从序列开头到 <code>stop-1</code> 的子序列</td>
<td><code>&quot;hello&quot;[:3]</code> → <code>&quot;hel&quot;</code></td>
</tr>
<tr>
<td><code>sequence[::step]</code></td>
<td>从序列开头到末尾，按 <code>step</code> 步长提取子序列</td>
<td><code>&quot;hello&quot;[::2]</code> → <code>&quot;hlo&quot;</code></td>
</tr>
<tr>
<td><code>sequence[::-1]</code></td>
<td>反转序列</td>
<td><code>&quot;hello&quot;[::-1]</code> → <code>&quot;olleh&quot;</code></td>
</tr>
<tr>
<td><code>sequence[start:stop:step]</code></td>
<td>从 <code>start</code> 到 <code>stop-1</code>，按 <code>step</code> 步长提取子序列</td>
<td><code>&quot;hello&quot;[1:5:2]</code> → <code>&quot;el&quot;</code></td>
</tr>
</tbody>
</table>
<p>❷ 迭代</p>
<p>Python 中只要是可迭代对象，无论有无下标，都可以迭代。它是通过 <code>for ... in</code> 来完成的，而很多语言比如 C 语言，迭代 <code>list</code> 是通过下标完成的。</p>
<p>默认情况下，<code>dict</code> 迭代的是 key。如果要迭代 value，可以用 <code>for value in d.values()</code>，如果要同时迭代 key 和 value，可以用 <code>for k, v in d.items()</code>。</p>
<p><strong>如何判断一个对象是可迭代对象呢？</strong> 方法是通过 <code>collections.abc</code> 模块的 <code>Iterable</code> 类型判断，如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">collections.abc</span> <span style="color:#000;font-weight:bold">import</span> Iterable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">isinstance</span>(<span style="color:#d14">&#39;abc&#39;</span>, Iterable) <span style="color:#998;font-style:italic"># → True</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">isinstance</span>(<span style="color:#099">123</span>, Iterable)   <span style="color:#998;font-style:italic"># → False</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果要对 <code>list</code> 实现类似 C 那样的下标循环怎么办？👻</p>
<p>Python 内置的 <code>enumerate</code> 函数可以把一个 <code>list</code> 变成索引-元素对，这样就可以在 <code>for</code> 循环中同时迭代索引和元素本身。</p>
<pre tabindex="0"><code>&gt;&gt;&gt; for i, value in enumerate([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]):
...     print(i, value)
...
0 A
1 B
2 C
</code></pre><p>❸ 列表生成式</p>
<p>i.e.List Comprehensions</p>
<p>列表生成式可以看成是循环生成列表的语法糖 🍬，如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0086b3">list</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">list</span>(<span style="color:#0086b3">range</span>(<span style="color:#099">0</span>, <span style="color:#099">9</span>))     <span style="color:#998;font-style:italic"># [0, 1, 2, 3, 4, 5, 6, 7, 8]</span>
</span></span><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [x <span style="color:#000;font-weight:bold">*</span> x <span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">list</span>]    <span style="color:#998;font-style:italic"># [0, 1, 4, 9, 16, 25, 36, 49, 64]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 等同于</span>
</span></span><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">list</span>:
</span></span><span style="display:flex;"><span>    L<span style="color:#000;font-weight:bold">.</span>append(x <span style="color:#000;font-weight:bold">*</span> x)
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果不想每个元素都转换呢？如何用条件过滤？</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [x <span style="color:#000;font-weight:bold">*</span> x <span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">list</span> <span style="color:#000;font-weight:bold">if</span> x <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span>] <span style="color:#998;font-style:italic"># [0, 4, 16, 36, 64]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 等同于</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">list</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> x <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span>:
</span></span><span style="display:flex;"><span>        L<span style="color:#000;font-weight:bold">.</span>append(x <span style="color:#000;font-weight:bold">*</span> x)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [x <span style="color:#000;font-weight:bold">*</span> x <span style="color:#000;font-weight:bold">if</span> x <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">list</span>]        <span style="color:#998;font-style:italic"># ❌❓</span>
</span></span><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> [x <span style="color:#000;font-weight:bold">*</span> x <span style="color:#000;font-weight:bold">if</span> x <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">for</span> x <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">list</span>] <span style="color:#998;font-style:italic"># ✔️</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>把 <code>if</code> 写在 <code>for</code> 前面必须加 <code>else</code>，否则报错。 <strong>为什么呢？</strong></p>
<p>这是因为 <code>for</code> 前面的部分是一个表达式，它必须根据 <code>x</code> 计算出一个结果。因此，考察表达式：<code>x if x % 2 == 0</code>，它无法根据 <code>x</code> 计算出结果，因为缺少 <code>else</code>，必须加上 <code>else</code> 。</p>
<p>❹ 生成器</p>
<p>通过列表生成式，我们可以直接创建一个列表。但是，受到内存限制，列表容量肯定是有限的。那么，<strong>可不可以在循环的过程中不断推算出后续的元素呢？</strong> 这样就不必创建完整的 list，从而节省大量的空间。</p>
<p>一边循环一边计算的机制，称为生成器（generator） 。那么，如何创建一个 generator 呢？</p>
<p><strong>¹</strong> 第一种方法很简单，只要把一个列表生成式的 <code>[]</code> 改成 <code>()</code>，就创建了一个 generator。如下：</p>
<pre tabindex="0"><code>&gt;&gt;&gt; g = (x * x for x in range(10))
&gt;&gt;&gt; g
&lt;generator object &lt;genexpr&gt; at 0x1022ef630&gt;
</code></pre><p>可以通过 <code>next()</code> 函数获得 generator 的下一个返回值，但正确的方法是使用 <code>for</code> 循环。</p>
<p><strong>²</strong> 如果一个函数定义中包含 <code>yield</code> 关键字，那么这个函数就不再是一个普通函数，而是一个 generator 函数，调用一个 generator 函数将返回一个 generator 。</p>
<p>想要了解更多关于生成器的内容，可以阅读另一篇 「 [[生成器]] 」原理都是相通的。</p>
<p>❺ 迭代器</p>
<p>可以被 <code>next()</code> 函数调用并不断返回下一个值的对象称为迭代器：<code>Iterator</code>。</p>
<p>🪧 生成器都是 <code>Iterator</code> 对象，但 <code>list</code>、<code>dict</code>、<code>str</code> 虽然是 <code>Iterable</code>，却不是 <code>Iterator</code>。</p>
<p><strong>为什么呢？</strong></p>
<p>这是因为 Python 的 <code>Iterator</code> 对象表示的是一个数据流，可以把这个数据流看做是一个有序序列，但我们却不能提前知道序列的长度，只能不断通过 <code>next()</code> 函数实现按需计算下一个数据，所以 <code>Iterator</code> 的计算是惰性的，只有在需要返回下一个数据时它才会计算。</p>
<p>当然，如果要把 <code>list</code>、<code>dict</code>、<code>str</code> 等 <code>Iterable</code> 变成 <code>Iterator</code> 可以使用 <code>iter()</code> 函数，如：</p>
<pre tabindex="0"><code>&gt;&gt;&gt; isinstance(iter([]), Iterator)
True
&gt;&gt;&gt; isinstance(iter(&#39;abc&#39;), Iterator)
True
</code></pre><h3 id="函数">函数</h3>
<p>在上个章节中，我们提到了定义中包含 <code>yield</code> 关键字的函数是一个 generator 函数，那么具体什么是函数呢？</p>
<p>函数就是最基本的一种代码抽象的方式。看看它是怎么定义的，如下：</p>
<pre tabindex="0"><code>def 函数名(参数):
    函数体
    return 返回值    # 若没有 return 语句，默认返回 None
</code></pre><p>如果想定义一个什么事也不做的<strong>空函数</strong>，可以用 <code>pass</code> 语句：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">nop</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">pass</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>调用函数时，如果<strong>参数个数不对</strong>，Python 解释器会自动检查出来，并抛出 <code>TypeError</code>。但是如果<strong>参数类型不对</strong>，Python 解释器就无法帮我们检查。</p>
<p>数据类型检查可以用内置函数 <code>isinstance()</code> 实现。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">my_abs</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">not</span> <span style="color:#0086b3">isinstance</span>(x, (<span style="color:#0086b3">int</span>, <span style="color:#0086b3">float</span>)):      <span style="color:#998;font-style:italic"># 类型检查</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">raise</span> <span style="color:#900;font-weight:bold">TypeError</span>(<span style="color:#d14">&#39;bad operand type&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> x <span style="color:#000;font-weight:bold">&gt;=</span> <span style="color:#099">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span>x
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>函数可以返回多个值吗？</strong> 答案是肯定的。但真的是多个值吗？但其实这只是一种假象，Python 函数返回的仍然是单一值（<strong>元组</strong>罢了👻）。</p>
<h3 id="函数式编程">函数式编程</h3>
<p><strong>函数式编程</strong> 就是一种抽象程度很高的编程范式。</p>
<p>纯粹的函数式编程语言编写的函数<strong>没有变量</strong>，因此，任意一个函数，只要输入是确定的，输出就是确定的，这种纯函数我们称之为没有副作用。而允许使用变量的程序设计语言，由于函数内部的变量状态不确定，同样的输入，可能得到不同的输出，因此，这种函数是有副作用的。</p>
<p>函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！</p>
<p>Python 对函数式编程提供部分支持。由于 Python 允许使用变量，因此，Python 不是纯函数式编程语言。</p>
<h4 id="高阶函数">高阶函数</h4>
<p>一个函数可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p>
<p>编写高阶函数，就是让函数的参数能够接收别的函数。下面我们就看几个经典的高阶函数。</p>
<p>❶ <strong>map</strong></p>
<p><code>map()</code> 函数接收两个参数，一个是函数，一个是 <code>Iterable</code>，<code>map</code> 将传入的函数依次作用到序列的每个元素，并把结果作为新的 <code>Iterator</code> 返回。</p>
<pre tabindex="0"><code>&gt;&gt;&gt; def f(x):
...     return x * x
...
&gt;&gt;&gt; r = map(f, [1, 2, 3, 4, 5, 6, 7, 8, 9])  # r 是一个迭代器
&gt;&gt;&gt; list(r)
[1, 4, 9, 16, 25, 36, 49, 64, 81]
</code></pre><p><code>map()</code> 传入的第一个参数是 <code>f</code>，即函数对象本身。</p>
<p>由于结果 <code>r</code> 是一个 <code>Iterator</code>，<code>Iterator</code> 是惰性序列，因此通过 <code>list()</code> 函数让它把整个序列都计算出来并返回一个 list。</p>
<p>你可能会想，不需要 <code>map()</code> 函数，写一个循环，也可以计算出结果，如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>L <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> [<span style="color:#099">1</span>, <span style="color:#099">2</span>, <span style="color:#099">3</span>, <span style="color:#099">4</span>, <span style="color:#099">5</span>, <span style="color:#099">6</span>, <span style="color:#099">7</span>, <span style="color:#099">8</span>, <span style="color:#099">9</span>]:
</span></span><span style="display:flex;"><span>    L<span style="color:#000;font-weight:bold">.</span>append(f(n))
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(L)
</span></span></code></pre></td></tr></table>
</div>
</div><p>看，事实上 <code>map()</code> 只是把运算规则抽象了。让你一眼就能看明白 “是把 f(x) 作用在 list 的每一个元素并把结果生成一个新的 list ” 。</p>
<p>❷ <strong>reduce</strong></p>
<p><code>reduce</code> 把一个函数作用在一个序列 <code>[x1, x2, x3, ...]</code> 上，这个函数<strong>必须接收两个参数</strong>，<code>reduce</code> 把<strong>结果</strong>继续和<strong>序列的下一个元素</strong>做累积计算，其效果就是：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>reduce(f, [x1, x2, x3, x4]) <span style="color:#000;font-weight:bold">=</span> f(f(f(x1, x2), x3), x4)
</span></span></code></pre></td></tr></table>
</div>
</div><p>❸ <strong>filter</strong></p>
<p>和 <code>map()</code> 类似，<code>filter()</code> 也接收一个函数和一个序列。和 <code>map()</code> 不同的是，<code>filter()</code> 把传入的函数依次作用于每个元素，然后根据返回值是 <code>True</code> 还是 <code>False</code> 决定<strong>保留还是丢弃</strong>该元素。</p>
<p>可见用 <code>filter()</code> 这个高阶函数，关键在于正确实现一个“筛选”函数。</p>
<p>注意到 <code>filter()</code> 函数返回的是一个 <code>Iterator</code>，也就是一个惰性序列，所以要强迫 <code>filter()</code> 完成计算结果，也需要用 <code>list()</code> 函数获得所有结果并返回 list。</p>
<p>❹ <strong>sorted</strong></p>
<p>排序是在程序中经常用到的算法。无论使用冒泡排序还是快速排序，排序的核心是比较两个元素的大小。如果是数字，我们可以直接比较，但如果是字符串或者两个 dict 呢？直接比较数学上的大小是没有意义的，因此，<strong>比较的过程必须通过函数抽象出来</strong>。</p>
<p>Python 内置的 <code>sorted()</code> 函数就可以对 list 进行排序：</p>
<pre tabindex="0"><code>&gt;&gt;&gt; sorted([36, 5, -12, 9, -21])
[-21, -12, 5, 9, 36]
</code></pre><p><code>sorted()</code> 函数也是一个高阶函数，它还可以接收一个 <code>key</code> 函数来实现自定义的排序，例如按绝对值大小排序：</p>
<pre tabindex="0"><code>&gt;&gt;&gt; sorted([36, 5, -12, 9, -21], key=abs)
[5, 9, -12, -21, 36]
</code></pre><p>key 指定的函数将作用于 list 的每一个元素上，并根据 key 函数返回的结果进行排序。</p>
<h4 id="返回函数">返回函数</h4>
<p>高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回。</p>
<p>来实现一个可变参数的求和。通常情况下，求和的函数是这样定义的，如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">calc_sum</span>(<span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>    ax <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> args:
</span></span><span style="display:flex;"><span>        ax <span style="color:#000;font-weight:bold">=</span> ax <span style="color:#000;font-weight:bold">+</span> n
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> ax
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>calc_sum(<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">4</span>,<span style="color:#099">5</span>)  <span style="color:#998;font-style:italic"># → 15</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是，如果<strong>不需要立刻求和</strong>，而是在后面的代码中，根据需要再计算怎么办？</p>
<p>可以不返回求和的结果，而是<strong>返回求和的函数</strong>。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">lazy_sum</span>(<span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">sum</span>():
</span></span><span style="display:flex;"><span>        ax <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> n <span style="color:#000;font-weight:bold">in</span> args:
</span></span><span style="display:flex;"><span>            ax <span style="color:#000;font-weight:bold">=</span> ax <span style="color:#000;font-weight:bold">+</span> n
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> ax
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">sum</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> lazy_sum(<span style="color:#099">1</span>,<span style="color:#099">2</span>,<span style="color:#099">3</span>,<span style="color:#099">4</span>,<span style="color:#099">5</span>) <span style="color:#998;font-style:italic"># → &lt;function lazy_sum.&lt;locals&gt;.sum at 0x101c6ed90&gt;</span>
</span></span><span style="display:flex;"><span>f()                     <span style="color:#998;font-style:italic"># → 15</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个例子中，我们在函数 <code>lazy_sum</code> 中又定义了函数 <code>sum</code>，并且，内部函数 <code>sum</code> 可以引用外部函数 <code>lazy_sum</code> 的参数和局部变量，当 <code>lazy_sum</code> 返回函数 <code>sum</code> 时，相关参数和变量都保存在返回的函数中，这种称为 <strong>“闭包（Closure）”</strong> 的程序结构拥有极大的威力。</p>
<p>注意，当我们调用 <code>lazy_sum()</code> 时，每次调用都会返回一个新的函数，即使传入相同的参数。</p>
<p>🔔 <strong>返回闭包时牢记一点：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">count</span>():
</span></span><span style="display:flex;"><span>    fs <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">4</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>():
</span></span><span style="display:flex;"><span>             <span style="color:#000;font-weight:bold">return</span> i<span style="color:#000;font-weight:bold">*</span>i
</span></span><span style="display:flex;"><span>        fs<span style="color:#000;font-weight:bold">.</span>append(f)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> fs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f1, f2, f3 <span style="color:#000;font-weight:bold">=</span> count()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f1() <span style="color:#998;font-style:italic"># → 9</span>
</span></span><span style="display:flex;"><span>f2() <span style="color:#998;font-style:italic"># → 9</span>
</span></span><span style="display:flex;"><span>f3() <span style="color:#998;font-style:italic"># → 9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>什么情况？全部都是 <code>9</code>！原因就在于返回的函数引用了变量 <code>i</code>，但它<strong>并非立刻执行。</strong> 等到3个函数都返回时，它们所引用的变量 <code>i</code> 已经变成了 <code>3</code>，因此最终结果为 <code>9</code>。</p>
<p>如果一定要引用循环变量怎么办？</p>
<p>方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">count</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">f</span>(j):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">g</span>():
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> j<span style="color:#000;font-weight:bold">*</span>j
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> g
</span></span><span style="display:flex;"><span>    fs <span style="color:#000;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">in</span> <span style="color:#0086b3">range</span>(<span style="color:#099">1</span>, <span style="color:#099">4</span>):
</span></span><span style="display:flex;"><span>        fs<span style="color:#000;font-weight:bold">.</span>append(f(i)) <span style="color:#998;font-style:italic"># f(i)立刻被执行，因此i的当前值被传入f()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> fs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f1() <span style="color:#998;font-style:italic"># → 1</span>
</span></span><span style="display:flex;"><span>f2() <span style="color:#998;font-style:italic"># → 4</span>
</span></span><span style="display:flex;"><span>f3() <span style="color:#998;font-style:italic"># → 9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>💡 使用闭包时，对外层变量赋值前，需要先使用 nonlocal 声明该变量不是当前函数的局部变量。</p>
<p>使用闭包，就是内层函数引用了外层函数的局部变量。如果只是读外层变量的值，我们会发现返回的闭包函数调用一切正常。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">inc</span>():
</span></span><span style="display:flex;"><span>    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># 仅读取x的值:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> x <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> fn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> inc()
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(f()) <span style="color:#998;font-style:italic"># 1</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(f()) <span style="color:#998;font-style:italic"># 1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是，如果对外层变量赋值，由于Python解释器会把 <code>x</code> 当作函数 <code>fn()</code> 的局部变量，它会报错。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">inc</span>():
</span></span><span style="display:flex;"><span>    x <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">fn</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic"># nonlocal x</span>
</span></span><span style="display:flex;"><span>        x <span style="color:#000;font-weight:bold">=</span> x <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> x
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> fn
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f <span style="color:#000;font-weight:bold">=</span> inc()
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(f()) <span style="color:#998;font-style:italic"># 1</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(f()) <span style="color:#998;font-style:italic"># 2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>原因是 <code>x</code> 作为局部变量并没有初始化，直接计算 <code>x+1</code> 是不行的。但我们其实是想引用 <code>inc()</code> 函数内部的 <code>x</code>，所以需要在 <code>fn()</code> 函数内部加一个 <code>nonlocal x</code> 的声明。加上这个声明后，解释器把 <code>fn()</code> 的 <code>x</code> 看作外层函数的局部变量，它已经被初始化了，可以正确计算 <code>x+1</code>。</p>
<h4 id="匿名函数">匿名函数</h4>
<p><code>lambda x: x * x</code> 就是一个匿名函数，关键字 <code>lambda</code> 表示匿名函数，冒号前面的 <code>x</code> 表示函数参数。</p>
<p>它没有函数名，所以不用担心命名冲突。只有一个表达式，不用 <code>return</code> ，返回值就是表达式的结果。</p>
<h4 id="装饰器">装饰器</h4>
<p>本质上，装饰器（decorator） 就是一个返回函数的高阶函数。</p>
<blockquote>
<p>:: 其实就是代理。</p>
</blockquote>
<p>假设，我们有一个 <code>now</code> 函数，如下：</p>
<pre tabindex="0"><code>def now():
    print(&#39;2025-01-02&#39;)
    
now()         # → 2025-01-02
now.__name__  # → &#39;now&#39;
</code></pre><p>现在我们要增强 <code>now()</code> 的功能，如在函数调用前后打印日志，但又不希望修改 <code>now()</code> 函数的定义。怎么办呢？</p>
<p>通过装饰器！这种在代码运行期间动态增加功能的方式，称之为“装饰器”（Decorator）。</p>
<p><strong>本质上，装饰器（decorator） 就是一个返回函数的高阶函数。</strong> 我们先来定义一个打印日志的装饰器，如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(func):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;call </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> func<span style="color:#000;font-weight:bold">.</span>__name__)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在我们有一个装饰器 - <code>log()</code> 了，如何使用它呢？借助 Python 的@语法，把 decorator 置于函数的定义处即可。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@log</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">now</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;2024-6-1&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，我们再来调用一下 <code>now()</code> 函数，在调用函数之前就会输出调用的函数名这条日志了。</p>
<pre tabindex="0"><code>&gt;&gt;&gt; now()
call now():
2024-6-1

&gt;&gt;&gt; now.__name__
wrapper    # ❓ 变成 wrapper 了
</code></pre><p>把 <code>@log</code> 放到 <code>now()</code> 函数的定义处，相当于执行了语句：<code>now = log(now)</code> 。</p>
<p>看，现在调用的 <code>now</code> 不再是原来的 <code>now</code> 了，而是 <code>log</code> 函数返回的同名函数。不信你看，函数的 <code>__name__</code> 属性变成了 <code>wrapper</code> 。</p>
<p>所以，需要把原始函数的 <code>__name__</code> 等属性复制到 <code>wrapper()</code> 函数中，否则，有些依赖函数签名的代码执行就会出错。</p>
<p>不需要编写 <code>wrapper.__name__ = func.__name__</code> 这样的代码，Python 内置的 <code>functools.wraps</code> 就是干这个事的，所以，一个完整的 decorator 的写法如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(func):
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@functools</span><span style="color:#000;font-weight:bold">.</span>wraps(func)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;call </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> func<span style="color:#000;font-weight:bold">.</span>__name__)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果，<strong>装饰器本身需要传入参数呢？</strong>  那就需要 <strong>编写一个返回 decorator 的高阶函数。</strong> 比如，要自定义 log 的文本：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 定义 log</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">log</span>(text):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">decorator</span>(func):
</span></span><span style="display:flex;"><span>       <span style="color:#3c5d5d;font-weight:bold">@functools</span><span style="color:#000;font-weight:bold">.</span>wraps(func)
</span></span><span style="display:flex;"><span>       <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">wrapper</span>(<span style="color:#000;font-weight:bold">*</span>args, (<span style="color:#000;font-weight:bold">**</span>kw)):
</span></span><span style="display:flex;"><span>           <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;</span><span style="color:#d14">%s</span><span style="color:#d14"> </span><span style="color:#d14">%s</span><span style="color:#d14">():&#39;</span> <span style="color:#000;font-weight:bold">%</span> (text, func<span style="color:#000;font-weight:bold">.</span>__name__))
</span></span><span style="display:flex;"><span>           <span style="color:#000;font-weight:bold">return</span> func(<span style="color:#000;font-weight:bold">*</span>args, <span style="color:#000;font-weight:bold">**</span>kw)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> wrapper
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> decorator
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 使用 log</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@log</span>(<span style="color:#d14">&#39;执行函数&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">now</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">print</span>(<span style="color:#d14">&#39;2025-01-02)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在，我们来调用一个 <code>now()</code> ，如下：</p>
<pre tabindex="0"><code>&gt;&gt;&gt; now()
执行函数 now():
2025-01-02
</code></pre><h4 id="偏函数">偏函数</h4>
<p>所谓偏函数，就是把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，调用这个新函数会更简单。</p>
<p><code>functools.partial</code> 就是做这个的。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">functools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>int2 <span style="color:#000;font-weight:bold">=</span> functools<span style="color:#000;font-weight:bold">.</span>partial(<span style="color:#0086b3">int</span>, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>)
</span></span><span style="display:flex;"><span>int2(<span style="color:#d14">&#39;1000000&#39;</span>)  <span style="color:#998;font-style:italic"># → 64</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>它就是就相当于替我们实现了下面这样一个函数：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">int2</span>(x, base<span style="color:#000;font-weight:bold">=</span><span style="color:#099">2</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">int</span>(x, base)
</span></span></code></pre></td></tr></table>
</div>
</div><p>仅此而已。</p>
<h2 id="模块">模块</h2>
<p>在 Python 中，一个 <code>.py</code> 文件就称之为一个<strong>模块（Module）</strong>。</p>
<p>使用模块，大大提高了代码的可维护性，还可以函数名和变量名冲突。为了避免模块名冲突，Python 又引入了按目录来组织模块的方法，称为<strong>包（Package）</strong>。</p>
<p>引入了包以后，只要顶层的包名不与别人冲突，那所有模块都不会与别人冲突。</p>
<pre tabindex="0"><code>mycompany
├─ __init__.py
├─ abc.py
└─ xyz.py
</code></pre><p>每一个包目录下面都会有一个 <code>__init__.py</code> 的文件，这个文件是必须存在的，否则，Python就把这个目录当成普通目录，而不是一个包。</p>
<p><code>__init__.py</code> 可以是空文件，也可以有 Python 代码，因为 <code>__init__.py</code> 本身就是一个模块，而它的模块名就是 <code>mycompany</code>。</p>
<p><code>abc.py</code> 模块的名字就变成了 <code>mycompany.abc</code>，类似的，<code>xyz.py</code> 的模块名变成了 <code>mycompany.xyz</code>。</p>
<p>类似的，可以有多级目录，组成多级层次的包结构。</p>
<h2 id="常用内建模块">常用内建模块</h2>
<h3 id="venv">venv</h3>
<p>默认情况下，所有第三方的包都会被 <code>pip</code> 安装到Python3的 <code>site-packages</code> 目录下。</p>
<p>如果要同时开发多个应用程序，应用 A 需要 jinja 2.7，而应用 B 需要 jinja 2.6 <strong>怎么办？</strong></p>
<p>这种情况下，每个应用可能需要各自拥有一套“独立”的 Python 运行环境。<code>venv</code> 就是用来为一个应用创建一套“隔离”的 Python 运行环境。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ① 创建项目目录</span>
</span></span><span style="display:flex;"><span>jack@jk:/d/wp$ mkdir pyvenv
</span></span><span style="display:flex;"><span>jack@jk:/d/wp$ <span style="color:#0086b3">cd</span> pyvenv/
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ② 创建一个独立的 Python 运行环境</span>
</span></span><span style="display:flex;"><span>jack@jk:/d/wp/pyvenv$ python3 -m venv .
</span></span><span style="display:flex;"><span>jack@jk:/d/wp/pyvenv$ ls
</span></span><span style="display:flex;"><span>Include  Lib  Scripts  pyvenv.cfg
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ③ 激活 venv 环境</span>
</span></span><span style="display:flex;"><span>jack@jk:/d/wp/pyvenv$ <span style="color:#0086b3">source</span> Scripts/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ④ 激活后命令提示符多了 (pyvenv) 前缀</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ..下面可正常安装各种第三方包</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ..安装的包都被安装到当前 pyvenv 这个环境下</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ../d/wp/pyvenv/Lib/site-packages 目录中</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>pyvenv<span style="color:#000;font-weight:bold">)</span> jack@jk:/d/wp/pyvenv$ pip3 install jinja2
</span></span><span style="display:flex;"><span>Collecting jinja2
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Successfully installed MarkupSafe-3.0.2 jinja2-3.1.5
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>pyvenv<span style="color:#000;font-weight:bold">)</span> jack@jk:/d/wp/pyvenv$ python
</span></span><span style="display:flex;"><span>Python 3.13.1 <span style="color:#000;font-weight:bold">(</span>tags/v3.13.1:0671451, Dec  <span style="color:#099">3</span> 2024, 19:06:28<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">[</span>MSC v.1942 <span style="color:#099">64</span> bit <span style="color:#000;font-weight:bold">(</span>AMD64<span style="color:#000;font-weight:bold">)]</span> on win32
</span></span><span style="display:flex;"><span>Type <span style="color:#d14">&#34;help&#34;</span>, <span style="color:#d14">&#34;copyright&#34;</span>, <span style="color:#d14">&#34;credits&#34;</span> or <span style="color:#d14">&#34;license&#34;</span> <span style="color:#000;font-weight:bold">for</span> more information.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; import jinja2
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; exit<span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ⑤ 退出当前的 pyvenv 环境</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>pyvenv<span style="color:#000;font-weight:bold">)</span> jack@jk:/d/wp/pyvenv$ <span style="color:#0086b3">cd</span> Scripts/
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>pyvenv<span style="color:#000;font-weight:bold">)</span> jack@jk:/d/wp/pyvenv/Scripts$ deactivate
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>:: 跟 <code>node_modules</code> 是一样一样的。</p>
</blockquote>
<h2 id="附录">附录</h2>
<h3 id="python-项目组织结构">python 项目组织结构</h3>
<p>Python 项目的组织结构有很多种方式，但有一些经典且广泛使用的组织结构，可以帮助你创建易于维护、扩展和协作的项目。以下是一些经典的 Python 项目结构示例，适用于不同类型的项目。</p>
<p>❶ 最简单的 Python 脚本项目</p>
<p>最简单的项目结构，适合只有一个或几个脚本的小项目。</p>
<pre tabindex="0"><code>/my_project
    /script.py
    /another_script.py
</code></pre><p>❷ 典型的 Python 包结构</p>
<p>适用于将项目组织为一个 Python 包，并且可能会包含多个模块和脚本。</p>
<pre tabindex="0"><code>/my_project
    /my_project              # 主包目录
        __init__.py          # 包的初始化文件
        module1.py           # 模块 1
        module2.py           # 模块 2
    /tests                   # 测试目录
        test_module1.py      # 测试模块 1
        test_module2.py      # 测试模块 2
    /setup.py                # 安装脚本
    /README.md               # 项目文档
    /requirements.txt        # 依赖库
</code></pre><p>❸ Python 应用程序项目结构</p>
<p>适用于较大的 Python 应用程序，包含多个模块、脚本、配置文件、日志文件等。它的组织结构支持大规模开发。</p>
<pre tabindex="0"><code>/my_project
    /my_project              # 主包目录
        __init__.py
        /core                # 核心模块
            __init__.py
            main.py          # 主程序入口
        /models              # 数据模型
            __init__.py
            model1.py
        /services            # 服务层，例如 API 调用
            __init__.py
            service1.py
        /utils               # 工具函数
            __init__.py
            utils.py
    /tests                   # 测试目录
        __init__.py
        test_core.py         # 核心模块的测试
        test_models.py       # 模型模块的测试
    /config                  # 配置文件
        config.yaml          # 配置文件
        logging.conf         # 日志配置
    /logs                    # 日志目录
    /setup.py                # 安装脚本
    /README.md               # 项目文档
    /requirements.txt        # 依赖库
    /Dockerfile              # 如果需要容器化
    /Makefile                # 可选，自动化构建任务
</code></pre><p>❹ CLI 工具项目结构</p>
<p>如果你要开发一个命令行工具（CLI），这通常包括命令的定义、解析和执行。</p>
<pre tabindex="0"><code>/my_project
    /my_project              # 主包目录
        __init__.py
        cli.py               # 定义命令行工具
        commands.py          # 定义命令
    /tests                   # 测试文件
        test_cli.py
    /setup.py                # 安装脚本
    /requirements.txt        # 依赖库
    /README.md               # 项目文档
</code></pre><p>还有一些经典的框架项目组织结构，如 Django、Flask 等等……</p>
<p>以下是项目组织结构中常见的文件和目录：</p>
<ul>
<li><strong><code>README.md</code></strong>：项目文档，描述项目的目的、使用方法和任何其他相关信息。</li>
<li><strong><code>requirements.txt</code></strong>：列出所有 Python 包依赖，通常用于 <code>pip install -r requirements.txt</code> 来安装依赖。</li>
<li><strong><code>setup.py</code></strong>：安装脚本，通常用于将包发布到 PyPI 或安装到虚拟环境中。</li>
<li><strong><code>Dockerfile</code></strong>：容器化配置，用于 Docker 部署。</li>
<li><strong><code>tests/</code></strong>：测试文件目录，包含单元测试、集成测试等。</li>
<li><strong><code>config/</code></strong>：配置文件，通常包括数据库配置、日志配置等。</li>
</ul>
<p>对于小型项目，你可以使用简单的脚本结构或者单一模块结构。对于中型到大型项目，通常建议按照功能模块进行划分，并且将配置文件、日志文件、文档等独立成不同的目录。</p>
<p>❺ 项目脚手架</p>
<p>Python 生态系统中有一些优秀的项目脚手架工具和框架，它们帮助开发者快速创建结构化、可扩展的项目，提升开发效率。这些工具通常为项目提供了清晰的目录结构、常用的功能模块和配置文件等。</p>
<p><strong>¹ Cookiecutter</strong></p>
<p>Cookiecutter 是一个非常流行的项目模板生成器，支持从模板快速创建新的 Python 项目结构。它的主要优点是模板可自定义，开发者可以根据需要创建模板，或者使用社区中已有的模板（如 Django、Flask、Data Science 项目等）。</p>
<p><strong>² Poetry 🌟 〔 推荐 〕</strong></p>
<p>Poetry 是一个现代化的 Python 包管理和构建工具，支持依赖管理、包发布和项目脚手架生成。Poetry 具有类似于 Node.js 的 <code>npm</code> 的功能，但它更适合 Python 开发。</p>
<p>我们将在另一篇文章 - [[ Poetry 的简要说明 ]] 中系统扼要的说明一下。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>自动化依赖管理：Poetry 自动处理依赖关系，避免手动编辑 <code>requirements.txt</code>。</li>
<li>包发布：Poetry 可以方便地将包发布到 PyPI。</li>
<li>集成虚拟环境：Poetry 自带虚拟环境的管理功能。</li>
</ul>
<pre tabindex="0"><code># 安装
pip install poetry

# 创建项目
poetry new my_project
# 管理依赖
poetry add requests
</code></pre><p>其他还有一些脚手架，这里就不作过多介绍了，感兴趣的可以自行了解。</p>
<ul>
<li><strong>Cookiecutter</strong>：最为通用的 Python 项目脚手架工具，支持多种类型的项目结构。</li>
<li><strong>Poetry</strong>：除了包管理功能外，还支持项目脚手架生成，非常适合现代 Python 项目。</li>
<li><strong>PyScaffold</strong>：提供一个标准化的 Python 项目结构，适合各种应用和库开发。</li>
<li><strong>Flask-Skeleton</strong> 和 <strong>Django Cookiecutter</strong>：专为 Flask 和 Django 项目提供的脚手架。</li>
<li><strong>FastAPI Starter Template</strong>：专为 FastAPI 项目提供的高效开发模板。</li>
</ul>
<p>根据你的需求（例如 Web 开发、数据科学、API 开发等），你可以选择适合的脚手架工具，快速启动项目。如果你有特定的框架或需求，可以让我进一步帮助你选择。</p>
<h3 id="python-中获取时间和格式化">python 中获取时间和格式化</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">datetime</span> <span style="color:#000;font-weight:bold">import</span> datetime
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 获取当前日期</span>
</span></span><span style="display:flex;"><span>current_date <span style="color:#000;font-weight:bold">=</span> datetime<span style="color:#000;font-weight:bold">.</span>now()<span style="color:#000;font-weight:bold">.</span>date()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 格式化日期</span>
</span></span><span style="display:flex;"><span>formatted_date <span style="color:#000;font-weight:bold">=</span> current_date<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%Y年%m月</span><span style="color:#d14">%d</span><span style="color:#d14">日&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;格式化后的日期:&#34;</span>, formatted_date)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 其他格式</span>
</span></span><span style="display:flex;"><span>formatted_date_2 <span style="color:#000;font-weight:bold">=</span> current_date<span style="color:#000;font-weight:bold">.</span>strftime(<span style="color:#d14">&#34;%A, </span><span style="color:#d14">%d</span><span style="color:#d14"> %B %Y&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#0086b3">print</span>(<span style="color:#d14">&#34;另一种格式:&#34;</span>, formatted_date_2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># » 格式化后的日期: 2023年10月05日</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># » 另一种格式: Thursday, 05 October 2023</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pyenv-版本管理">pyenv 版本管理</h3>
<p>首先，通过 Powershell 安装 pyenv-win  ，如下：</p>
<pre tabindex="0"><code>Invoke-WebRequest -UseBasicParsing -Uri &#34;https://raw.githubusercontent.com/pyenv-win/pyenv-win/master/pyenv-win/install-pyenv-win.ps1&#34; -OutFile &#34;./install-pyenv-win.ps1&#34;; &amp;&#34;./install-pyenv-win.ps1&#34;
</code></pre><p>然后，重新打开终端，运行 <code>pyenv --version</code> 检查是否安装成功。注意，你总是可能通过 <code>pyenv help</code> 了解更多。</p>
<p>更多详情参考 ➭ <a href="https://github.com/pyenv-win/pyenv-win/blob/master/README.md#installation">pyenv-win installation</a> 。</p>
<p>下面来安装一个版本的 python 吧。</p>
<pre tabindex="0"><code># 列出可安装的 python 版本
pyenv install -l

# 安装选定的可用版本
pyenv install &lt;version&gt;

# 将安装的版本设置为全局可用
pyenv global &lt;version&gt;

# 显示当前使用的版本
pyenv version
# → &lt;version&gt; (set by \path\to\.pyenv\pyenv-win\.python-version)

# 检查 python 是否正常执行
python -c &#34;import sys; print(sys.executable)&#34;
# → \path\to\.pyenv\pyenv-win\versions\&lt;version&gt;\python.exe
</code></pre><h3 id="venvpyenv-和-poetry-中虚拟环境的区别和联系">venv、pyenv 和 poetry 中虚拟环境的区别和联系</h3>
<p>在 Python 开发中，<code>venv</code>、<code>pyenv</code> 和 <code>poetry</code> 都是用于管理虚拟环境的工具，但它们的功能和使用场景有所不同。以下是它们的区别和关系：</p>
<p><strong>① venv</strong></p>
<p><code>venv</code> 是 Python3.3 及以上版本内置的轻量级虚拟环境工具，用于创建隔离的 Python 环境。</p>
<p><code>venv</code> 可以创建独立的 Python 虚拟环境，每个环境有自己的一套 Python 解释器和包。它不提供依赖管理功能，通常与 <code>pip</code> 结合使用来安装和管理 Python 包。</p>
<p>适用于简单的 Python 项目，特别是那些只需要管理 Python 包和虚拟环境的项目。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv myenv      <span style="color:#998;font-style:italic"># 创建虚拟环境</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">source</span> myenv/bin/activate  <span style="color:#998;font-style:italic"># 激活环境（ linux/macos ）</span>
</span></span><span style="display:flex;"><span>myenv<span style="color:#d14">\S</span>cripts<span style="color:#d14">\a</span>ctivate     <span style="color:#998;font-style:italic"># 激活环境（ Windows ）</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>② pyenv</strong></p>
<p><code>pyenv</code> 是一个用于管理多个 Python 版本的工具，允许在同一台机器上安装、切换和使用不同的 Python 版本。</p>
<p>它本身不直接管理虚拟环境，但可以通过插件 <code>pyenv-virtualenv</code> 来创建和管理虚拟环境。它主要用于解决不同项目需要不同 Python 版本的问题。</p>
<p>适用于需要在不同项目中使用不同 Python 版本的开发者。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pyenv install 3.13.1           <span style="color:#998;font-style:italic"># 安装特定 Python 版本</span>
</span></span><span style="display:flex;"><span>pyenv virtualenv 3.13.1 myenv  <span style="color:#998;font-style:italic"># 创建虚拟环境</span>
</span></span><span style="display:flex;"><span>pyenv activate myenv           <span style="color:#998;font-style:italic"># 激活虚拟环境</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>③ poetry</strong></p>
<p><code>poetry</code> 是一个现代的 Python 包管理和环境管理工具，集成了虚拟环境管理、依赖管理和打包发布功能。</p>
<p>它会自动为每个项目创建和管理一个独立的虚拟环境，避免不同项目之间的依赖冲突。它使用 <code>pyproject.toml</code> 文件来管理项目的依赖关系，并生成 <code>poetry.lock</code> 文件来锁定依赖版本。</p>
<p>它适用于需要精细依赖管理和虚拟环境管理的复杂 Python 项目，特别是开源库开发和发布。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>poetry new my_project     <span style="color:#998;font-style:italic"># 创建新项目</span>
</span></span><span style="display:flex;"><span>poetry add requests       <span style="color:#998;font-style:italic"># 添加依赖</span>
</span></span><span style="display:flex;"><span>poetry install            <span style="color:#998;font-style:italic"># 创建虚拟环境并安装依赖</span>
</span></span><span style="display:flex;"><span>poetry shell              <span style="color:#998;font-style:italic"># 激活虚拟环境</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>综上不难看出， <code>venv</code> 是 Python 内置的虚拟环境工具，功能简单，适合基础需求；<code>pyenv</code> 主要用于管理多个 Python 版本，结合 <code>pyenv-virtualenv</code> 可以管理虚拟环境； <code>poetry</code> 是一个更高级的工具，集成了虚拟环境、依赖管理和打包发布功能，适合复杂项目。</p>
<p>如果你只需要简单的虚拟环境管理，<code>venv</code> 是最轻量、最直接的选择；如果你需要管理多个 Python 版本， <code>pyenv</code> 是更好的选择； 如果你需要强大的依赖管理和项目配置功能， <code>poetry</code> 是最好的选择。</p>
<h3 id="pypi-换源">PyPI 换源</h3>
<p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">pypi | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></p>
<p>在使用 Python 的 <code>pip</code> 安装包时，默认的包下载源是国外的 PyPI（Python Package Index）服务器，可能会因为网络问题导致下载速度慢或失败。为了提高下载速度，可以将 <code>pip</code> 的镜像源设置为国内的镜像站点。</p>
<p>以下是设置 <code>pip</code> 镜像的几种方法：</p>
<p><strong>方法 1：临时使用镜像源</strong></p>
<p>如果你只想临时使用某个镜像源，可以在使用 <code>pip</code> 命令时添加 <code>-i</code> 参数指定镜像源。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 用法 pip install &lt;package_name&gt; -i https://pypi.tuna.tsinghua.edu.cn/simple</span>
</span></span><span style="display:flex;"><span>pip install requests -i https://pypi.tuna.tsinghua.edu.cn/simple
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>方法 2：永久设置镜像源</strong></p>
<p>如果你希望永久使用某个镜像源，可以通过修改 <code>pip</code> 的配置文件来实现。</p>
<p>2.1 修改全局配置文件</p>
<p>在终端中运行以下命令，将镜像源写入 <code>pip</code> 的全局配置文件：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip config <span style="color:#0086b3">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.2 手动编辑配置文件</p>
<ol>
<li>
<p>找到 <code>pip</code> 的配置文件：</p>
<ul>
<li><strong>Windows</strong>：<code>C:\Users\&lt;你的用户名&gt;\pip\pip.ini</code></li>
<li><strong>macOS/Linux</strong>：<code>~/.pip/pip.conf</code></li>
</ul>
</li>
<li>
<p>如果没有配置文件，可以手动创建。</p>
</li>
<li>
<p>在配置文件中添加以下内容：</p>
</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[global]</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">index-url</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">https://pypi.tuna.tsinghua.edu.cn/simple</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>方法 3：使用环境变量</strong></p>
<p>你可以通过设置环境变量来指定 <code>pip</code> 的镜像源。在命令提示符中运行以下命令：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Windows</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">set</span> <span style="color:#008080">PIP_INDEX_URL</span><span style="color:#000;font-weight:bold">=</span>https://pypi.tuna.tsinghua.edu.cn/simple
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># macOS/Linux</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">PIP_INDEX_URL</span><span style="color:#000;font-weight:bold">=</span>https://pypi.tuna.tsinghua.edu.cn/simple
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>常用的国内镜像源</strong></p>
<p>以下是一些常用的国内镜像源，你可以根据自己的需求选择：</p>
<table>
<thead>
<tr>
<th>镜像源名称</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>清华大学</td>
<td><code>https://pypi.tuna.tsinghua.edu.cn/simple</code></td>
</tr>
<tr>
<td>阿里云</td>
<td><code>https://mirrors.aliyun.com/pypi/simple/</code></td>
</tr>
<tr>
<td>中国科技大学</td>
<td><code>https://pypi.mirrors.ustc.edu.cn/simple/</code></td>
</tr>
<tr>
<td>华为云</td>
<td><code>https://repo.huaweicloud.com/repository/pypi/simple</code></td>
</tr>
</tbody>
</table>
<p><strong>总结</strong></p>
<ul>
<li><strong>临时使用</strong>：使用 <code>-i</code> 参数。</li>
<li><strong>永久使用</strong>：修改 <code>pip</code> 配置文件或设置环境变量。</li>
<li><strong>推荐镜像源</strong>：清华大学、阿里云、中国科技大学等。</li>
</ul>
<p>通过设置镜像源，可以显著提高 <code>pip</code> 的下载速度，避免因网络问题导致的安装失败。</p>
<h3 id="切片">切片</h3>
<p>可以这样理解切片，索引指向的是字符<strong>之间</strong>，第一个字符的左侧标为 <code>0</code>，最后一个字符的右侧标为 <code>n</code> ，<code>n</code> 是字符串长度。例如：</p>
<pre tabindex="0"><code> +---+---+---+---+---+---+
 | P | y | t | h | o | n |
 +---+---+---+---+---+---+
 0   1   2   3   4   5   6
-6  -5  -4  -3  -2  -1
</code></pre><h3 id="斐波那契数列">斐波那契数列</h3>
<p><code>&gt; 以斐波那契数为边的正方形拼成的近似的黄金矩形 (1:1.618)</code></p>
<p>![[assets/Pasted image 20241223155202.png|325]]</p>
<p>在数学上，斐波那契数是以递归的方法来定义：</p>
<p>![[assets/Pasted image 20241223155423.png|200]]</p>
<p>用白话文来说，就是斐波那契数列由 0 和 1 开始，之后的斐波那契数就是由之前的两数相加而得出。首几个斐波那契数是：</p>
<pre tabindex="0"><code>1、 1、 2、 3、 5、 8、 13、 21、 34、 55、 89、 144、 233、 377、 610、 987……
</code></pre><p><strong>特别指出</strong>：0 不是第一项，而是第零项（ ![[assets/Pasted image 20241223155936.png]]）。</p>
    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=">
            

        </a>

        
        <a href="/about" target="_blank">
            
            将喜欢的一切留在身边，这便是努力的意义
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">🕊️</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.69); 
                backdrop-filter: saturate(180%) blur(6px);
            
            "></div>
    </body>
</html>
