<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Rime 那些事儿 - https://aituyaa.com/rime-%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">
    <meta name="author" content="Jack - https://aituyaa.com/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Rime 那些事儿</title>
    
    <base target="_blank">
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    
    
    
    
    <link rel="stylesheet" href="https://aituyaa.com/style.min.7a1211384e00d894dc501a9708ae5fb349825c010d5348b62a8727d135f41615.css">
    
    <script>const DARK =  false ;</script>
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        
        <div class="cool-before" style="background: url('/imgs/bg/color.jpg') left top/100% no-repeat fixed;"></div>
        <div id="header" class=""><div class="container-header">

    
    
    
    <div class="right">
        
        <h1 class="title">Rime 那些事儿</h1>
    
        
        
            <div id="toc">📜</div>
        
    </div>
</div>
</div>
        <div id="content">










<div class="container-main container-page ">

    

    
    
    
    <div class="rel">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <div class="curtag-desc">
            <a href="https://aituyaa.com/tags/%E8%BE%93%E5%85%A5%E6%B3%95/"><img src="/imgs/icons/tag.svg" width="16" /> 相关文章：输入法 <sup>12</sup></a>
        </div>

        <div class="curtag-post">
            
            
            
                <div class="curtag-post-item curtag-post-item--active">
                    <a href="https://aituyaa.com/rime-%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">Rime 那些事儿</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/rime_jk-%E6%8C%87%E5%B0%96%E4%B8%8A%E7%9A%84%E6%97%8B%E5%BE%8B/">RIME_JK 指尖上的旋律</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E4%B8%80%E7%A7%8D-rime-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%BD%A2%E7%A0%81%E8%87%AA%E9%80%A0%E8%AF%8D%E7%9A%84%E6%96%B9%E5%BC%8F/">一种 Rime 中添加形码自造词的方式</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E4%B8%80%E7%A7%8D%E8%8E%B7%E5%8F%96%E4%BA%94%E7%AC%94%E5%A4%A7%E8%AF%8D%E5%BA%93%E7%9A%84%E6%96%B9%E5%BC%8F/">一种获取五笔大词库的方式</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E4%B8%87%E8%B1%A1%E6%8B%BC%E9%9F%B3%E7%9A%84%E7%AE%80%E8%A6%81%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">万象拼音的简要使用说明</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E4%BA%94%E7%AC%94%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">五笔那些事儿</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E5%97%A8%E8%99%8E%E7%A0%81/">嗨，虎码</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E5%AE%AB%E4%BF%9D%E6%8B%BC%E9%9F%B3/">宫保拼音</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E5%B0%8F%E9%B9%A4%E5%8F%8C%E6%8B%BC%E5%8F%8A%E9%9F%B3%E5%BD%A2/">小鹤双拼及音形</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E8%87%AA%E7%84%B6%E7%A0%81%E8%BE%85%E5%8A%A9%E7%A0%81%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">自然码辅助码入门教程</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E8%BE%93%E5%85%A5%E6%B3%95%E4%B9%8B%E5%B9%B6%E5%87%BB%E6%96%B9%E6%A1%88/">输入法之并击方案</a>
                </div>
                
                
            
            
                <div class="curtag-post-item ">
                    <a href="https://aituyaa.com/%E8%BE%93%E5%85%A5%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9B%9E%E9%A1%BE%E5%8F%8A%E9%98%B6%E6%AE%B5%E6%80%A7%E6%80%BB%E7%BB%93/">输入法的使用回顾及阶段性总结</a>
                </div>
                
                
        </div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="7409" width="12" height="12">
                <path
                    d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z"
                    p-id="7410" fill="#adb5bd"></path>
            </svg>
            2025-01-06&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="23838" width="11" height="11">
                <path
                    d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z"
                    p-id="23839" fill="#adb5bd"></path>
            </svg>
            2025-05-15&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="33866" width="12" height="12">
                <path
                    d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z"
                    fill="#adb5bd" p-id="33867"></path>
                <path
                    d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z"
                    fill="#adb5bd" p-id="33868"></path>
            </svg>
            55133 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                p-id="32892" width="12" height="12">
                <path
                    d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z"
                    p-id="32893" fill="#adb5bd"></path>
                <path
                    d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z"
                    p-id="32894" fill="#adb5bd"></path>
            </svg>
            111 分钟</span>
        <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/%E8%BE%93%E5%85%A5%E6%B3%95">输入法</a>
			
		</div>
	</div>
</div>
        
    </div>

    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/wiki"><img src="/imgs/icons/wiki.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#rime-佛振的序">Rime 佛振的序</a>
      <ul>
        <li><a href="#自序">自序</a></li>
        <li><a href="#历史">历史</a></li>
        <li><a href="#概念">概念</a></li>
        <li><a href="#项目构成">项目构成</a></li>
        <li><a href="#开发计划">开发计划</a></li>
      </ul>
    </li>
    <li><a href="#rime-架构设计解读">Rime 架构设计解读</a>
      <ul>
        <li><a href="#概念解读">概念解读</a></li>
        <li><a href="#设计与实现">设计与实现</a></li>
      </ul>
    </li>
    <li><a href="#说明书">说明书📖</a>
      <ul>
        <li><a href="#打字入门">打字入门</a></li>
        <li><a href="#部分输入方案的用法">部分输入方案的用法</a></li>
        <li><a href="#用户词典管理">用户词典管理</a></li>
      </ul>
    </li>
    <li><a href="#rime-输入方案">Rime 输入方案</a>
      <ul>
        <li><a href="#必知必会">必知必会</a></li>
        <li><a href="#rime-中的数据文件分布及作用">Rime 中的数据文件分布及作用</a>
          <ul>
            <li><a href="#共享文件夹">共享文件夹</a></li>
            <li><a href="#用户文件夹">用户文件夹</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#详解输入方案">详解输入方案</a>
      <ul>
        <li><a href="#方案定义">方案定义</a></li>
        <li><a href="#输入法引擎与功能组件">输入法引擎与功能组件</a>
          <ul>
            <li><a href="#理解-processors">理解 Processors</a></li>
            <li><a href="#理解-segmentors">理解 Segmentors</a></li>
            <li><a href="#理解-translators">理解 Translators</a></li>
            <li><a href="#理解-filters">理解 Filters</a></li>
          </ul>
        </li>
        <li><a href="#码表与词典">码表与词典</a></li>
        <li><a href="#编译输入方案">编译输入方案</a></li>
        <li><a href="#部署">部署</a></li>
      </ul>
    </li>
    <li><a href="#定制指南">定制指南</a></li>
    <li><a href="#拼写运算-">拼写运算 💥</a>
      <ul>
        <li><a href="#常用术语">常用术语</a></li>
        <li><a href="#功能">功能</a></li>
        <li><a href="#原理与实现-">原理与实现 🌟</a></li>
        <li><a href="#投影算法">投影算法</a></li>
        <li><a href="#在-rime-输入方案中的用法">在 Rime 输入方案中的用法</a></li>
      </ul>
    </li>
    <li><a href="#综合演练">综合演练</a>
      <ul>
        <li><a href="#牛刀小试">牛刀小试</a>
          <ul>
            <li><a href="#一个简单的方案">¹一个简单的方案</a></li>
            <li><a href="#开始改装">²开始改装</a></li>
            <li><a href="#创建候选项">³创建候选项</a></li>
            <li><a href="#编写词典">⁴编写词典</a></li>
            <li><a href="#实现选字及换页">⁵实现选字及换页</a></li>
            <li><a href="#输出中文标点">⁶输出中文标点</a></li>
            <li><a href="#用符号键换页">⁷用符号键换页</a></li>
          </ul>
        </li>
        <li><a href="#修炼之道">修炼之道</a>
          <ul>
            <li><a href="#改造键盘">¹改造键盘</a></li>
            <li><a href="#大写数字键盘">²大写数字键盘</a></li>
            <li><a href="#罗马字之道">³罗马字之道</a></li>
            <li><a href="#用拼写运算定义简码">⁴用拼写运算定义简码</a></li>
          </ul>
        </li>
        <li><a href="#最高武艺">最高武艺</a></li>
        <li><a href="#标准库">标准库</a>
          <ul>
            <li><a href="#关于调试">关于调试</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#方案制作详解">方案制作详解</a>
      <ul>
        <li><a href="#开始之前">开始之前</a></li>
        <li><a href="#描述档">描述档</a></li>
        <li><a href="#开关">开关</a></li>
        <li><a href="#引擎">引擎</a></li>
        <li><a href="#细项配置">细项配置</a>
          <ul>
            <li><a href="#speller"><code>speller</code></a></li>
            <li><a href="#segmentor"><code>segmentor</code></a></li>
            <li><a href="#translator"><code>translator</code></a></li>
            <li><a href="#reverse_lookup_filter"><code>reverse_lookup_filter</code></a></li>
            <li><a href="#simplifier"><code>simplifier</code></a></li>
            <li><a href="#chord_composer"><em><code>chord_composer</code></em></a></li>
            <li><a href="#lua"><code>lua</code></a></li>
            <li><a href="#其它">其它</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#词典详解">词典详解</a>
      <ul>
        <li><a href="#描述档-1">描述档</a></li>
        <li><a href="#配置">配置</a></li>
        <li><a href="#码表">码表</a></li>
        <li><a href="#词典扩展包">词典扩展包</a>
          <ul>
            <li><a href="#概述">概述</a></li>
            <li><a href="#示例">示例</a></li>
            <li><a href="#总结">总结</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#定制指南详解">定制指南详解</a>
      <ul>
        <li><a href="#定制每页候选数">定制每页候选数</a></li>
        <li><a href="#定制标点符号">定制标点符号</a></li>
        <li><a href="#定制简化字输出">定制简化字输出</a></li>
        <li><a href="#默认英文输出">默认英文输出</a></li>
        <li><a href="#定制方案选单">定制方案选单</a></li>
        <li><a href="#定制唤出方案选单的快捷键">定制唤出方案选单的快捷键</a></li>
        <li><a href="#定制小狼毫字体字号">定制小狼毫字体字号</a></li>
        <li><a href="#定制小狼毫配色方案">定制小狼毫配色方案</a></li>
      </ul>
    </li>
    <li><a href="#配置文件详解">配置文件详解</a>
      <ul>
        <li><a href="#语法">语法</a>
          <ul>
            <li><a href="#包含">包含</a></li>
            <li><a href="#补靪">补靪</a></li>
            <li><a href="#用补靪指令修改列表">用补靪指令修改列表</a></li>
            <li><a href="#可选的包含与补靪">可选的包含与补靪</a></li>
            <li><a href="#追加与合併">追加与合併</a></li>
          </ul>
        </li>
        <li><a href="#配置编译器插件">配置编译器插件</a>
          <ul>
            <li><a href="#自动应用补靪">自动应用补靪</a></li>
            <li><a href="#应用默认配置">应用默认配置</a></li>
            <li><a href="#导入成套组件配置">导入成套组件配置</a></li>
          </ul>
        </li>
        <li><a href="#加载规则">加载规则</a></li>
        <li><a href="#配置组件调用方式">配置组件调用方式</a></li>
        <li><a href="#代码风格">代码风格</a></li>
        <li><a href="#错误处理">错误处理</a></li>
        <li><a href="#版本控制">版本控制</a></li>
        <li><a href="#分发">分发</a></li>
      </ul>
    </li>
    <li><a href="#diy-处方集">DIY 处方集</a>
      <ul>
        <li><a href="#初始设定">初始设定</a>
          <ul>
            <li><a href="#在方案选单中添加五笔双拼">在方案选单中添加五笔、双拼</a></li>
            <li><a href="#小狼毫外观设定">【小狼毫】外观设定</a></li>
            <li><a href="#鼠须管外观与键盘设定">【鼠须管】外观与键盘设定</a></li>
          </ul>
        </li>
        <li><a href="#在特定程序里开关中文输入">在特定程序里开关中文输入</a></li>
        <li><a href="#输入习惯">输入习惯</a>
          <ul>
            <li><a href="#使用-control-键切换中西文">使用 Control 键切换中西文</a></li>
            <li><a href="#方便地输入含数字的西文用戶名">方便地输入含数字的西文用戶名</a></li>
            <li><a href="#以方括号键换页">以方括号键换页</a></li>
            <li><a href="#使用西文标点兼以方括号键换页">使用西文标点兼以方括号键换页</a></li>
            <li><a href="#以回车键清除编码兼以分号单引号选字">以回车键清除编码兼以分号、单引号选字</a></li>
            <li><a href="#开关逐键提示">开关逐键提示</a></li>
            <li><a href="#关闭用戶词典和字频调整">关闭用戶词典和字频调整</a></li>
            <li><a href="#关闭码表输入法连打">关闭码表输入法连打</a></li>
            <li><a href="#开关仓颉与拼音混打">开关仓颉与拼音混打</a></li>
            <li><a href="#空码时按空格键清空输入码">空码时按空格键清空输入码</a></li>
          </ul>
        </li>
        <li><a href="#模糊音">模糊音</a>
          <ul>
            <li><a href="#朙月拼音模糊音定制模板">【朙月拼音】模糊音定制模板</a></li>
            <li><a href="#吳語模糊音定制模板">【吳語】模糊音定制模板</a></li>
          </ul>
        </li>
        <li><a href="#编码反查">编码反查</a>
          <ul>
            <li><a href="#设定速成的反查码为粵拼">设定【速成】的反查码为粵拼</a></li>
            <li><a href="#设定仓颉的反查码为双拼">设定【仓颉】的反查码为双拼</a></li>
          </ul>
        </li>
        <li><a href="#在-mac-系统上输入-emoji-表情">在 Mac 系统上输入 emoji 表情</a></li>
        <li><a href="#五笔简入繁出">五笔简入繁出</a>
          <ul>
            <li><a href="#修正不对称繁简字">修正不对称繁简字</a></li>
          </ul>
        </li>
        <li><a href="#活用标点创建自定义词组">活用标点创建自定义词组</a></li>
      </ul>
    </li>
    <li><a href="#lua-脚本开发指南">Lua 脚本开发指南</a>
      <ul>
        <li><a href="#例子输入今天的日期">例子：输入今天的日期</a></li>
        <li><a href="#模块化">模块化</a></li>
        <li><a href="#编程接口">编程接口</a></li>
        <li><a href="#对象接口">对象接口</a></li>
      </ul>
    </li>
    <li><a href="#附录">附录</a>
      <ul>
        <li><a href="#candget_genuinetext--t_cand-为什么没有修改候选项的内容"><code>cand:get_genuine().text = 't_cand'</code> 为什么没有修改候选项的内容</a></li>
        <li><a href="#五笔码表开头的那些属性是什么意思">五笔码表开头的那些属性是什么意思</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <p>说是“输入法那些事儿”，其实主要就是 Rime 那些事儿。商业输入法不怎么用，也就没有什么太多好说的，不过做为参照物可能会略有提及。</p>
<blockquote>
<p>:: 目前可以看成是 Rime Home Wiki 的汇总。 &ndash; 🤣 好嘛，经过两三天的噼里啪啦，终于整合在了一起。原 Wiki 毕竟是 wiki ，内容有些凌乱，后续有时间再慢慢整理、删减、补充吧。</p>
</blockquote>
<h2 id="rime-佛振的序">Rime 佛振的序</h2>
<p>认识 La Rime。</p>
<h3 id="自序">自序</h3>
<p>做这个项目是发自对输入法创新的兴趣，为实验新的输入法而打造一款易于定制的智能输入软件。实现好用的方言拼音输入，也是开发这款软件主要的目标。</p>
<p>乃定名为：<strong>中州韻輸入法引擎 / Rime Input Method Engine</strong></p>
<p>取义历史上通告的中州韵，愿写就一部汇集音韵学智慧的输入法经典之作。</p>
<p>项目网站设在  <a href="http://rime.github.io/">http://rime.github.io/</a>。</p>
<p>感谢 Github ，感谢 Pages。</p>
<p>创造应用价值是一方面，更要坚持对好技术的追求，希望能写出灵动而易于扩展的代码，使其成为一款修改十足的开源输入法。</p>
<h3 id="历史">历史</h3>
<p>2009 年底，佛振按这一思路，借助强大的 IBus 输入法框架和 Python 脚本语言，快速开发出「中州韵」的原型。 2010 年，将这一算法引擎由 Linux 移植到 Windows 平台。 几大方言社区的输入法爱好者创作了粤语、吴语、中古音输入方案，竟做到了用曾经梦想的方式打字。</p>
<p>如今有许多朋友关注并乐於帮忙完善这一软件。俺打盘接受同学们的建议用 C++来写一部正式版。</p>
<h3 id="概念">概念</h3>
<p>相对于最初的实验品，概念没有多大变化。佛振重新来归纳。</p>
<p>组成这个软件系统的对象，我给他粗略分成三类： <strong>逻辑对象、数据对象、交互对象</strong>。</p>
<p>❶  逻辑对象</p>
<p>逻辑对象，各自表达解决输入法中某类问题的算法，以及描述输入法的工作流程。</p>
<p>咱假定，从不同种类的输入法中，可归纳出几种类型的实现机制，即通用于一类输入法的算法和数据结构。</p>
<p><strong>输入法引擎／engine</strong> 佛振把他解读为用来实现输入功能的程序，是这些算法及相关数据结构的总和。</p>
<p>输入法典型的工作流程，大致如此：</p>
<ul>
<li>获取并解释按键动作，每个按键包含键值、按键的状态等信息；</li>
<li>生成、分析按键序列，形成编码串；某些按键并非直接產生编码字符，而有时组成输入串的文字不是按键所对应的字符本身；</li>
<li>查字典，取得输入码对应的同码字词列表；合并、排序……</li>
<li>有时，根据策略需要进一步组词造句；</li>
<li>可能会对结果做出场前的修饰处理，如繁简转换等；</li>
<li>至此，完成了从输入码到文字的翻译，结果是一组将在输入法介面展现的候选文字；</li>
<li>用户确认，文字上屏，完成了一次输入。</li>
</ul>
<p>将这一流程中纯粹的逻辑部份用程序写出来，就是我所形容的输入引擎。</p>
<p>其中不包括：</p>
<ul>
<li>实现编码到文字转换的字典数据，许多方家称「码表」；</li>
<li>经过操作系统与设备和输入目的程序交互的组件；</li>
<li>展现输入法信息的界面；</li>
<li>配置工具。</li>
</ul>
<p>❷ 数据对象</p>
<p>输入法中的数据对象，有输入引擎处理用户输入动作所得的动态数据，又有预先配置到输入法中的输入方案。</p>
<p>若要讲，输入引擎是跨输入法的通用程序，<strong>输入方案／schema</strong> 即是那差异的部份。 输入法引擎配置了不同的输入方案，便是用户视角下、统一框架内的不同输入法。 输入方案按一定的规格撰写，用户可於需要时导入到软件，这便是本项目软件开发者与输入方案创作者分工、协作的方式。</p>
<p>输入方案包含：</p>
<ul>
<li>配置信息，控制着输入引擎的行为；</li>
<li>字典（码表），定义了编码与候选文字的对应关系。</li>
</ul>
<p>为了足够灵活而能支持广泛的输入法类型，在输入方案中，利用 <strong>拼写运算／spelling algebra</strong> 机制在输入码与字典编码之间建立一组映射，以此将个别方案中的特殊检索方式统一到通用的算法。</p>
<p>❸ 交互对象</p>
<p>交互对象，承担与用户交换信息的功能。不同於输入引擎、输入方案的跨平臺特点，交互对象的实现是系统相关的。 具体地有，输入法框架通过操作系统与输入设备、输入目标程序通信；输入法介面显示输入法的状态和输入内容。</p>
<h3 id="项目构成">项目构成</h3>
<p>于是整个工程又可分为若干子项目：</p>
<ul>
<li>librime－输入法引擎；</li>
<li>ibus-rime－Linux 发行版；</li>
<li>weasel／小狼毫－Windows 发行版；</li>
<li>squirrel／鼠须管－Mac 发行版；</li>
<li>plum／东风破－配置管理器及输入方案仓库；</li>
<li>essay／八股文－预设词典及语言模型。</li>
</ul>
<h3 id="开发计划">开发计划</h3>
<p>伟大雄图，还是分期来完成吧。</p>
<p>初创期，完成软件架构和基础功能。</p>
<p>第一期，要把用户体验做到一款正式產品的标準。</p>
<ul>
<li>易用性：操作方式简明，有文档，有配置工具</li>
<li>性能和稳定性：适应主流配置＋日常应用场景</li>
<li>输入效果：优於传统的码表输入法平臺，达到开源输入法的平均水平</li>
</ul>
<p>第二期，兼容更多系统平台。可以尝试一些创新的设计，形成开发者暨输入方案创作者社群。</p>
<p>第三期，添加网络功能，持续优化输入效果；建立输入法创作平臺。</p>
<p>计划於八月初八发表 1.0 版。即完成初创期，进入第一期的初级阶段。</p>
<p>万事开头难，虽然实验版的经验可做参考，让这项目高速运转起来，仍需要大的智慧。</p>
<p>有同学索要文档，却真的没有。千头万绪，未及梳理，暂且概说一番，也可意会创作此软件的思路。</p>
<p>是为之序。</p>
<h2 id="rime-架构设计解读">Rime 架构设计解读</h2>
<h3 id="概念解读">概念解读</h3>
<p>❶ 框架</p>
<p>输入法工作于需要输入文本的程序中，后者就叫它做输入法的「 客户程序 」吧。</p>
<p>如果输入法同时在不同的程序中工作，每个客户程序里的输入内容都是不同的。所以需要每个客户维护输入法状态，术语称输入法「 上下文 / Context 」。</p>
<p>逻辑复杂的输入法，常常有个独立的程序来做运算，便于集中管理词库等资源。Rime 称其为「 服务 / Service 」，形式为一个无界面表现的后台程序 / Backend。</p>
<p>于是输入法的「 前端 / Frontend 」，即输入法在客户程序中的那部分，可依托于后台的服务来运作，自身只关注与操作系统交互，以及将消息向服务转发。</p>
<p>Rime 的 Frontend / Backend 模型，依照 ibus、IMK 等输入法框架来设计：Frontend 不含输入逻辑，甚至不负责绘制输入法界面。因此会比较容易适配现有的输入法框架，不需要自己写很多代码。</p>
<p>在服务中，会为每一个客户建立一个输入法「 会话 / Session 」。从功能上讲，会话是将一系列按键消息变（Convert）为文字的问（Request）答（Response）过程。</p>
<p>技术上讲，会话会负责搞定输入法前端与服务之间的跨进程通信，同时在服务端为前端所代表的客户分配必要的资源。这资源主要是指一部有状态的、懂得所有输入转换逻辑的输入法引擎「 Engine 」。</p>
<p>现在所写的 Rime 库，不做那框架部分，专注于输入引擎的实现。名字也叫「 中州韵输入法引擎 / RIME 」嘛。</p>
<p>这部分定义的代码是 <a href="https://github.com/rime/librime">rime/librime</a> ，under C++ namespace <code>rime</code>。抛开实际的输入法框架，俺先写个控制程序 <code>RimeConsole</code> 来模拟输入，观察 Engine 的输出，以验证其功能是否符合设计。</p>
<p>❷ 引擎</p>
<p>输入法的转换逻辑自然是比较复杂，需要许多元件协同工作。要协同工作，必得组装到一起，外面再加个壳。通常的机器都是如此，有外壳做封装，看不到内部的元件，通过有限的几处开关来操作，用起来比较省心。</p>
<p>Engine 对象，便是 Session 需要直接操作的界面。除此之外，Rime 库还对外提供若干用于输入输出的数据对象。包括它所持有的代表输入法状态的「 上下文 / Context 」对象、描述一份「 输入方案 / Schema 」的配置对象、代表输入按键的 <code>KeyEvent</code> 对象等。</p>
<p>开发者对 Engine 的期望，一是将来可不断通过添加内部组件的方式增益其所不能，二是有能力动态地调整组件的调度，以在会话中切换到不同的输入方式。</p>
<p>为了避免知道得太多，这引擎的内部构造必须精巧，他存在的意义在于接合内部的各种组件，并对外提供可靠的接口：Engine 所表达的逻辑仅限于此。</p>
<p>标准化 Engine内部的「 组件 / Component 」，明确与关键组件之间的对接方式，就可以满足可扩展、可配置这两点期望。</p>
<h3 id="设计与实现">设计与实现</h3>
<p>❶ 组件</p>
<p>为有好的扩展能力，定义一个接口来表示具有某种能力的一类组件；为了达到可在运行时动态配置的目的，采取抽象工厂的设计模式。</p>
<p><code>boost::factory</code> 要求较高版本的 Boost 库，所以我还是用了自家酿造的一套设施来做组件的包装。</p>
<p>原则是，Rime 中完成特定功能的对象，若只有一种实现方法，就写个 C++类 / class ；若有多种实现方法，就写个「 Rime 类 」/ <code>rime::Class</code> 。如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Processor</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">public</span> Class<span style="color:#000;font-weight:bold">&lt;</span>Processor, Engine<span style="color:#000;font-weight:bold">*&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    Processor(Engine <span style="color:#000;font-weight:bold">*</span>engine) <span style="color:#000;font-weight:bold">:</span> enging_(engine) {}
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">virtual</span> <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">ProcessKeyEvent</span>(<span style="color:#000;font-weight:bold">const</span> KeyEvent <span style="color:#000;font-weight:bold">&amp;</span>ke);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">private</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    Engine <span style="color:#000;font-weight:bold">*</span>engine_;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后，大家就可以写各式 Processor 的实现啦…… 当然，还要把每一种实现注册为具名的「 组件 」。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ToUpperCase</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">public</span> Processor {
</span></span><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">public</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  ToUpperCase(Engine <span style="color:#000;font-weight:bold">*</span>engine);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">virtual</span> <span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">ProcessKeyEvent</span>(<span style="color:#000;font-weight:bold">const</span> KeyEvent <span style="color:#000;font-weight:bold">&amp;</span>ke) {
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">char</span> ch <span style="color:#000;font-weight:bold">=</span> ke.ToAscii();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (islower(ch)) {
</span></span><span style="display:flex;"><span>      engine_<span style="color:#000;font-weight:bold">-&gt;</span>CommitChar(ch <span style="color:#000;font-weight:bold">-</span> <span style="color:#d14">&#39;a&#39;</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;A&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#0086b3">false</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">RegisterRimeComponents</span>() {
</span></span><span style="display:flex;"><span>  Registry.instance().Register(<span style="color:#d14">&#34;upper&#34;</span>, <span style="color:#000;font-weight:bold">new</span> Component<span style="color:#000;font-weight:bold">&lt;</span>ToUpperCase<span style="color:#000;font-weight:bold">&gt;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// 注册到各种组件 Registry...
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>用法：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">UsingAProcessor</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// Class&lt;&gt; 模板提供了简便的方法，按名称取得組件
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// Class&lt;T&gt;::Require() 从 Registry中取得 T::Component 的指針
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  <span style="color:#998;font-style:italic">// 而 Component&lt;T&gt; 继承自 T::Component，并实现了其中的纯虛函數 Create()
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Processor<span style="color:#000;font-weight:bold">::</span>Component<span style="color:#000;font-weight:bold">*</span> component <span style="color:#000;font-weight:bold">=</span> Processor<span style="color:#000;font-weight:bold">::</span>Require(<span style="color:#d14">&#34;upper&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">// 利用组件生成所需的对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  KeyEvent key;   <span style="color:#998;font-style:italic">// 输入
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Engine engine;  <span style="color:#998;font-style:italic">// 上屏文字由此输出
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  Processor<span style="color:#000;font-weight:bold">*</span> processor <span style="color:#000;font-weight:bold">=</span> component<span style="color:#000;font-weight:bold">-&gt;</span>Create(<span style="color:#000;font-weight:bold">&amp;</span>engine);
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">bool</span> taken <span style="color:#000;font-weight:bold">=</span> processor<span style="color:#000;font-weight:bold">-&gt;</span>ProcessKeyEvent(key);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">delete</span> processor;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>实际的代码中，会将这个例子改造成 Engine 持有 Processor 对象，并转发输入按键给 Processor。</p>
<p>❷ 框架级组件和基础组件</p>
<p>以 Engine 的视角，可以把各种组件分为框架级组件和基础组件。前者会由 Engine 创建并直接调用，故需要每一类组件定义明确的接口。后者作为实现具体功能的积木，由框架级组件的实现类使用。</p>
<p><strong>¹ 框架级组件</strong></p>
<p>目前设计中规划了三类框架级组件：</p>
<ul>
<li>Processor，处理按键，编辑输入串；</li>
<li>Segmentor，解释输入串「 是什么 」，将输入串分段，标记输入内容的可能类型；</li>
<li>Translator，翻译一段输入，给出一组备选结果。</li>
</ul>
<p>对于每一类组件，Engine 将根据 Schema 中的配置，创建若干实例，并按一定规则调度，从而将复杂的输入法逻辑分解到组件的各种实现里，按输入方案的需求组合。</p>
<p>当 Engine 接到前端传来的按键消息，会顺次调用一组 Processor 的 <code>ProcessKeyEvent()</code> 方法。在这方法里，每个 Processor 可决定是接受并处理该按键，放弃该按键还是给系统做默认处理，还是留给其他的 Processor 来决定。</p>
<p>Processor 的处理结果表现为对 Context 的修改。当某个 Processor 修改了 Context 的编码串时，Engine 获得信号通知，开始切分和翻译的流程。</p>
<p>首先按次序由各 Segmentor 当尝试对编码串分段。通过 N 个回合，将编码串分为 N 个编码段。每一回合中，各 Segmentor 给出从编码串指定位置开始可识别的最长编码序列，及对应的编码类型标签。回合中最长的分段将将被采纳，将该编码段的始末位置及一组编码类型标签记入 Context 中的分段信息。优先级较高的 Segmentor 也可以中止当前回合，从而跳过优先级较低的 Segmentor。</p>
<p>接下来，对每一个编码段，调用各 Translator 做翻译。Translator 可凭借编码类型标签来判断本 Translator 能否完成该编码段的翻译。</p>
<p>每个 Translator 针对一个编码段的翻译结果为 Translation 对象，是用来取得一组候选结果的迭代器。同一编码段由不同 Translator 给出的 Translations，存入 Menu 对象。为了在有大量候选结果的情况下保持效率，Menu 仅在需要时，譬如向后翻页时，才会从 Translation 中取得一定数目的候选结果。Translation 有和其他 Translation 比较的方法，用于根据下一个候选结果的内容，或某种预定的策略来决定候选结果的排序。</p>
<p>Context 中的 Composition，汇总了分段信息、使用者在各代码段对应的 Menu 中所选结果等信息。经过使用者手动确认结果、且未发生编辑动作的编码段，将不再重新分段的处理。</p>
<p><strong>² 基础组件</strong></p>
<ul>
<li>Dictionary ，词典，由编码序列检索候选结果；</li>
<li>UserDictionary，动态的用户词典；</li>
<li>Prism，音节拼写至词典编码的映射；</li>
<li>Algebra，拼写运算规则；</li>
<li>Syllablifier，音节切分算法。</li>
</ul>
<h2 id="说明书">说明书📖</h2>
<p>❶ 专题：</p>
<ul>
<li><a href="https://github.com/rime/home/wiki/Introduction">认识 La Rime</a> - [[#Rime 佛振的序]]</li>
<li><a href="https://github.com/rime/home/wiki/Downloads">下载与安装 </a></li>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide">定制指南</a>（初阶）- [[#定制指南详解]]</li>
<li><a href="https://github.com/rime/home/wiki/RimeWithSchemata">输入方案设计书</a>（中阶） - [[#Rime 输入方案]] → [[#标准库]]</li>
<li><a href="https://github.com/rime/home/wiki/RimeWithTheCode">程序开发</a>（高阶）</li>
</ul>
<p>❷ 第三方文档</p>
<ul>
<li><a href="http://bbs.weiphone.com/read-htm-tid-5108521.html">鼠鬚管試玩心得</a>／lionhoho</li>
<li><a href="https://github.com/halfmoonvic/Rime">致第一次安裝 RIME 的你</a>／半月湾C</li>
<li><a href="https://www.v2ex.com/t/303479">「鼠须管」配置方案分享</a>、 <a href="https://scomper.me/gtd/-shu-xu-guan-de-diao-jiao-bi-ji">「鼠须管」的调教笔记</a>／scomper</li>
<li><a href="https://segmentfault.com/a/1190000005754706">鼠须管输入法 傻瓜版配置 - 基于 rime_pro 增强包</a>／changsj</li>
</ul>
<p>❸ 使用方案选单</p>
<p>下载、安装完成后，试试：</p>
<p>切换到 Rime 输入法，按 F4 键或组合键 Ctrl+<code> 唤出输入方案选单（</code> 键常见於 1 的左方）。这里有 Rime 输入法最常用的选项。</p>
<p>您可立即从方案选单切换到已经启用的输入方案。</p>
<p>另见：从 Rime 输入方案仓库 获取输入方案</p>
<p>如果需要启用其他已安装的方案，或自定义方案，请……</p>
<p>❹ 输入法设定</p>
<p>——参阅《定製指南》，从中瞭解如何自定义方案选单、每页候选个数等全局选项；修改界面外观；以及调整输入方案的工作方式如指定选字、换页的按键、标点符号映射等。</p>
<p>目前仅【小狼毫】配有一组简单的设定面板，包含输入方案选单设定、界面风格设定、用户词典管理。其他发行版可通过修改配置文件后重新部署的方式来定製。</p>
<h3 id="打字入门">打字入门</h3>
<p>以下操作多数是可定製的，此说明书以默认配置为準。</p>
<p>❶ 选字与换页</p>
<p>使用 ↑↓键 定位高亮的候选字，以空格键确认。</p>
<p>在【语句流】风格的输入方案里，以空格键确认后，字词并不立即上屏，而是在输入了句末的标点（，。？！等）或按下回车键（<code>Return</code>）时整个句子上屏。</p>
<p>通常，按数字键可选择序号为该数字的候选；但某些输入方案会以其他按键代替数字键，如【注音】以大写字母选字。</p>
<p>除了可用标準的 <code>Page Up</code>、<code>Page Down</code> 换页之外，大多数输入方案里还设置了以下几组等效的换页键：</p>
<ul>
<li><code>Shift+Tab</code>、<code>Tab</code></li>
<li>符号键 <code>- = </code></li>
<li>符号键 <code>, .</code></li>
</ul>
<p>❷ 令输入码直接上屏</p>
<p>输入编码后，如果不需要候选字而是希望输入码对应的键盘字符直接上屏，可使用回车键（<code>Return</code>）。</p>
<p>注意：【语句流】输入方案不适用。在【语句流】模式下，先按左 <code>Shift</code> 键切换为西文编码，再按回车键确认。</p>
<p>若要输出经过变换的输入码，如带声调的地球拼音、注音符号、仓頡字母等，请在输入编码后按 <code>Shift+回车键</code> 或 <code>Control+回车键</code>。</p>
<p>❸ 使用编辑键</p>
<p>使用 ←→ 键 定位光标插入点「‸」（或显示为「›」），编辑输入码。 也可用来缩短后选词所对应输入码的范围、确认词句的一部分。</p>
<p><code>Home</code>、<code>End</code> 键 快速跳至句首、句末。</p>
<p><code>BackSpace</code>、<code>Delete</code> 键 分别删除光标前、后的编码字符。注意在苹果键盘上前者标註为 Delete，后者通常是组合键 <code>Fn+Delete</code>。</p>
<p><code>Escape</code> 键 清空未完成的输入。</p>
<p>❹ 删除误上屏的错词</p>
<p>不慎上屏了错误的词组，再打同样的编码时，那错词出现在候选栏，令有洁癖的同学十分不爽。这时候可以：</p>
<p>先把选字光标（用上、下键）移到要删除的用户词组上，再按下 <code>Shift+Delete</code> 或 <code>Control+Delete</code>（苹果键盘用 <code>Shift+Fn+Delete</code>）。</p>
<p>只能够从用户词典中删除词组。用於码表中原有的词组时，只会取消其调频效果。</p>
<p>❺ Emacs 风格的编辑键</p>
<p>註：Windows 版本 Alt 组合键不可用。</p>
<pre tabindex="0"><code>↑：Control+p
↓：Control+n
←：Control+b
→：Control+f
上页：Alt+v
下页：Control+v
句首：Control+a
句末：Control+e
回退：Control+h
删除：Control+d
清空：Control+g
删词：Control+k
</code></pre><p>❻ 输入标点符号</p>
<p>按键到标点符号的映射有三种形式：</p>
<ul>
<li>按键对应惟一的符号，按键后直接输出该符号，如「，」</li>
<li>按键对应一组配对的符号，符号交替出现，如「“”」</li>
<li>按键对应多种符号，按键后展现选单。此时可按空格键或回车键确认高亮的符号，反复按该键则选中下一种符号。</li>
</ul>
<p>每一款输入方案，都可以定义两套符号表，以「方案选单」里的选项「半角←→全角」往复切换。</p>
<p>❼ 中西文切换</p>
<p>打开「方案选单」，使用选项「中文←→西文」可在两种转换状态间往复切换。</p>
<p>此外，默认可用左右 <code>Shift</code> 键快速切换。</p>
<p>在输入了部分编码的情况下，左 <code>Shift</code> 将这些编码临时转还为西文。编辑临时转换的西文并以回车键上屏后，自动回复中文状态。</p>
<p>在输入了部分编码的情况下，右 <code>Shift</code> 将上屏当前的候选字，并进入西文模式。</p>
<p>以上可总结为：左 <code>Shift</code> 切换输入法光标左面的编码内容，右 <code>Shift</code> 切换光标右面即将输入的内容。</p>
<p>注意：Mac 系统上的鼠鬚管不能区分左、右 <code>Shift</code> ，因此左、右 <code>Shift</code> 键的作用一样。</p>
<p>❽ 繁简字切换</p>
<p>Rime 输入法词库多以传统汉字编排。</p>
<p>因为有 OpenCC 提供準确而高效的繁→简转换功能，大多数输入方案都可以从「方案选单」里选择「汉字←→汉字」的选项来启用或停用繁简转换。</p>
<p>码表为简化字的方案如【五笔】、【袖珍简化字拼音】等，不提供这个选项。</p>
<h3 id="部分输入方案的用法">部分输入方案的用法</h3>
<p>❶ 朙月拼音</p>
<p>与时下流行的拼音输入法相近。默认安装后将使用此方案。 其词典包含 Rime 内置的【八股文】繁体词库。设有繁简转换的开关。</p>
<p>敲 <code>~</code> 键开始用 hspnz 输入五笔画（横竖撇捺折），反查五笔编码。需要安装【五笔画】以启用反查。</p>
<p>以下有若干输入方案衍生自朙月拼音，如【语句流】、各式双拼、【宫保拼音】。还有不少方案使用朙月拼音作反查码。</p>
<p>《定製指南》提供了模糊音定製方法及代码模板。</p>
<p>❷ 语句流</p>
<p>揉合了语句输入的按键习惯，以及词组输入逐词确认的操作节奏。</p>
<p>句中空格键的运用，既起到明确词边界、弥补长句转换精度不足的作用，又很好地模仿了西文以空格断词的惯用法。</p>
<p>配合 Mac、IBus 版本内嵌预编辑文字的特性，体验更佳。</p>
<p>❸ 双拼</p>
<p>基於【朙月拼音】製作了几种流行的双拼方案：自然码、MSPY、智能 ABC、小鹤双拼、拼音加加等。</p>
<p>双拼与【朙月拼音】、语句流输入方案共用一份码表和用户词典。</p>
<p>实现双拼的关键，是用 Rime 的「拼写运算」技术建立双拼输入码到全拼的映射表，从而对接朙月拼音词典。在《输入方案设计书》中有一个完整的代码示例。</p>
<p>❹ 宫保拼音</p>
<p>仍是基於【朙月拼音】，採用源自西方速录技术的多键并击方式，双手共七指操作键盘，一击输入一个拼音音节。</p>
<p>宫保拼音 / Combo Pinyin 自从 2007 年创製以来，经歷十数次修订，孜孜以求一套直观易用，并且兼顾 PC 键盘上操作舒适度的键位佈局。</p>
<p>宫保拼音专题介绍</p>
<p>❺ 地球拼音</p>
<p>支持标註声调的拼音输入法。</p>
<p>以形似的符号 - / &lt; \ 附加在拼音音节的末尾，分别表示阴平、阳平、上声、去声。轻声不标。</p>
<p>为按键方便故，也可使用 ; / , &gt; 来标註。</p>
<p>声调、韵母在输入常用短语时可以省略，而成为简拼。因此本方案既兼容了无声调拼音输入法的打字习惯，又可在输入生僻字词时通过输入声调筛选出同音同调者。</p>
<p>因为对应相同的音系，【地球拼音】与【注音】共享词典，却不与【朙月拼音】相通。</p>
<p>❻ 注音</p>
<p>注音符号输入法。使用最广泛的「大千式」键盘排佈。</p>
<p>但其操作层面不同於传统的注音输入法，而是採取「无模式」的设计，与 Rime 里的其他输入方案达成统一。 所谓「无模式」，是指输入注音码，会即时显示出候选字，而不似传统的注音输入法需要另行呼出选字窗口。</p>
<p>Rime【注音】输入方案，允许省略声调（包含作为第一声的空格键）以及某些音节（非零声母且声母不能自成音节者）的韵母部分。 当省略声调时，可连续输入后一个音节，或间以隔音符号「 &rsquo; 」表明前一音节结束。</p>
<p>此外，【注音】採用了语句流的按键习惯，以回车键确认上屏；在输入了声调的音节后，以空格键选定高亮的字词。</p>
<p>为了在输入注音码的同时展现候选字，候选的序号改为大写字母 ABCDE 等，以避开定义为注音符号的数字键。 要选用当页第二个候选字，可按↓键、再按空格键选定第二字，又可按下 Shift+B 键直接选取。</p>
<p>一些标点符号由於所在按键用作输入注音符号的原因而有所调整：</p>
<ul>
<li>逗号， Shift+,</li>
<li>句号。 Shift+.</li>
<li>分号； Shift+;</li>
<li>／号 Shift+/</li>
<li>减号 Shift+- 规则很简单：符号键被注音字母佔用时，加打上档键 Shift 从符号列表中选取。</li>
</ul>
<p>❼ 仓頡</p>
<p>第五代仓頡输入法。</p>
<p>默认，通过仓頡码检出的候选字限制在「通用字符集」，排除了 Unicode CJKV 扩展区汉字。</p>
<p>需要输入大量古字、生僻字的专业用户，请在「方案选单」中切换一次形如「通用 → 增广」的字符集过滤开关，即可输入七万餘简繁汉字。</p>
<p>註：您的系统可能需要安装专门的字体方可正确显示汉字全集。参考《定製指南》为 Rime 输入法设定用於显示候选文字的字体。</p>
<p>以拼音输入单字、常用词组，可反查仓頡码。需要安装【朙月拼音】以启用反查。仓頡码与拼音重码时，仓頡码查到的候选字优先。 亦可按引导键 <code>~</code> 进入拼音反查。</p>
<p>看到候选字一旁有「阴阳鱼 ☯」记号？</p>
<p>:-D 这表示，该候选词组并不存在於码表中，而是通过「混元编码器」產生、或由已知字码自动组合而成的结果。您需要确认一下这是否恰是你想要的词。 Rime 的后续版本将不断改进算法，在输入码未命中码表时，推测出更有意义的文字，越来越「懂我心意」。</p>
<p>❽ 速成</p>
<p>取仓頡首尾二码，简单快速地连续输入词、句，且支持仓頡全码、速成码混合输入。编码虽是基於字形，智能组词、调频等特性与拼音输入法别无二致。</p>
<p>❾ 五笔</p>
<p>五笔字型 86 版。简化字优先，兼收繁体字。包含小规模的词库。</p>
<p>敲 z 键开始转为简体拼音字词输入，反查五笔编码。需要安装【袖珍简化字拼音】以启用反查。</p>
<p>另有【五笔·拼音】混合输入的方案。在这款方案里，可直接以五笔或拼音码输入字、词而无须转换。输入拼音码时，若候选字、词编入了五笔码表，则在候选字一旁提示其五笔码。</p>
<p>❶⓿ 粤拼</p>
<p>以「香港语言学学会粤语拼音方案（粤拼）」输入广府话。</p>
<p>敲引导键 <code>~</code> 之后，开始输入汉语拼音（普通话）反查粤拼。需要安装【朙月拼音】以启用反查。</p>
<p>输入不完整的粤拼编码、或当拼写错误被自动纠正时，候选字、词加註完整的粤拼编码提示。 （注意：由於码表并未全部经过人工校对，程序自动注音的结果可能使提示中多音字的标註出现错误！请不要把输入法的提示当作标準学习而受误导！）</p>
<p>❶❷ 吴语</p>
<p>以「吴语拉丁式注音法」输入上海话、苏州话。</p>
<p>敲引导键 <code>~</code> 之后，开始输入汉语拼音（普通话）反查吴语拼写。需要安装【朙月拼音】以启用反查。</p>
<p>《定製指南》提供了模糊音定製方法及模板。</p>
<h3 id="用户词典管理">用户词典管理</h3>
<p>从【小狼毫】开始菜单或托盘图标的右键菜单中打开「用户词典管理」介面。</p>
<p>左侧列表为已使用的用户词典，以词典名表示，如 luna_pinyin 。 注意词典与输入方案可能是一对多的关系。</p>
<p>❶ 命令行工具</p>
<p>【中州韵】和【鼠鬚管】暂无图形工具，可取得 librime 编译產出的工具程序 bin/rime_dict_manager 通过命令行方式实现以下功能。</p>
<p>执行 rime_dict_manager 之前需要关闭正在使用的输入法，释放以独佔方式打开的词典文件。</p>
<p>请，将工作目录设为「Rime 用户资料夹」。在此执行 rime_dict_manager 查看所支持的参数及命令格式；加上参数 &ndash;list 查看用户词典列表。</p>
<p>❷ 备份及合併词典快照</p>
<p>Rime 输入法在使用中会在一定时间自动将用户词典备份为快照文件 <code>*.userdb.txt </code>。 也可使用管理工具，备份指定的用户词典到快照文件。</p>
<p>备份到快照中的打字习惯，可回复到新建立的或其他系统上的用户词典。</p>
<p>执行合併词典快照操作，只须选定要合併的 .userdb.txt 文件，因为快照中已记录了所属词典的名称。</p>
<p>你不必担心来自快照的词条已存在於用户词典的情况；词频更新为二者的较大值，其他参数亦会按照合理的算法叠加。</p>
<p>❸ 导出及导入文本码表</p>
<p>将用户词典导出为文本码表，便於直接阅读，或批量添加词条到 *.dict.yaml 。</p>
<p>导出的文本格式与 Rime 静态码表的格式相同：以製表符（Tab）分隔的三列，分别是文字、编码、使用频次。其中，编码是码表中定义的完全形式，多个音节间以空格。</p>
<p>如此导出的文本码表，可反向导入到指定的用户词典。但是，文本码表所含信息不如快照全面，因此为了不损失输入效果，请儘量使用 合入快照 的方式转移用户资料。</p>
<p>由於文本码表用户可以编辑，导入时无法检查码表内容是否与选定的词典相匹配，请 当心 莫要导入到错误的词典中去了。</p>
<p>❹ 导入其他来源的码表</p>
<p>推荐的作法是，将码表导入到固态词典，而非用户词典。</p>
<p>请参考以下两个示例：</p>
<p><a href="https://gist.github.com/lotem/5443073">https://gist.github.com/lotem/5443073</a></p>
<p><a href="https://github.com/rime-aca/dictionaries">https://github.com/rime-aca/dictionaries</a></p>
<p>特别地，如果要用新码表的内容完全取代原有的 luna_pinyin 词典，则无须以上步骤： 将编写好的新词典命名为 luna_pinyin.dict.yaml 放置於 Rime 的「用户文件夹」，重新部署即可。</p>
<p>如果你认定要将码表导入已存在的用户词典，则要注意：</p>
<ul>
<li>码表文件的格式是否 Rime 所要求的 UTF-8 (no BOM) 编码</li>
<li>文本行是否为製表符分隔，至少有文字、编码两列，及一列可选的频次</li>
<li>文字的字形（繁、简字）是否与源码表一致</li>
<li>编码的形式是否源码表中定义的标準形式</li>
</ul>
<p>第一点，有一臺专业的文本编辑器就控制住啦。比如 VIM 里面用命令</p>
<pre tabindex="0"><code>:set fenc=utf8 nobomb ff=unix
</code></pre><p>转换、保存文件就中啦。</p>
<p>第二点，如果来源文件的资料格式不同，就需要藉助 regex 批量替换的操作，或写脚本来完成转换。</p>
<p>只有词条、没有编码？请重新考虑先时我提出的建议。因为，製作固态词典，可以利用【八股文】，以及自动编码器。</p>
<p>第三点，如果字形与目标词典不一致，推荐用 OpenCC 完成码表的繁、简转换。</p>
<p>第四点，凡是编码为源码表中未出现过的形式，如通过「拼写运算」实现的简拼、异拼，又如编码中的拼写错误，都将导致该条记录成为用户词典中的无效数据，因为无法通过正常的输入检索到。</p>
<p>❺ 同步用户资料</p>
<p>藉助移动存储设备，或在线存储服务如 Dropbox，在多臺电脑及不同系统之间同步用户词典和用户设定。</p>
<p>¹ 设定同步位置</p>
<p>默认地，词典快照备份到 RIME 用户文件夹\sync\UUID 这个地方。如果你要用 Dropbox 或 U 盘在不同机器/系统之间同步用户词典，则需要设定同步的目标文件夹，如 <code>D:\Dropbox\RimeSync</code> 。</p>
<p>直接编辑用户文件夹下的 <code>installation.yaml</code> ，添加：</p>
<pre tabindex="0"><code>sync_dir: &#39;D:\Dropbox\RimeSync&#39;
</code></pre><p>又如 Mac 上添加：</p>
<pre tabindex="0"><code>sync_dir: &#39;/Users/fred/Dropbox/RimeSync&#39;
</code></pre><p>又如使用 USB 存储来同步：（真实案例）</p>
<pre tabindex="0"><code>sync_dir: &#39;/Volumes/USBDRIVE/RimeSync&#39;
</code></pre><p>默认地，每套 Rime 会随机生成一个 UUID 作为标识。不同 installation ID 可区分来自不同机器/系统的用户词典。</p>
<p>与安装在其他系统上的 Rime 同步后，同步文件夹呈如下佈局：</p>
<pre tabindex="0"><code>D:\Dropbox\RimeSync\id-xxx\luna_pinyin.userdb.txt
D:\Dropbox\RimeSync\id-xxx\terra_pinyin.userdb.txt
D:\Dropbox\RimeSync\id-xxx\installation.yaml
D:\Dropbox\RimeSync\id-xxx\default.custom.yaml
D:\Dropbox\RimeSync\id-xxx\weasel.custom.yaml

D:\Dropbox\RimeSync\id-yyy\terra_pinyin.userdb.txt
D:\Dropbox\RimeSync\id-yyy\installation.yaml
D:\Dropbox\RimeSync\id-yyy\default.custom.yaml
D:\Dropbox\RimeSync\id-yyy\squirrel.custom.yaml

D:\Dropbox\RimeSync\id-zzz\luna_pinyin.userdb.txt
D:\Dropbox\RimeSync\id-zzz\installation.yaml
D:\Dropbox\RimeSync\id-zzz\alternative.yaml
D:\Dropbox\RimeSync\id-zzz\luna_pinyin.custom.yaml
</code></pre><p>同步时，依次将各子文件夹中的词典快照合併到用户词典，最后为合併后的用户词典生成一份新的快照文件。 另外，还会把用户文件夹中非自动生成的 YAML 文件及 .txt 文件单向 备份 到同步文件夹。</p>
<p>有些特别讲究命名的用家，不喜随机生成的 UUID，可编辑 <code>installation.yaml</code> ，取一个有意义的 ID，如：</p>
<pre tabindex="0"><code>installation_id: &#39;fred-win7-desktop&#39;
</code></pre><p>又如：</p>
<pre tabindex="0"><code>installation_id: &#39;fred-macbook&#39;
</code></pre><p>当心！因为 Rime 要以这个 ID 为名创建文件夹，因此 ID 不得包含（所有涉及同步的文件系统）文件名中非法的字符；建议不要用中文，只用小写字母、数字、横线和下划线。</p>
<h2 id="rime-输入方案">Rime 输入方案</h2>
<p><strong>Rime 是什么呢？</strong> Rime 不是一种输入法。它是从各种常见键盘输入法中提炼出来的抽象的输入算法框架。因为 Rime 涵盖了大多数输入法的「 共性 」，所以在不同的设定下，Rime 可以化身为不同的输入法来打字。</p>
<p><strong>Rime 输入法方案又是什么？</strong></p>
<p>要让 Rime 实现某种具体输入法的功能，就需要一些数据来描述这些输入法以何种形式工作。即，定义该输入法的 「 个性 」。</p>
<p>如 「 汉语拼音、注音、仓颉码、五笔字型 」，这些方法可凭借 Rime 提供的通用设施，给定不同的工作参数来实现。以本文介绍的规格写成一套套的方案，就是 Rime 输入方案。</p>
<p><strong>文本为王。</strong> Rime 的配置文件、输入方案定义及词典文件，均为特定格式的文本文档。Rime 中所有文本文档，均要求以 UTF-8 编码，并建议使用 UNIX 换行符 <code>LF</code> 。</p>
<p>鉴于一些文本编辑器会为 UTF-8 编码的文件添加 BOM 标记，为防止误将该字符混入文中，不要从文件每一行开始正文，而应该在该行行首以 <code>#</code> 符号起一行注释。如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Rime default settings</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># Rime schema: My First Cool Schema</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># Rime dictionary: Lingua Latina</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>也可继续以注释行写下方案简介、码表来源、制作者、个性记录等信息，再切入正文。</p>
<h3 id="必知必会">必知必会</h3>
<p>Rime 输入法中，多用扩展名为 <code>.yaml</code> 的文本文档，这是以一种可读性高的数据描述语言 YAML 写成。</p>
<p>你可以访问 <a href="https://yaml.org/">YAML文档 </a> 了解 YAML 文档格式。正文只对部分语法作简要说明，而将重点放在对语义的解读上面。</p>
<p>Rime 输入方案亦会乃至正则表达式实现一些高级功能。它采用 Perl 正则表达式语法，了解更多 <a href="https://www.boost.org/doc/libs/1_49_0/libs/regex/doc/html/boost_regex/syntax/perl_syntax.html">Perl 正则表达式</a>。</p>
<h3 id="rime-中的数据文件分布及作用">Rime 中的数据文件分布及作用</h3>
<p>除程序文件以外，Rime 还包换多种数据文件。这些数据文件存在于以下位置：</p>
<p><a href="https://github.com/rime/home/wiki/SharedData">共享文件夹</a></p>
<ul>
<li>【中州韵】 <code>/usr/share/rime-data/</code></li>
<li>【小狼毫】 <code>&quot;安裝目錄\data&quot;</code></li>
<li>【鼠须管】 <code>&quot;/Library/Input Methods/Squirrel.app/Contents/SharedSupport/&quot;</code></li>
</ul>
<p><a href="https://github.com/rime/home/wiki/UserData">用戶文件夹</a></p>
<ul>
<li>【中州韵】 <code>~/.config/ibus/rime/</code> （0.9.1 以下版本为 <code>~/.ibus/rime/</code>；fcitx5 为 <code>~/.local/share/fcitx5/rime/</code>）</li>
<li>【小狼毫】 <code>%APPDATA%\Rime</code></li>
<li>【鼠须管】 <code>~/Library/Rime/</code></li>
</ul>
<p>共享文件夹包含预设输入方案的源文件。这些文件属于 Rime 所发行软件的一部分，在访问权限控制较严格的系统上对用户是只读的，因此谢绝软件版本更新以处的任何修改 &ndash; 一旦用户个性这里的文件，很可能影响后续的软件升级或在升级时丢失数据。</p>
<p>在 <a href="https://github.com/rime/home/wiki/CustomizationGuide#%E9%87%8D%E6%96%B0%E4%BD%88%E7%BD%B2%E7%9A%84%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95">部署</a> 操作时，将用到这里的输入方案源文件、并组合用户定制的内容来编译预设输入方案。</p>
<p><a href="https://github.com/rime/home/wiki/UserData">用户文件夹</a> 则包含为用户准备的内容，如：</p>
<ul>
<li>〔全局设定〕 <code>default.yaml</code></li>
<li>〔发行版设定〕 <code>weasel.yaml</code></li>
<li>〔预设输入方案副本〕 <code>&lt;方案标识&gt;.schema.yaml</code></li>
<li>※〔安装信息〕 <code>installation.yaml</code></li>
<li>※〔用户状态信息〕 <code>user.yaml</code></li>
</ul>
<p>编译输入方案所产出的二进制文件：</p>
<ul>
<li>〔Rime 棱镜〕 <code>&lt;方案标识&gt;.prism.bin</code></li>
<li>〔Rime 固定词典〕 <code>&lt;词典名&gt;.table.bin</code></li>
<li>〔Rime 反查词典〕 <code>&lt;词典名&gt;.reverse.bin</code></li>
</ul>
<p>记录用户写作习惯的文件：</p>
<ul>
<li>※〔用户词典〕 <code>&lt;词典名&gt;.userdb/</code> 或 <code>&lt;词典名&gt;.userdb.kct</code></li>
<li>※〔用户词典快照〕 <code>&lt;词典名&gt;.userdb.txt</code>、<code>&lt;词典名&gt;.userdb.kct.snapshot</code> 见于同步文件夹</li>
</ul>
<p>以及用户自己设定的：</p>
<ul>
<li>※〔用户对全局设定的定制信息〕 <code>default.custom.yaml</code></li>
<li>※〔用户对预设输入方案的定制信息〕 <code>&lt;方案標識&gt;.custom.yaml</code></li>
<li>※〔用户自制输入方案〕及配套的詞典源文件</li>
</ul>
<p>注：以上标有 ※ 号的文件，包含用户资料，在清理文件時要注意备份！</p>
<h4 id="共享文件夹">共享文件夹</h4>
<p>存放由本机多个用户共享的文件，通常由输入法安装程序写入。</p>
<p>Rime 输入法在查找一项资源的时候，会优先访问 用户文件夹 中的文件。 用户文件不存在时，再到共享文件夹中寻找。</p>
<p>一些 Linux 发行版可由 rime-data 软件包安装常用数据文件到这里。或用 <code>/plum/ </code>编译安装。</p>
<p>❶ 位置</p>
<p>librime 允许输入法指定共享文件夹的位置。</p>
<ul>
<li>小狼毫： <code>&lt;安装目录&gt;\data</code></li>
<li>鼠鬚管： <code>&quot;/Library/Input Methods/Squirrel.app/Contents/SharedSupport&quot;</code></li>
<li>ibus-rime, fcitx-rime: <code>/usr/share/rime-data </code>（编译时可配置）</li>
</ul>
<p>❷ 内容</p>
<p>输入方案、韵书、默认配置源文件：</p>
<ul>
<li><code>&lt;输入方案代号&gt;.schema.yaml</code>: 用户下载或自定义的 输入方案。</li>
<li><code>&lt;韵书代号&gt;.dict.yaml</code>: 用户下载或自定义的 韵书。</li>
<li><code>&lt;词典名称&gt;.txt</code>: 文本格式的词典，如预设词汇表。</li>
</ul>
<p>也可以包含编译后的机读格式，从而省去用户部署时从相同源文件再次编译的步骤：</p>
<ul>
<li><code>build/*</code> 快取文件。为使输入法程序高效运行，预先将配置、韵书等编译为机读格式。</li>
</ul>
<p>註： librime 1.3 版本之前，编译后的快取文件直接存放在共享文件夹，与源文件并列。</p>
<p>其他：</p>
<ul>
<li><code>opencc/*</code> - OpenCC 字形转换配置及字典文件。</li>
</ul>
<h4 id="用户文件夹">用户文件夹</h4>
<p>Rime 从「用户文件夹」读取用家自订的配置。</p>
<p>输入法运行时保存的数据如 用户词典、安装信息、选项状态等也放在这里。</p>
<p>❶ 位置</p>
<p>librime 允许输入法指定用户文件夹的位置。</p>
<p>用户文件夹的位置应使用绝对路径。请勿使用相对路径。</p>
<ul>
<li>小狼毫： 用户文件夹的默认路径为 <code>%APPDATA%\Rime</code>。也可以通过「开始菜单＼小狼毫输入法＼用户文件夹」打开。</li>
<li>鼠鬚管： 用户文件夹的路径为 <code>~/Library/Rime</code>。也可以通过「系统输入法菜单／鼠鬚管／用户设定…」打开。</li>
<li>ibus-rime: <code>~/.config/ibus/rime</code></li>
<li>fcitx-rime: <code>~/.config/fcitx/rime</code></li>
<li>fcitx5-rime: <code>~/.local/share/fcitx5/rime/</code></li>
</ul>
<p>❷ 内容</p>
<p>用家下载或定製的文件：</p>
<ul>
<li><code>&lt;输入方案代号&gt;.schema.yaml</code> - 用户下载或自定义的 输入方案。</li>
<li><code>&lt;韵书代号&gt;.dict.yaml</code> - 用户下载或自定义的 韵书。</li>
<li><code>&lt;词典名称&gt;.txt</code> - 文本格式的词典，如预设词汇表、用户 自定义词组。</li>
<li><code>&lt;配置代号&gt;.custom.yaml</code> - 应用於配置文件 <code>&lt;配置代号&gt;.schema.yaml</code> 或 <code>&lt;配置代号&gt;.yaml</code> 的 补靪。</li>
<li><code>opencc/*</code> - OpenCC 字形转换配置及字典文件。</li>
</ul>
<p>输入法程序记录的使用习惯等信息：</p>
<ul>
<li><code>&lt;输入法语言代号&gt;.userdb/</code> - 输入法程序为保存用户的输入习惯而创建的 用户词典。</li>
<li><code>installation.yaml</code> - 安装信息。输入法程序在首次运行及升级后写入安装、升级时间、程序版本等。</li>
<li><code>user.yaml</code> - 用户状态信息。包括在 方案选单 选取的输入方案、输入法选项状态如「中／西」「简／繁」等。</li>
</ul>
<p>部署时生成的文件：</p>
<ul>
<li><code>build/*</code> - 快取文件。为使输入法程序高效运行，在部署过程中将配置、韵书等编译为机读格式。</li>
<li><code>trash/*</code> - 失效的文件。因 Rime 升级而不再使用的旧文件会自动移入这个文件夹。用家确认不再需要后可以删除。</li>
</ul>
<p>註：librime 1.3 版本之前，编译后的快取文件（包括应用了补靪的 YAML 配置）直接存放在用户文件夹；librime 升级后将其移入 trash/。如果某个 YAML 源文件已经找不到了，无法在升级后重新编译，可以从 <code>trash/</code> 里面找回一份副本。</p>
<h2 id="详解输入方案">详解输入方案</h2>
<p>想要了解更多更全面吗？ <a href="https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md">雪齐的文档 </a> 全面而详细解释了输入方案及词典中各项设定各设定项的含义及用法。</p>
<h3 id="方案定义">方案定义</h3>
<p>一套输入方案，通常包含 「 方案定义 」和 「 词典 」文件。</p>
<p>方案定义，命名为 <code>&lt;方案标识&gt;.schema.yaml</code>，是一份包含输入方案配置信息的 YAML 文档。</p>
<p>文档中需要有这样一组方案描述：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 以下代码片段节选自 luna_pinyin.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>luna_pinyin<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>朙月拼音<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;0.9&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">author</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- 佛振 &lt;chen.sst@gmail.com&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">description</span>:<span style="color:#bbb"> </span>|<span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    </span><span style="color:#bbb">    </span>Rime 预设的拼音输入方案。<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>首先来为方案命名。<code>schema/name</code> 字段是显示在 〔 方案选单 〕中的名称。</p>
<p>然后，重点是要定一个在整个 Rime 输入法中唯一的「 方案标识 」，即 <code>schema/schema_id</code> 字段的内容。方案标识由小写字母、数字、下划线构成。仅于输入法内部使用，且会构成方案定义文件名的一部分，因此为了兼容不同的文件系统，不要用大写字母、汉字、空格和其他符号做方案标识。如：这款名为〔 朙月拼音 〕的输入方案，方案标识为 「 <code>luna_pinyin</code> 」。</p>
<p>方案如做升级，通过版本号 <code>schema/version</code> 来区分相互兼容的新旧版本。版本号是以 <code>.</code> 分隔的整数或文字构成的字符串。如下都是版本号常见的形式：</p>
<pre tabindex="0"><code>&#34;1&#34;      # 最好加引号表明是字符串！
&#34;1.0&#34;    # 最好加引号表明是字符串！
&#34;0.9.8&#34;
&#34;0.9.8.custom.86427531&#34;  # 这种形式是经过用户自定义的版本：自动生成
</code></pre><p>然而，若对方案的升级会导致原有的用户输入习惯无法在新的方案中继续使用，则需要换个新的方案标识。</p>
<p>比如仓颉五代之于仓颉三代，五笔 98 之于五笔 86，其实已是互不兼容的输入法。</p>
<p><code>schema/author</code> ——列出作者和主要贡献者，格式为文字列表：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">author</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- 作者甲 &lt;alpha@rime.org&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- 作者乙 &lt;beta@rime.org&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- 作者丙<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>schema/description</code> ——对方案作简要介绍的多行文字。</p>
<p>以上 <code>schema/schema_id</code>、<code>schema/version</code> 字段用于在程序中识别输入方案，而 <code>schema/name</code>、<code>schema/author</code>、<code>schema/description</code> 则主要是展示给用户的信息。</p>
<p>除方案描述外，方案定义文件中还包含各种功能设定，控制着输入法引擎的工作方式。</p>
<h3 id="输入法引擎与功能组件">输入法引擎与功能组件</h3>
<p>以下是 Rime 输入法的工作流程：</p>
<pre tabindex="0"><code>按键消息 → 后台「 服务 」 → 分配给对应的「 会话 」→ 由「 方案选单 」或「 输入引擎 」处理……
</code></pre><p>这里要点是，有会话的概念：多窗口、多线操作嘛，你懂得的，同时与好几位 MM 聊天时，有没有好几组会话。每一组会话中都有一部输入引擎完成按键序列到文字的变换。</p>
<p>Rime 可以在不同会话里使用不同输入方案。因为有「 方案选单 」。方案选单本身可响应一些按键。但由于它不会写字的缘故，更多时候要把按键传递给同一会话中的「 输入引擎 」继续处理。方案选单的贡献，就是给用户一个便捷的方案切换介面，再把用户挑中的输入方案加载到输入引擎。</p>
<p>让我们看一下输入引擎的工作流程：</p>
<pre tabindex="0"><code>加载输入方案、预设功能组件 → 各就各位之后就进入处理按键消息、处理按键消息……的循环
</code></pre><p>响应各种按键、产生各类结果的工作，由不同的功能组件分担。</p>
<p>好，看代码：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">                          </span><span style="color:#998;font-style:italic"># === 输入引擎设定 ===</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">                    </span><span style="color:#998;font-style:italic"># » ¹这批组件处理各类按键消息 </span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- ascii_composer            <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 处理西文模式及中西文切换</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- recognizer                <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 与 matcher 搭配，处理符合特定规则的输入码，如网址、反查等</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- key_binder                <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 在特定条件下将按键绑定到其他按键，如重定义逗号、句号为候选翻页键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller                   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 拼写处理器，接受字符按键，编辑输入码</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator                <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 句读处理器，将单个字符按键直接映射为文字符号</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector                  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 选字处理器，处理数字选字键、上、下候选定位、换页键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- navigator                 <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 处理输入栏内的光标移动键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor            <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 编辑器，处理空格、回车上屏、回退键等</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">                    </span><span style="color:#998;font-style:italic"># » ²这批组件识别不同内容类型，将输入码分段 </span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- ascii_segmentor           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 标识西文段落</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- matcher                   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 标识符合特定规则的段落，如网址、反查等</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- abc_segmentor             <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 标识常规的文字段落</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_segmentor           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 标识句读段落</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor        <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 标识其他未标识段落</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">                   </span><span style="color:#998;font-style:italic"># » ³这批组件翻译特定类型的编码段为一组候选文字 </span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- echo_translator           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 没有其他候选字时，回显输入码</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_translator          <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 转换标点符号</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- script_translator         <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 脚本翻译器，用于拼音等基于音节表的输入方案</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- reverse_lookup_translator <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 反查翻译器，用另一种编码方案查码</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">filters</span>:<span style="color:#bbb">                       </span><span style="color:#998;font-style:italic"># » ⁴这批组件过滤翻译的结果</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- simplifier                <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 繁简转换</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- uniquifier                <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 过滤重复的候选字，有可能来自繁简转换</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注：除示例代码中引用的组件外，尚有</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- fluid_editor     <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 句式编辑器，用于以空格断词、回车上屏的「 注音、语句流 」等输入方案，替换 express_editor，也可以写作 fluency_editor</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>- chord_composer   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 和弦作曲家或曰并击处理器，用于「 宫保拼音 」等多键并击的输入方案</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>- table_translator <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※ 码表翻译器，用于仓颉、五笔等基于码表的输入方案，替换 script_translator</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>输入引擎把完成具体功能的逻辑拆分为可装卸、组合的部件。「 加载 」输入方案，即按该处方挂接所需的功能组件、令这些组件从输入方案定义中加载各自的设定、准备各司其职。而他们接下来要完成作业，由引擎收到的一份按键消息引发。</p>
<h4 id="理解-processors">理解 Processors</h4>
<p>输入引擎，作为整体来看，以按键消息为输入、输出包括三部分：</p>
<ol>
<li>对按键消息的处理结果：操作系统要一个结果、这按键、输入法接是不接？</li>
<li>暂存于输入法、尚未完成处理的内容，会展现在输入法候选窗中；</li>
<li>要「 上屏 」的文字，并不是每按一键都有输出。通常中文字都会伴随「 确认 」动作而上屏，有些按键则会导致符号上屏，而这些还要视具体场景而定。</li>
</ol>
<p>那么第一类功能组件 <code>processor</code> s ，就是比较笼统地、起着「 处理 」按键消息的作用。</p>
<p>按键消息依次送往列表中的 <code>processor</code>，由他给出对按键的处理意见：</p>
<ul>
<li>或曰「 收 」，即由 Rime 响应该按键：</li>
<li>或曰「 拒 」，即回答操作系统 Rime 不做响应、请对按键做默认处理；</li>
<li>或曰这个按键我不认得、请下一个 <code>processor</code> 继续看。</li>
</ul>
<p>优先级依照 <code>processors</code> 列表顺序排定，接收按键者会针对按键消息做处理。</p>
<p>虽然看起来 <code>processor</code> 通过组合可以承担引擎的全部任务，但为了将逻辑继续细分、Rime 又为引擎设置了另外三类功能组件。这些组件都可以访问引擎中的数据对象 &ndash; 输入上下文，并将各自所做处理的阶段成果在于其中。</p>
<p><code>processor</code> 最常见的处理，便是将按键所产生的字符废上下文中的「 输入码 」序列。当「 输入码 」发生变更时，下一组组件 <code>segmentor</code> s 开始一轮新的作业。</p>
<h4 id="理解-segmentors">理解 Segmentors</h4>
<p>Segment 是段落的意思，segmentor 即 <strong>分段器</strong>，将用户连续输入的文字、数字、符号等不同内容按照需要，识别不同格式的输入码，将输入码分成若干段分而治之。这通过数轮代码段划分操作完成。每一轮操作中、一众  <code>segmentor</code> s 分别给出起始于某一处、符合特定格式的代码段，识别到的最长代码段为本轮划分结果，而给出这划分的一个或多个 <code>segmentor</code> 组件则可为该代码段打上「 类型标签 」 ；从这一新代码段的结束位置，开始下一轮划分，直到整个输入码序列划分完毕。</p>
<p>举例来说，「 朙月拼音 」中，输入码 <code>2012nian\</code> ，划分为三个编码段：</p>
<pre tabindex="0"><code>- 2012    → 贴 number 标签 
- nian    → 贴 abc    标签
- \       → 贴 punct  标签
</code></pre><p>那些标签是初步划分后判定的类型，也可能有一个编码段贴多个标签的情况。下一个阶段中， <code>translator</code> s 会把特定类型的编码段翻译为文字。</p>
<h4 id="理解-translators">理解 Translators</h4>
<p>顾名思义， <code>translator</code> 完成由编码到文字的翻译。但有几个要点：</p>
<ol>
<li>翻译是对象是划分好的一个代码段；</li>
<li>某个 <code>translator</code> 组件往往只翻译具有特定标签的代码段；</li>
<li>翻译的结果可能有多条，每条结果成为一个展现给用户的候选项；</li>
<li>代码段可由几种 <code>translator</code> 分别翻译，翻译结果按一定规则合并成一列候选；</li>
<li>候选项所对应的编码未必是整个代码段。用拼音敲一个词组时，词组后面继续列出单字候选，即是此例。</li>
</ol>
<p>让们看一下它们在内存中的存储，发现翻译的结果呈现这种形式：</p>
<pre tabindex="0"><code>input | tag    | translations
------+--------+-------------------------------------
2012  | number | [ &#34;2012&#34; ], [ &#34;二〇一二&#34; ]
nian  | abc    | [ &#34;年&#34;, &#34;念&#34;, &#34;唸&#34;,... ], [ &#34;nian&#34; ]
\     | punct  | [ &#34;、&#34;, &#34;\&#34; ]
</code></pre><p>输入串划分为多个代码段，每段代码又可具有多级翻译结果；取各代码段的首先结果连接起来，就是预备上屏的文字「 <code>2012年、</code> 」。</p>
<p>且将以上所示的数据称为 「 作文 」。这是一篇未定稿（未搞定）的作文，输入法介面此时显示预备上屏的文字「 <code>2012年、</code> 」，并列出最末一个代码段上的候选「 <code>、</code> 」及「 <code>\</code> 」以供选择。</p>
<p>有两款主力 <code>translator</code> 完成主要文字内容的翻译，其实现的方式很不一样：</p>
<p><strong>¹ <code>script_translator</code></strong> 也叫做 <code>r10n_translator</code> 修炼罗马字分析法，以「 固定音节表 」为算法的基础，识别输入码的音节构成，推敲排列组合、完成遣词造句。</p>
<p><strong>² <code>table_translator</code></strong> 修炼传承自上世纪的码表功夫，基于规则的动态码表，构成编码空间内一个开放的编码集合。</p>
<p>拼音、注音、方言拼音，皆是以固定音节表上的拼写排列组合方式产生编码，故适用罗马字分析法。</p>
<p>仓颉、五笔字型这类则是传统的码表输入法。</p>
<p>如果以码表方式来写拼音输入方案，是怎么的效果呢？虽然仍可完成输入，但无法完全实现运行简拼、模糊拼音、使用隔音符号的动态高频、智能语句等有用的特性。</p>
<p>反之，以罗马字方式使用码表输入法，则无法实现定长编码顶字上屏、按编码规则构词等功能。在 Rime 各发行版预设输入方案中，有一款「 速成 」输入方案，即是以 <code>script_translator</code> 翻译仓颉码，实现全、简码混合的语句输入。</p>
<p>概括起来，这是两种构造新编码的方式：罗马字式输入方案以<strong>一组固定的基本音节码</strong>创造新的组合而构词，而码表式输入方案则以<strong>一定码长为限</strong>创造新的编码映射而构词。</p>
<h4 id="理解-filters">理解 Filters</h4>
<p>Filter 即 <strong>过滤器</strong>。上一步已经收集到各个代码段的翻译结果，当输入法需要在介面呈现一页候选项时，就从最末一个代码段的结果集中挑选，直至取够方案中设定的页最大候选数。</p>
<p>每从结果集选出一条字词，会经过一组  <code>filter</code> s 过滤。多个 <code>filter</code> 串行工作，最终产出的结果进入候选序列。</p>
<p><code>filter</code> 可以：</p>
<ul>
<li>改装正在处理的候选项，修改某些属性值：简化字、火星文有没有？</li>
<li>消除当前候选项，比如检测到重复（由不同 <code>translator</code> 产生）的候选条目；</li>
<li>插入新的候选项，比如根据已有条目插入关联的结果；</li>
<li>修改已有的候选序列。</li>
</ul>
<h3 id="码表与词典">码表与词典</h3>
<p>词典是 <code>translator</code> 的参考书。</p>
<p>它往往与同名输入方案配套使用，如拼音的词典以拼音码查字，仓颉的词典以仓颉码查字。但也可由若干编码属于同一系统的输入方案共用，如各种双拼方案，都使用和拼音同样的词典，于是不仅复用了码表数据，也可共享用户以任一款此系列方案录入的自造词（仍以码表中的形式取全拼编码记录）。</p>
<p>Rime 的词典文件，命名为 <code>&lt;词典名&gt;.dict.yaml</code>，包含一份码表及对应的规则说明。词典文件的前半部分为一份 YAML 文档。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 注音这里以 --- ... 分别标记出 YAML 文档的起始与结束位置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># 在 ... 标记之后的部分就不会作 YAML 文档来解读</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>luna_pinyin<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;0.9&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">sort</span>:<span style="color:#bbb"> </span>by_weight<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">use_preset_vocabulary</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">...</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其中：</p>
<p><code>¹ name</code> ，词典名，内部使用，命名原则同 「 方案标识 」，可以与配套的输入方案标识一致，也可以不同。</p>
<p><code>² version</code>，管理词典的版本，规则同输入方案定义文件的版本号。</p>
<p><code>³ sort</code>，词条初始化排序方式，可选填 <code>by_weight</code> （按词频高低排序）或 <code>original</code> （保持原码表中的顺序）。</p>
<p><code>⁴ use_preset_vocabulary</code> ，填 <code>true</code> 或 <code>false</code> ，选择是否导入预设词汇表「 八股文 」。</p>
<p>码表，定义了输入法中编码与文字的对应关系。</p>
<p>码表位于词典文件中 YAMl 结束标记之后的部分。其格式为以制表符分隔的值，每行定义一条（文字 - 编码）的对应关系：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 单字</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>你	ni<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>我	wo<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>的	de	99%<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>的	di	1%<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>地	de	10%<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>地	di	90%<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>目	mu<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>好	hao<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># 词组</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>你我<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>你的<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>我的<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>我的天<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>天地	tian di<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>好天<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>好好地<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>目的	mu di<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>目的地	mu di di<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注音：不要从网页复制以上代码到实际的词典文件！因为网页制作符被转换成空格从而不符合 Rime 词典要求的格式。一些文本编辑器也会将使用者的制表符自动转换为空格，请注音检查和设置。</p>
<p>码表部分，除了以上格式的编码行，还可以包含空行及注释行（行首为 <code>#</code> 符号）。</p>
<p>¹ 以制表符（TAB）分隔的第一个字段是所定义的文字，可以是单字或词组。</p>
<p>² 第一个字段是与文字对应的编码。若该编码由多个音节组成，音节之间以空格分开。</p>
<p>³ 第三个字段（可选的）是设定该字词的权重（非负整数），或相对于预设权值的百分比（浮点数%）。在拼音输入法中，往往多音字的若干种读音使用的场合不同，于是指定不同百分比来修正每个读音的使用频率。</p>
<p>词组如果满足以下条件，则可以活动编码字段：</p>
<ul>
<li>词组中的每个单字均胡编码定义；</li>
<li>词组中不包含多音字（如：你我），或多音字在该词组中的读音的权值超过该多音字全部读音权值的 5% （如：我的）。</li>
</ul>
<p>这种条件下，词组的编码可由单字编码组合推导出来。</p>
<p>反之，则有必要给出词组的编码以消除自动注音的不确定性（如：天地）。</p>
<p>当含有多音字的词组缺少编码字段时，自动注音程序会复用权重百分比高于 5% 的读音进行组合，生成全部可能的注音。如：</p>
<p>「 好好地 」在编译时自动注音为 「 <code>hao hao de</code> 」、「 <code>hao hao di</code> 」。</p>
<h3 id="编译输入方案">编译输入方案</h3>
<p>将写好的输入方案部署到 Rime 输入法的过程，称为 「 编译 」。</p>
<p>为了查询效率，输入法工作时不直接加载文本格式的词典源文件，而是加载编译过程中为输入方案生成的专为高速查询设计的 「 <code>.bin</code> 」文件。</p>
<p>编译时程序做以下几件事：</p>
<ul>
<li>将用户的定制内容合并到输入方案定义中，在用户文件夹生成 <code>.schema.yaml</code> 文档副本；</li>
<li>依照输入方案中指定的词典：求得音节表（不同编码的集合）、单字表；</li>
<li>对词典中未提供编码的词组自动注音，也包括从「 八股文 」导入的词组；</li>
<li>建立按音节编码检索词条的索引，制作 Rime 固定词典；</li>
<li>建立按词条检索编码的索引，制作 Rime 反查词典；</li>
<li>依照音节表选方案定义中指定的拼写运算规则，制作 Rime 棱镜。</li>
</ul>
<h3 id="部署">部署</h3>
<p>初次安装 Rime 输入法，没有任何输入方案选用户设定。因此安装的最后一个步骤即是把发行版预设的输入方案选设定文件部署到 Rime 为该用户创建的工作目录，至此 Rime 组成为一部可以发动的输入引擎。</p>
<p>此后无论是修改已有方案的设定，或是添加了新的输入方案，都需要「 重新部署 」成功后方可使新的设定生效。</p>
<p>重新部署的方法：</p>
<ul>
<li>小狼毫：开始菜单 » 重新部署；或右击托盘图标 » 重新部署；</li>
<li>鼠须管：在系统语言文字选单中选择重新部署；</li>
<li>中州韵：点击输入法状态样（或 IBus 菜单）上的 ⟲ (Deploy) 按钮。</li>
</ul>
<h2 id="定制指南">定制指南</h2>
<p>Rime 输入方案，将 Rime 输入法的设定整理成完善的、可分发的形式。但并非一定要创作新的输入方案，才可以改变 Rime 的行为。</p>
<p>当用户需要对 Rime 中的各种设定做小幅的调节，最直接、但不完全正确的做法是：编辑用户文件夹中的那些 <code>.yaml</code> 文档。</p>
<p>这种方法有弊端：</p>
<ul>
<li>当 Rime 软件升级时，也会升级各种设定档、预设输入方案。用户编辑过的文档会被覆写为更高版本，所做高速也便丢失了；</li>
<li>即使在软件升级后再手动恢复经过编辑的文件，也会因设定档的其他冷媒未得到更新而失去本次升级新增选修复的功能。</li>
</ul>
<p>因此，对于随 Rime 改造的设定档及预设输入方案，⭐️ 推荐的定制方法是：</p>
<p>创建一个文件名的主体部分与要定制的文件相同、次级扩展名（位于 <code>.yaml</code> 之前）写作 <code>.custom</code> 的定制档，形如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;一组设定项/二级设定项/三级设定项&#34;: </span>新的设定值<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;另一个设定项&#34;: </span>新的设定值<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;再一个设定项&#34;: </span>新的设定值<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;含列表的设定项/@0&#34;: </span>列表第一个元素新的设定值<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;含列表的设定项/@last&#34;: </span>列表最后一个元素新的设定值<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;含列表的设定项/@before 0&#34;: </span>在列表第一个元素之前插入新的设定值（不建议在补丁中使用）<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;含列表的设定项/@after last&#34;: </span>在列表最后一个元素之后插入新的设定值（不建议在补丁中使用）<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;含列表的设定项/@next&#34;: </span>在列表最后一个元素之后插入新的设定值（不建议在补丁中使用）<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>patch</code> 定义了一组补丁，以源文件中的设定为底本，定入新的设定项、或以新的设定值取代旧有的值。</p>
<p>以下这些例子，请参阅另一篇 <a href="https://github.com/rime/home/wiki/CustomizationGuide">定制指南 </a>，其中所介绍的知识选技巧，覆盖了不少本方未讨论的细节，想必对于创作新的输入方案会有启发。</p>
<ul>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide#%E4%B8%80%E4%BE%8B%E5%AE%9A%E8%A3%BD%E6%AF%8F%E9%A0%81%E5%80%99%E9%81%B8%E6%95%B8">¹ 定制每页候选数</a></li>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide#%E4%B8%80%E4%BE%8B%E5%AE%9A%E8%A3%BD%E6%A8%99%E9%BB%9E%E7%AC%A6%E8%99%9F">² 定制标点符号</a></li>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide#%E4%B8%80%E4%BE%8B%E5%AE%9A%E8%A3%BD%E7%B0%A1%E5%8C%96%E5%AD%97%E8%BC%B8%E5%87%BA">³ 定制简化字输出</a></li>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide#%E4%B8%80%E4%BE%8B%E9%BB%98%E8%AA%8D%E8%8B%B1%E6%96%87%E8%BC%B8%E5%87%BA">⁴ 默认英文输出</a></li>
<li><a href="https://github.com/rime/home/wiki/CustomizationGuide#%E4%B8%80%E4%BE%8B%E5%AE%9A%E8%A3%BD%E6%96%B9%E6%A1%88%E9%81%B8%E5%96%AE">⁵ 定制方案选单</a></li>
</ul>
<p>重要！创作了新的输入方案，最后一步就是在「 方案选单 」中启用它。可以在 [[#定制指南详解]] 中了解更多。</p>
<h2 id="拼写运算-">拼写运算 💥</h2>
<p>i.e. Algebra</p>
<p>📘 <a href="https://github.com/rime/home/wiki/SpellingAlgebra">拼写运算 · rime/home Wiki &mdash; SpellingAlgebra · rime/home Wiki</a></p>
<p>应该算是 Rime 输入法最主要的独创技术。</p>
<p>概括来说就是<strong>将方案中的编码通过规则映射到一组全新的拼写形式</strong>！也就是说能让 Rime 输入方案在不修改码表的情况下，适应不同的输入习惯。</p>
<p>拼写运算能用来：</p>
<ul>
<li>改革拼写法：将编码映射到基于同一音系的其他拼写法，如注音、拼音、国语罗马字相互转换；自定义注音键盘、双拼方案；</li>
<li>实现简拼查询；</li>
<li>在音节表上灵活地定义模糊音规则；</li>
<li>实现音节自动纠错；</li>
<li>变换回显的输入码或提示码，如将输入码显示为字根、注音符号、带声调标的罗马字。</li>
</ul>
<p>给力吗？必须的。</p>
<h3 id="常用术语">常用术语</h3>
<p>先来介绍本文所使用的术语：</p>
<p><strong>输入法</strong>：以输入信号的序列到输出文本序列的转换方法。Rime 可搭载多种不同类型的输入法，称其为「 输入方案 」。</p>
<p><strong>字符集</strong>：构成目标输出文本的字符的集合，主要由汉字组成。</p>
<p><strong>编码</strong>：用于检索目标字符的字母序列。</p>
<p><strong>字母</strong>：构成编码的字符，亦称「 码元 」。</p>
<p><strong>字母表</strong>：字母的集合，亦称「 编码字符集 」，通常由小写拉丁字母组成。</p>
<p><strong>码表</strong>：目标字符集与编码集合之间的映射表。</p>
<p><strong>码长</strong>：单个编码所包含的字母个数。码表中所有编码码长一致，本文称其为「 定长编码 」。规定了最大编码的编码方案，本文称其为「 限长编码 」。</p>
<p><strong>编码空间</strong>：给定的字母表以有限的码长排列组合所得的可用编码数目。</p>
<p><strong>音节表</strong>：输入方案中所有编码的集合。拼音输入方案中，彼此不同的音节是可穷举的，其音节表是个固定的集合。多数形码输入法按照一定规则在给定的编码空间中为新生词组编码，故无法给出固定的音节表。</p>
<p><strong>重码</strong>：对应到多个输出字符的编码。</p>
<p><strong>输入码</strong>：用途输入的字符序列。</p>
<p><strong>候选</strong>：与输入码相关联的目标输出文字。当有重码时，候选文字形成一个列表可供用户挑选。</p>
<p><strong>拼写</strong>：与单个编码相对应的输入码。拼写可能不同于编码。</p>
<p><strong>拼写法</strong>：一种输入方案里，有效拼写的集合到编码集合的映射，亦称「 正字法 」。</p>
<p><strong>拼写运算</strong>：以拼写为运算元的一元运算。通过字符串匹配及替换操作对拼写实施文字变换，获得一个新的拼写，并可赋予结果附加的属性。</p>
<p><strong>投影</strong>：以拼写法为运算元的一元运算，获得一个衍生的拼写法。实际运用时，通常对拼写法连续执行一组投影操作。每一轮操作中，对拼写法里的每个有效拼写做一次拼写运算，从而获得新的有效拼写集合，并重新建立其与编码集合的映射。</p>
<h3 id="功能">功能</h3>
<p>传统的中文输入法是基于码表的，通过键盘输入特定字母序列，获得与该编码对应的文字。而大多数编码方案，都不会用尽编码空间内的所有编码。与字符集内的文字无对应的编码，就在编码空间中形成空位。为了提高输入效率，输入法会复用编码空间中的空位，编制简码、容错码等衍生编码，以在尽量多的场合为用户提供有意义的候选文字。</p>
<blockquote>
<p>:: 编码空间中空位，就是没有对应文字的编码。</p>
</blockquote>
<p>在某些输入方案里，简码、容错码可以从源码表按照一定规则产生。如：汉语拼音输入法中的简拼，取拼音音节的首字母，也可取以双这互表示的声母 zh、ch、sh 。这是因为 <strong>编码方案所遵循的语言学原理，决定了拼音音节在编码空间内的分布及留下的空位，呈某种规则的形式。</strong> 故，产生简码、容错码的规则是与输入方案相关的，一款通用的输入法软件要以与编码方案相适应的方式生成这些衍生编码。</p>
<p><strong>拼写运算，提供了描述产生式规则的能力！</strong> 🥳</p>
<p>为了提供多样化的输入体验，Rime 可藉由一份码表制作多款输入方案。譬如：注意符号、汉语拼音这两套注意方案是为相同音系设计的（忽略地区间字音标准的差异）。信有一份注意码表，按一定对应规则将注意转换为汉语拼音，可使注意、汉语拼音，甚至还有基于汉语拼音的双拼等输入方案复用同一部词典。</p>
<p><strong>拼写运算，提供为输入方案重构拼写法的能力！</strong> 🥳</p>
<p>此外，改变编码回显的样式、按特定规则生成词组编码……拼写运算也可用来实现此等需要定制能力的算法。</p>
<h3 id="原理与实现-">原理与实现 🌟</h3>
<p>拼写运算，借助正则表达式实现其字符串处理能力。进一步，利用数学知识，构造出建立在输入法编码集合上的运算系统。</p>
<p>拼写运算实现为 Rime 程序库中的一套算法，可从 Rime 配置文件导入一组算式，执行规定的计算步骤。运算步骤以 YAML 字符串列表的形式定义，每个列表为描述为描述一项运算的算式。算式中包含的正则表达式，<strong>遵照 Perl 正则表达式的语法规范</strong>。</p>
<p>❶ 拼写运算的算式</p>
<pre tabindex="0"><code>格式为：&lt;运算子&gt;&lt;分隔符&gt;&lt;参数1&gt;&lt;分隔符&gt;&lt;参数2&gt;&lt;分隔符&gt;...
如：
xlit/abc/ABC
- 运算子为 xlit（转写）
- 分隔符为 /
- 两个参数 abc 和 ABC

其中，分隔符为单个 ASCII 字符，通常用符号或空白字符。

如果参数中不包含空格，也可写作：
xlit abc ABC
</code></pre><p>注意：作为分隔符的字符不能在参数中出现。不同于 Perl 的 <code>s///\/</code> 语法，拼写运算式<strong>不支持</strong>在参数中将用作分隔符的字符用 <code>\</code> 转义表示。</p>
<p>🪧 也可以使用 <code>|</code> 充当了 <strong>分隔符</strong>，和 <code>/</code> 作用相同。这种格式是 <strong>Rime 兼容的拼写运算规则</strong>，并没有改变正则本质。</p>
<p>为什么多此一举呢？如上面所说的不支持转义，如此，你怎么表示在以 <code>/</code> 为分隔符的算式中表示 <code>/</code> 这个符号呢？这个时候 <code>|</code> 就排上用场了❗️</p>
<blockquote>
<p>:: 这解决了在并击方案中如何表示 <code>/</code> 符号的问题 👻</p>
</blockquote>
<p>❷ 拼写运算的运算子</p>
<p><strong>¹ 转写 / Transliteration</strong></p>
<p>依次将拼写中见于 <code>&lt;左字母表&gt;</code> 的字符替换为 <code>&lt;右字母表&gt;</code> 对应位置的字符。左、右字母表应包含相同数目的 Unicode 字符。</p>
<pre tabindex="0"><code>格式： xlit/&lt;左字母表&gt;/&lt;右字母表&gt;/

如：
算式   xlit/abs/ABC/ 
运算元 abracadabra
结果 → ABrACAdABrA
</code></pre><p><strong>² 变形 / Transformation</strong></p>
<p>若拼写（或其子串）与 <code>&lt;模式&gt;</code> 匹配，则将所匹配的部分改写为 <code>&lt;替换式&gt;</code>，否则拼写保持不变。模式、替换式遵循 Perl 正则表达式语法。</p>
<pre tabindex="0"><code>格式：xform/&lt;模式&gt;/&lt;替换式&gt;

如：
算式   xform/^([nl]ue$)/$1ve/
运算元 nue
结果 → nve
</code></pre><p>效果：输入 <code>nve(lve)</code> 可以获取码表中与编码 <code>nue(lue)</code> 对应的候选。输入  <code>nue(lue)</code> 则无候选。</p>
<blockquote>
<p>:: 因为已经变形以嘛~</p>
</blockquote>
<p><strong>³ 消除 / Erasion</strong></p>
<p>若拼写与 <code>&lt;模式&gt;</code> 完全匹配，则将该拼写从有效拼写集合中消除。</p>
<pre tabindex="0"><code>格式： erase/&lt;模式&gt;/

如：
算式   erase/^.\d$/
运算元 dang1
结果 → 带声调的拼音不再可用
</code></pre><p><strong>⁴ 派生 / Derivation</strong></p>
<p>若对拼写做正则模式匹配、替换而获得了新的拼写，则有效拼写集合同时包含派生前后的拼写，否则保留原拼写。</p>
<pre tabindex="0"><code>格式： derive/&lt;模式&gt;/&lt;替换式&gt;/

如：
算式   derive/^([nl])ue$/$1ve/
运算元 nue
结果 → nve
</code></pre><p>效果：输入 <code>nve、nue</code> 或 <code>lve、lue</code> 均可获得源码表中与编码 <code>nue、lue</code> 对应的候选。</p>
<pre tabindex="0"><code>如：
算式   derive/^[nl](.*)$/l$1/
运算元 na
结果 → la
</code></pre><p>效果：输入 <code>la</code> 可获得源码表中与编码 <code>na、la</code> 对应的候选；输入 <code>na</code> ，候选仍为码表中编码为 <code>na</code> 的候选。</p>
<p><strong>⁵ 模糊 / Fuzzing</strong></p>
<p>执行派生运算。派生出来的拼写将获得「 模糊 」属性，可设定将其用作构成词组的简码、但不用于输入单字。</p>
<pre tabindex="0"><code>格式： fuzz/&lt;模式&gt;/&lt;替换式&gt;/

如：
算式   fuzz/^([a-z]).+([a-z])$/$1$2/
</code></pre><p>效果：以首、尾码为多字母音节码的构词码。</p>
<p>注：需要配合 <code>script_translator</code> 的选项 <code>translator/strict_spelling: true</code> 方可限定该拼写不用于输入单字。</p>
<p><strong>⁶ 缩略 / Abbreviation</strong></p>
<p>执行派生运算。派生出的拼写将获得 「 缩略 」属性，会在音节切分时与通常的拼写做区分处理。</p>
<pre tabindex="0"><code>格式： abbrev/&lt;模式&gt;/&lt;替换式&gt;

如：
算式  abbrev/^([a-z]).+$/$1/
</code></pre><p>效果：以首字母为多字母音节码的编写。</p>
<hr>
<p>注解：</p>
<p><strong>转写</strong> 是拼写运算中目前唯一一则将运算元和参数作 UTF-32 编码，而非 UTF-8 编码处理的运算。意味着，字母表可以采用 ASCII 范围以外的字符。字母表的长度按照 Unicode 字符数来计算。</p>
<p><strong>转写</strong> 和 <strong>变形</strong> 两则运算，除在拼写法投影操作中起重要作用，还可用于对单个字符串进行变换。 <strong>消除、派生</strong> 和 <strong>缩略</strong> 用于定义拼写投影中非一一映射的情况。</p>
<p><strong>消除</strong> 就给定的模式，对运算元做完全匹配，即 <code>regex match</code> 操作。 <strong>变形、派生</strong> 和 <strong>缩略</strong> 则可做部分匹配，相当于 <code>regtx search/global replace</code> 操作。</p>
<h3 id="投影算法">投影算法</h3>
<p>在拼写法投影操作 <code>P[x,y,z]</code> 里，每项运算 <code>x,y,z</code> 作为投影的一个步骤，依次从作为运算元的拼写法中产生一套新的拼写法。将拼写法投影用于构建 “拼写-编码” 映射时，用户的输入是随意的，而码表中，音节表是固定的集合 A 。</p>
<p>所以 Rime 选音节表 A 上的初始拼写法（A → A）为投影的运算元，逐步推导出映射到音节表 A 的有效拼写集合 B ，即所求的拼写法 （B → A）。</p>
<p>算法：</p>
<pre tabindex="0"><code>记音节表为 A ，拼写运算为序列 [x,y,z]，该投影的结果为 P[x,y,z](A -&gt; A)
Sa = { a -&gt; a | for a in A } = (A -&gt; A)
Sx = P&lt;x&gt;(Sa) = { x(a) -&gt; a | for (a -&gt; a) in (A -&gt; A) } = (B -&gt; A)
Sy = P&lt;y&gt;(Sx) = { y(b) -&gt; a | for (b -&gt; a) in (B -&gt; A) } = (C -&gt; A)
Sz = P&lt;z&gt;(Sy) = { z(c) -&gt; a | for (c -&gt; a) in (C -&gt; A) } = (D -&gt; A)
P[x,y,z](Sa) = Sz
</code></pre><h3 id="在-rime-输入方案中的用法">在 Rime 输入方案中的用法</h3>
<p>例¹：仓颉输入方案(cangjie5.schema.yaml)，在编码区回显仓颉字母。</p>
<pre tabindex="0"><code>translator:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田難卜符|
</code></pre><p>例²：朙月拼音(luna_pinyin.schema.yaml)，显示拼音字母“ü”</p>
<pre tabindex="0"><code>translator:
  preedit_format:
    - xform/([nl])v/$1ü/
</code></pre><p>这一处，拼写运算的作用对象是编码回显区的拼音串，串中可能包含多个拼音音节，并已经自动插入了隔音符号。为了替换该拼音段中所有匹配的字母，模式中并未用锚点匹配音节的头尾位置。</p>
<p>例³：朙月拼音(luna_pinyin.schema.yaml)，定义简拼、容错拼写。</p>
<pre tabindex="0"><code>speller:
  algebra:
    - abbrev/^([a-z]).+$/$1/          # 简拼（首字母）
    - abbrev/^([zcs]h).+$/$1/         # 简拼（zh, ch, sh）
    - derive/^([nl])ve$/$1ue/         # 设 nue = nve, lue = lve 
    - derive/ui$/uei/                 # 设 guei = gui,...
    - derive/iu$/iou/                 # 设 jiou = jiu,...
    - derive/([aeiou])ng$/$1gn/       # 容错 dagn = dang,...
    - derive/ong$/on/                 # 容错 zhonguo = zhong guo
    - derive/ao$/oa/                  # 容错 hoa = hao,...
    - derive/([iu])a(o|ng?)$/a$1$2/   # 容错 tain = tian,...
</code></pre><p>编译输入方案时，将运用这组运算规则完成音节表上的投影，求得可解析为音节代码的有效拼写集合。输入过程中，这组有效拼写决定着输入码在音节切分方式。</p>
<p>例⁴：在拼音输入法中定义模糊音 zh=z, ch=c, sh=s, n=l, en=eng, in=ing</p>
<pre tabindex="0"><code>speller:
  algebra:
    - derive/^([zcs])h/$1/
    - derive/^([zcs])([^h])/$1h$2/
    - derive/^n/l/
    - derive/^l/n/
    - derive/([ei])n$/$1ng/
    - derive/([ei])ng$/$1n/
    # 模糊音定义先于简拼定义，可令简拼支持以上模糊音
    - abbrev/^([a-z]).+$/$1/
    - abbrev/^([zcs]h).+$/$1/
</code></pre><h2 id="综合演练">综合演练</h2>
<h3 id="牛刀小试">牛刀小试</h3>
<p>如果你安装好了 Rime 却不会玩，就一步一步跟我学吧。</p>
<p>本系列课程每个步骤的完整代码可由此查阅： <a href="https://github.com/lotem/rimeime/tree/master/doc/tutorial">rimeime/doc/tutorial</a> 。</p>
<h4 id="一个简单的方案">¹一个简单的方案</h4>
<p>每一个例子，总是最简单的（也是最傻的）。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Rime schema - hello.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># encoding: utf-8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># 最简单的 Rime 输入方案</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">#</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>hello   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 注意此 ID 与文件名里 .schema.yaml 之前的部分相同</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>大家好       <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 将在〔方案选单〕中显示</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb">        </span><span style="color:#998;font-style:italic"># 这是文字类型而非整数或小数，如 &#34;1.2.3&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>起始行是注释，而后只有一组必要的方案描述信息。</p>
<p>这一课主要练习建立格式正确的 YAML 文档。</p>
<ol>
<li>始终使用 UTF-8 格式编辑保存你的方案；</li>
<li>使用空格缩进（两个空格），而不是 Tab 字符。</li>
</ol>
<p>缩进表示设定所属的层次。</p>
<p>缩进表示设定项所属的层次。在他处引用到此文档中的设定项，可分别以 <code>schema/schema_id</code>, <code>schema/name</code>, <code>schema/version</code> 来指称。</p>
<p>我现在把写好的方案文档命名为 <code>hello.schema.yaml</code>，丢进用户文件夹，只要这一个文件就妥了。</p>
<p>然后，启用它。</p>
<p>有些版本会有「 方案选单设定 」这个介面，在那里勾选 「 大家好 」这个方案即可。若没有设定介面，则按照上文《定制方案选单 》一节来做。</p>
<p>好运！我已建立了一款名为 「 大家好 」的新方案！虽然他没有实现任何效果，按键仍然会像没有输入法一样直接输出英文。</p>
<h4 id="开始改装">²开始改装</h4>
<p>为了处理字符按键、生成输入码，本例向输入引擎添加两个功能组件。</p>
<p>以下代码仍是 ID 为 <code>hello</code> 的新款输入方案，但更新了  <code>schema/version</code> 的数值。</p>
<blockquote>
<p>以后每个版本，都以前一个版本为基础改写，引文略去没有发动的部分，以突出重点。</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>大家好<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fluid_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>fluid_editor</code> 将字符按键记入输入上下文， <code>fallback_segementor</code> 将输入码连缀成一段。于是重新部署后，按下字符键不再直接上屏，而是显示输入码。</p>
<p>你会发现，该输入法只是收集了键盘上的可打印字符，并于按下空格、回车键时信输入码上屏。</p>
<p>现在就好似写输入法程序的过程中，刚刚取得一点成果，还有很多逻辑没有实现。不同的是，在 Rime 输入方案里定一行代码，顶 Rime 开发者所写的上百上千行。因此键可以很快地组合各种逻辑组件，搭建出想要的输入法。</p>
<h4 id="创建候选项">³创建候选项</h4>
<p>在上个版本（第二版）的方案「 大家好 」中，键们实现了将键盘上所有字符都记入输入码，这对整句输入有用，但是时政流行输入法只处理编码字符，其他字符直接上屏的形式。</p>
<p>为了对编码字符做出区分，以下改用 <code>speller + express_editor</code> 的组合取代 <code>fluid_editor</code> 。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;3&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller         <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 把字母追加到编码串</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 空格确认当前输入，其他字符直接上屏</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>speller</code> 默认只接受小写拉丁字母作为输入码。试试看，输入其他字符如大写字母、数字、标点，都会直接上屏。并且如果已经输入了编码时，下一个直接上屏的字符会将输入码顶上屏。</p>
<p>再接着，创建一个最简单的候选项 &ndash; 把编码串本身作为一个选项。故而会提供这个选项的新组件名叫 <code>echo_translator</code>。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- echo_translator <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># （没有其他结果时）创建一个与编码串一模一样的候选项</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>至此，「 大家好 」看上去与一个真正的输入法形似啦，只是还不会打出“大家好”这个短语哦 ？</p>
<h4 id="编写词典">⁴编写词典</h4>
<p>那就写一部词典，码表中规定以 <code>hello</code> 作为短语“大家好”的编码：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Rime dictionary</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># encoding: utf-8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">sort</span>:<span style="color:#bbb"> </span>original<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>大家好	hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>再见	bye<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>再会	bye<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>同时修改方案定义：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;4&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">#...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- abc_segmentor      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 标记输入码的类型</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- echo_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- table_translator   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 码表式转换</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">translator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">dictionary</span>:<span style="color:#bbb"> </span>hello      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 设定 table_translator 使用的词典名</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>工作流程是这样的：</p>
<ul>
<li><code>speller</code> 将字母键加入输入码序列；</li>
<li><code>abc_segmentor</code> 给输入码打上标签 <code>abc</code> ；</li>
<li><code>table_translator</code> 把带有 <code>abc</code> 标签的输入码以查表的方式翻译为中文</li>
<li><code>table_translator</code> 所查的码表在 <code>translator/dictionary</code> 所指定的词典里</li>
</ul>
<p>现在可以敲 <code>hello</code> 而打出「大家好」。完工！</p>
<h4 id="实现选字及换页">⁵实现选字及换页</h4>
<p>等一下。</p>
<p>记得 <code>hello</code> 词典里，还有个编码叫做還 <code>bye</code>。敲 <code>bye</code>，Rime 给出「再见」、「再会」两个候选短语。</p>
<p>这时敲空格键，就会打出 「 再见 」；那么怎么打出 「 再会 」呢？</p>
<p>大家首先想到的方法是，打完编码 <code>bye</code> ，按 <code>1</code> 选 「 再见 」，按 <code>2</code> 选「 再会 」。可是现在按下 <code>2</code> 去，却是上屏「 再见 」选数字 「 2 」。可见并没有完成数字键选字的处理，而是将数字同其他符号一样顶字上屏处理。</p>
<p>增加一部 <code>selector</code>，即可实现以数字键选字。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;5&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector        <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 选字、换页</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- navigator       <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 移动插入点</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>selector</code> 除了数字键，还响应前次面、上下方向键。因此选择第二候选「 再会 」，既可以按数字 <code>2</code> ，又可以按方向键「 ↓ 」将 「 再会 」高亮、再按空格键确认。</p>
<p><code>navigator</code> 处理左右方向键、HOME、END 键，实现移动插入点的编辑功能。有两种情况需要用到它：一是发现输入码有误需要定位修改；二是缩小选词对应的输入码的范围、精确地编辑新词组。</p>
<p>接下来向词典添加一组重码，以检验换页的效果：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#555">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">sort</span>:<span style="color:#bbb"> </span>original<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>大家好	hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>再见	bye<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>再会	bye<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期一	monday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期二	tuesday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期三	wednesday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期四	thursday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期五	friday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期六	saturday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期日	sunday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期一	weekday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期二	weekday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期三	weekday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期四	weekday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期五	weekday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期六	weekday<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星期日	weekday<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>默认每页候选数为 5 ，输入  <code>weekday</code>，显示「星期一」至「星期五」。再敲 <code>Page_Down</code> 显示第二页候选词「星期六、星期日」。</p>
<h4 id="输出中文标点">⁶输出中文标点</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;6&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator       <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 处理符号按键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- navigator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- abc_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_segmentor  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 划界，与前后方其他的编码区分开</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- echo_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_translator <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 转换</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- table_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">             </span><span style="color:#998;font-style:italic"># 设定符号表，这里直接导入预设的</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这次的修改，要注意 <code>punctuator</code>, <code>punct_segmentor</code>, <code>punct_translator</code> 相对于其他组件的位置。</p>
<p><code>punctuator/import_preset</code> 告诉 Rime 使用一套预设的符号表。它的值 <code>default</code> 可以换成其他名字如 <code>xxx</code>，則 Rime 会读取 <code>xxx.yaml</code> 里面定义的符号表。</p>
<p>如今再敲 <code>hello.</code> 就会得到「大家好。」</p>
<h4 id="用符号键换页">⁷用符号键换页</h4>
<p>早先流行用 <code>-</code> 和 <code>=</code> 这一对符号换页，如今流行用 <code>,</code> 和 <code>.</code> 。 在第六版中「，」「。」是会顶字上屏的。现在要做些处理以达到一键两用的效果。</p>
<p>Rime 提供了 <code>key_binder</code> 组件，他能夠在一定条件下，将指定按键绑定为另一个按键。对于本例就是：</p>
<ul>
<li>当展现候选菜单时，名号键（<code>period</code>）绑定为向后换页（<code>Page_Down</code>）；</li>
<li>当已有（向后）换页动作时，逗号键（<code>comma</code>）绑定为向前换页（<code>Page_Up</code>）。</li>
</ul>
<p>逗号键向前换页的条件之所以比名号键严格，是为了「，」仍可在未进行换页的情况下顶字上屏。</p>
<p>经过 <code>key_binder</code> 的处理，用來换頁的逗号、句号键改头换面前、后换页键，从而绕过 <code>punctuator</code>，最终被 <code>selector</code> 当作换页来处理。</p>
<p>最终的代码如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>大家好<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;7&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- key_binder <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 抢在其他 processor 处理之前判定是否换頁用的符号键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 否则「，。」就会由此上屏</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- navigator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- abc_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- echo_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- table_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">translator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">dictionary</span>:<span style="color:#bbb"> </span>hello<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">key_binder</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">bindings</span>:<span style="color:#bbb">             </span><span style="color:#998;font-style:italic"># 每条定义包含条件、接收按键（IBus 规格的键名，可加修饰符，如 「Control+Return」）、发送按键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">when</span>:<span style="color:#bbb">   </span>paging   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 仅当已发生向后换页时</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">accept</span>:<span style="color:#bbb"> </span>comma    <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 将「逗号」键……</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">send</span>:<span style="color:#bbb">   </span>Page_Up  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 关联到「向前换页」；于是 navigator 将收到一发 Page_Up</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">when</span>:<span style="color:#bbb">   </span>has_menu <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 只要有候选字即满足条件</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">accept</span>:<span style="color:#bbb"> </span>period<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">send</span>:<span style="color:#bbb">   </span>Page_Down<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="修炼之道">修炼之道</h3>
<p>与 「 大家好 」这个方案不同。以下一组示例，主要演示如何活用符号键盘，以及罗马字转写式输入。</p>
<h4 id="改造键盘">¹改造键盘</h4>
<p>不要以为 「 大家好 」是最最简单的输入方案。码表式输入法，不如键盘式输入法来得简单明快！</p>
<p>用 <code>punctuator</code> 这一套組件，就可实现一款键盘输入法：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Rime schema</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># encoding: utf-8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>numbers<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>数字之道<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">half_shape</span>:<span style="color:#bbb"> </span><span style="color:#999;font-weight:bold;font-style:italic">&amp;symtable</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>一<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>二<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;3&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>三<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;4&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>四<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;5&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>五<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;6&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>六<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;7&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>七<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;8&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>八<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;9&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>九<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;0&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>〇<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;s&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>十<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;b&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>百<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;q&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>千<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;w&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>萬<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;n&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>年<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;y&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>月, 元, 億 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;r&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>日<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;x&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>星期<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;j&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>角<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;f&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>分<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;z&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>之, 整 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;d&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>第<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;h&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>號<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;.&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>點<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">full_shape</span>:<span style="color:#bbb"> </span><span style="color:#999;font-weight:bold;font-style:italic">*symtable</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对，所谓「键盘输入法」，就是按键选字直接对应的输入方式。</p>
<p>这次，不再写 <code>punctuator/import_preset</code> 这项，而是自订了一套符号表。</p>
<p>哦！原来 <code>punctuator</code> 不单可以用来打出标点符号；还可以重定义空格以及全部 94 个可打印 ASCII 字符（码位 <code>0x20</code> 至 <code>0x7e</code>）。</p>
<p>在符号表代码里，用对应的 ASCII 字符表示按键。记得这些按键字符要放在引号里面，YAML 才能夠正确解析喔。</p>
<p>示例代码表演了两种符号的映射方式：一对一及一对多。一对多者，按键后符号不会立即上屏，而是……嘿嘿，自己体验吧 🤣</p>
<p>关于代码里 <code>symtable</code> 的一点解释：</p>
<p>这是 YAML 的一种语法，<code>&amp;symtable</code> 叫做「锚点标签」，给紧随其后的内容起个名字叫 <code>symtable</code>； <code>*symtable</code> 则相当于引用了 <code>symtable</code> 所标记的那段內容，从而避免重复。</p>
<p>Rime 里的符号有「全角」、「半角」两种状态。本方案里暂不作区分，教 <code>half_shape</code>、<code>full_shape</code> 使用同一份符号表。</p>
<h4 id="大写数字键盘">²大写数字键盘</h4>
<p>灵机一动，不如复用「全、半角」模式来区分「大、小写」中文数字！</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">switches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>full_shape<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>小写, 大寫 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>先来定义状态开关：<code>0</code> 能改「 半角 」为「 小写 」，<code>1</code> 能改「 全角 」为「 大寫 」。</p>
<p>这样一改，再打开「 方案选单 」，方案「  数字之道 」底下就会多出个「 小写→大寫」的选项，每选定一次、状态随之反转一次。</p>
<p>接着给  <code>half_shape</code>、<code>full_shape</code> 定义不同的符号表：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">half_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>一<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>二<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;3&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>三<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;4&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>四<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;5&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>五<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;6&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>六<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;7&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>七<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;8&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>八<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;9&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>九<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;0&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>〇<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;s&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>十<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;b&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>百<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;q&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>千<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;w&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>萬<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;n&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>年<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;y&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>月, 元, 億 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;r&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>日<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;x&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>星期<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;j&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>角<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;f&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>分<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;z&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>之, 整 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;d&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>第<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;h&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>號<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;.&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>點<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">full_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>壹<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>貳<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;3&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>參<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;4&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>肆<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;5&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>伍<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;6&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>陸<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;7&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>柒<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;8&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>捌<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;9&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>玖<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;0&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>零<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;s&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>拾<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;b&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>佰<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;q&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>仟<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;w&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>萬<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;n&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>年<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;y&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>月, 圓, 億 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;r&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>日<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;x&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>星期<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;j&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>角<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;f&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>分<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;z&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>之, 整 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;d&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>第<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;h&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>號<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;.&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>點<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>哈，调出选单切换一下大小写，输出的字全变样！酷。</p>
<p>但是要去选单切换，总不如按下 <code>Shift</code> 就全都有了：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">half_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic"># ... 添加以下這些</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;!&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>壹<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;@&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>貳<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;#&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>參<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;$&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>肆, ￥, &#34;$&#34;, &#34;€&#34;, &#34;£&#34; ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;%&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>伍, 百分之 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;^&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>陸<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>柒<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>捌<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;(&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>玖<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;)&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>零<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;S&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>拾<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;B&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>佰<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;Q&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>仟<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;Y&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>圓<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>于是在「 小写 」状态，只要按 <code>shift + 数字键</code> 即可打出大写数字。</p>
<p>用了几下，发现一处小小的不满意：敲 <code>$</code> 这个键，可选的符号有一个之多。想要打出欧元、英磅符号只得多敲几下 <code>$</code> 键使用想要的符号高亮。但是按上、下方向键并没有效果，按符号前面标示的数字序号，更是不仅上屏了错误的符号、还多上屏一个数字。</p>
<p>这反映出两个问题。</p>
<p>①  是 <code>selector</code> 组件缺席使得选字、移动选字光标的动作未得到响应。立即加上：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector       <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 加在这里</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>因为要让 <code>punctuator</code> 来转换数字键，所有 <code>selector</code> 得放在它后头。</p>
<p>② 是无法用数字序号选字。为解决这个冲突，改用闲置的字母键来选字：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">menu</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">alternative_select_keys</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;acegi&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>完工。</p>
<h4 id="罗马字之道">³罗马字之道</h4>
<p>毕竟，键盘上只有 7 个字符按键、94 个编码字符，对付百十个字还管使。可要输入上千个常用汉字，嫌键盘式输入的编码空间太小，必得采用字符编码。</p>
<p>罗马字，以拉丁字母的特定排列作为汉语音节的转写形式。一个音节代表一组同音字，再由音节拼写组合词、句。</p>
<p>凡此单字（音节）编码自然连用而生词、句的输入法，皆可用  <code>script_translator</code> 组件完成基于音节码切分的智能词句转换。它有个别名 <code>r10n_translator</code> —— <code>r10n</code> 为 <code>romanization</code> 的简写。但不限于「 拼音、注音、双拼」等一族基于语音编码的输入法。形式相似者，如「 速成 」，难以字形为本，亦可应用。</p>
<p>现在来把「 数字之道 」改成 「 拼音→中文数字」的变换。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>numbers<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>数字之道<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;3&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- abc_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- script_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">translator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">dictionary</span>:<span style="color:#bbb"> </span>numbers<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">half_shape</span>:<span style="color:#bbb"> </span><span style="color:#999;font-weight:bold;font-style:italic">&amp;symtable</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;!&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>壹<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;@&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>貳<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;#&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>參<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;$&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>肆, ￥, &#34;$&#34;, &#34;€&#34;, &#34;£&#34; ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;%&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>伍, 百分之 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;^&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>陸<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>柒<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>捌<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;(&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>玖<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;)&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>零<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;S&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>拾<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;B&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>佰<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;Q&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>仟<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;W&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>萬<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;N&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>年<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;Y&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>月, 圓, 億 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;R&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>日<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;X&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>星期<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;J&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>角<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;F&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>分<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;Z&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>之, 整 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;D&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>第<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;H&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>號<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;.&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>點<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">full_shape</span>:<span style="color:#bbb"> </span><span style="color:#999;font-weight:bold;font-style:italic">*symtable</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>符号表里，把小写字母、数字键都空出来了。小写字母用来拼音，数字键用来选重。重点是本次用了  <code>script_translator</code> 这组件。与 <code>table_translator</code> 相似，该组件与  <code>translator/dictionary</code> 指名的词典相关联。</p>
<p>编制词典：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Rime dictionary</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># encoding: utf-8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>numbers<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;1&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">sort</span>:<span style="color:#bbb"> </span>by_weight<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">use_preset_vocabulary</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>一	yi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>二	er<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>三	san<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>四	si<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>五	wu<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>六	liu<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>七	qi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>八	ba<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>九	jiu<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>〇	ling<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>零	ling<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>十	shi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>百	bai<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>千	qian<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>萬	wan<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>億	yi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>年	nian<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>月	yue<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>日	ri<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>星	xing<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>期	qi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>時	shi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>分	fen<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>秒	miao<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>元	yuan<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>角	jiao<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>之	zhi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>整	zheng<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>第	di<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>號	hao<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>點	dian<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>是	shi<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>码表里给出了一个「 示例 」规格的小字集。其中包含几组重码字。</p>
<p>要诀 <code>sort: by_weight</code> 意图是不以码表的顺序排列码字，而是比较字频。那字频呢？没写出来。</p>
<p>要诀 <code>use_preset_vocabulary: true</code> 用在输入方案需要支持输入词组、而码表中词组相对匮乏时。编译输入方案期间引入 Rime 预设的「 八股文 」词汇 - 及词频资料！这就是码表中未具体字频的原因。</p>
<p>使用「 八股文 」，要注音码表所用的字形是否与该词汇表一致。八股文的词汇及词频统计都遵照 opencc 繁体字形标准。</p>
<p>如果缺少单字的编码定义，自然也无法导入某些词汇。所以本方案吸有导入这个数字「 小字集 」上的词汇。</p>
<h4 id="用拼写运算定义简码">⁴用拼写运算定义简码</h4>
<p>如今有了一款专门输入数字的拼音输入法。比一比升阳拼音、朙月拼音和地球拼音，还有哪里不一样？</p>
<p>很快我发现敲 <code>xingqiwu</code> 或 <code>xingqiw</code> 都可得到来自「 八股文 」的词组 “星期五”，这很好。可以敲 <code>xqw</code> 怎会不中呢？</p>
<p>原来 <code>script_translator</code> 罗马字中译的方法是，将输入码序列切分为音节表中的拼写形式，再按音节查词典。不信你找本词典瞧瞧，是不是按完整的拼音（注音）编排的。Rime 词典也一样，并没有 <code>xqw</code> 这样的检索码。</p>
<p>现在我要用 Rime 独门绝活「 拼写运算 」 来定义一种 「 音序查字法 」。令 <code>x</code> 作 <code>xing</code> 的简码， <code>q</code> 作数字之道所有音节中起首为 <code>q</code> 者的简码，即略代音节 <code>qi</code> 与 <code>qian</code>。</p>
<p>汉语拼音里还有三个双字母的声符， <code>zh、ch、sh</code> 也可以做简码。</p>
<p>添加拼写运算规则：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;4&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">#...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">speller</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">algebra</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#39;abbrev/^([a-z]).+$/$1/&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#39;abbrev/^([zcs]h).+$/$1/&#39;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如此 Rime 便知，除了码表里那些拼音，还有若干简码也是行得通的拼写形式。再输入 <code>xqw</code>，Rime 将它拆开 <code>x'q'w</code>，再默默对应到音节码 <code>xing'qi'wan</code>、<code>xing'qi'wu</code>、<code>xing'qian'wan</code> 等等，一翻词典就得到了一个好词「 星期五 」，而其他的组合都说不通。</p>
<p>现在有没有悟到，罗马字转写式输入法与码表式输入法理念上的不同？</p>
<p>哈，做中了。试试看 <code>sss,sss,sssss,sssss</code> 。</p>
<p>却好像不是我要的 「四是四，十是十，十四是十四，四十是四十」……</p>
<p>好办。如果某些词汇在方案里很重要，「 八股文 」又未收录，那么，请添加到码表：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#555">---</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>numbers<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;2&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">sort</span>:<span style="color:#bbb"> </span>by_weight<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">use_preset_vocabulary</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#555">...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>四是四<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>十是十<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>十四是十四<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>四十是四十<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>善哉。演示完毕。当然休想就此把 Rime 全盘掌握了。一本《指南书》，若能让读者入门，我只能说「 善哉~ 」</p>
<p>再往后，就只有多读代码，就能见识到各种新颖、有趣的玩法。</p>
<h3 id="最高武艺">最高武艺</h3>
<p>⚠️ 警告，最后这部戏，对智力、技术功底的要求不一般。如果读不下去，不要怪我、不要怀疑自己的智商。</p>
<p>即使路过本节也无妨，只是不可忽略了正文「 关于调试 」这一节。（重要哇……）</p>
<p>请检查是否：</p>
<ul>
<li>已将前两组实例分析透彻</li>
<li>学习完了《 拼写运算 》</li>
<li>知道双拼是什么</li>
<li>预习 Rime 预设输入方案之「 朙月拼音 」</li>
</ul>
<p>设计一款「 智能 ABC 双拼 」输入方案做练习！</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># Rime schema</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># encoding: utf-8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">schema</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_id</span>:<span style="color:#bbb"> </span>double_pinyin_abc <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 专有的方案标识</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>智能ABC双拼<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">version</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;0.9&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">author</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- 佛振 &lt;chen.sst@gmail.com&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">description</span>:<span style="color:#bbb"> </span>|<span style="color:#d14">
</span></span></span><span style="display:flex;"><span><span style="color:#d14">    </span><span style="color:#bbb">    </span>朙月拼音，兼容智能ABC双拼方案。<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">switches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>ascii_mode<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">reset</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>中文, 西文 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>full_shape<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>半角, 全角 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>simplification<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>漢字, 汉字 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">processors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- ascii_composer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- recognizer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- key_binder<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- speller<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punctuator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- selector<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- navigator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- express_editor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">segmentors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- ascii_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- matcher<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- abc_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- fallback_segmentor<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- echo_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- punct_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- script_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- reverse_lookup_translator<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- simplifier<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- uniquifier<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">speller</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">alphabet</span>:<span style="color:#bbb"> </span>zyxwvutsrqponmlkjihgfedcba <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 呃，倒背字母表完全是个人喜好</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">delimiter</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34; &#39;&#34;</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 隔音符号用「&#39;」；第一位的空白用來自动插入到音节边界处</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">algebra</span>:<span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 拼写运算规则，这个就是实现双拼方案的重点。写法有很多种，当然也可以把四百多个音节码一条条都列举</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- erase/^xx$/            <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 码表中有几個拼音不明的字，编码成xx了，消灭它</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- derive/^([jqxy])u$/$1v/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/^zh/A/           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 替换声母键，用大写以防与原有的字母混淆</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/^ch/E/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/^sh/V/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/^([aoe].*)$/O$1/ <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 添上固定的零声母o，先标记为大写O</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ei$/Q/           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 替换韵母键</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ian$/W/          <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※2</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/er$|iu$/R/       <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 对应两种韵母的；音节 er 现在变为 OR 了</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/[iu]ang$/T/      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ing$/Y/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/uo$/O/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/uan$/P/          <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># ※3</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/i?ong$/S/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/[iu]a$/D/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/en$/F/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/eng$/G/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ang$/H/          <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 检查一下在此之前是否已转换过了帶介音的ang；好，※1处有了</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/an$/J/           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 如果※2、※3还没有出现在上文中，应该把他们提到本行之前</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/iao$/Z/          <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 对——像这样让iao提前出场</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ao$/K/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/in$|uai$/C/      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 让uai提前出场</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ai$/L/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ie$/X/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/ou$/B/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/un$/N/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/[uv]e$|ui$/M/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xlit/QWERTYOPASDFGHJKLZXCVBNM/qwertyopasdfghjklzxcvbnm/ <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 最后把双拼码全部变小写</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">translator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">dictionary</span>:<span style="color:#bbb"> </span>luna_pinyin    <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 与【朙月拼音】共用词典</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">prism</span>:<span style="color:#bbb"> </span>double_pinyin_abc   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># prism 要以本输入方案的名称来命名，以免把朙月拼音的拼写映射表覆盖掉</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">preedit_format</span>:<span style="color:#bbb">             </span><span style="color:#998;font-style:italic"># 这段代码用来将输入的双拼码反转为全拼显示；若想直接显示双拼码可以把这段注释掉</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/o(\w)/0$1/       <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 零声母先改为0，以方便后面转换</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)q/$1ei/      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 双拼第二码转换为韵母</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)n/$1un/      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 提前转换双拼码 n 和 g，因为转换后的拼音里就快要出现这两个字母了，那时将难以分辨出双拼码</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)g/$1eng/     <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 当然也可以采取事先将双拼码变为大写的办法来与转换过的拼音做区分，可谁让我是高手呢</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)w/$1ian/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([dtnljqx])r/$1iu/ <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 对应多种总线的双拼码，按搭配的声母做区分（最好别用排除式如 [^o]r  容易出状况）</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/0r/0er/            <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 另一种情况，注音先不消除0，以防后面把e当作声母转换为ch</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([nljqx])t/$1iang/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)t/$1uang/      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 上一行已经把对应到 iang 的双拼码 t 消减，于是这里不用再列举相配的声母</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)y/$1ing/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([dtnlgkhaevrzcs])o/$1uo/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)p/$1uan/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([jqx])s/$1iong/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)s/$1ong/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([gkhaevrzcs])d/$1ua/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)d/$1ia/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)f/$1en/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)h/$1ang/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)j/$1an/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)k/$1ao/      <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 默默检查：双拼码 o 已经转换过了</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)l/$1ai/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)z/$1iao/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)x/$1ie/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)b/$1ou/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([nl])m/$1ve/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([jqxy])m/$1ue/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/(\w)m/$1ui/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;xform/(^|[ &#39;])a/$1zh/&#34;</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 复原声母，音节开始处的双拼字母 a 改写为 zh；其他位置的才真正是 a</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;xform/(^|[ &#39;])e/$1ch/&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;xform/(^|[ &#39;])v/$1sh/&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/0(\w)/$1/         <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 好了，現在可以把零声母拿掉啦</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([nljqxy])v/$1ü/  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 这要就是汉语拼音 :-)</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">reverse_lookup</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">dictionary</span>:<span style="color:#bbb"> </span>cangjie5<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">prefix</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;`&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">tips</span>:<span style="color:#bbb"> </span>〔仓颉〕<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">preedit_format</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田難卜符|&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">comment_format</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- xform/([nl])v/$1ü/<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">key_binder</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">recognizer</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">patterns</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">reverse_lookup</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;`[a-z]*$&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>完毕。</p>
<p>这是一道大题。通过改造拼写法而创作出新的输入方案。</p>
<h3 id="标准库">标准库</h3>
<p>如果需要制作完全属于自己的输入方案，少不了要了解 Rime 的标准库。些时，可以参阅 <a href="https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md">《Rime方案制作详解》</a>。更多新意，就在你的笔下！</p>
<h4 id="关于调试">关于调试</h4>
<p>如此复杂的输入方案，很可能需要反复调试方可达到想要的结果。</p>
<p>请于试验时及时查看日志中是否包含错误信息。日志文件位于：</p>
<ul>
<li>【中州韵】 <code>/tmp/rime.ibus.*</code></li>
<li>【小狼毫】 <code>%TEMP%\rime.weasel.*</code></li>
<li>【鼠须管】 <code>$TMPDIR/rime.squirrel.*</code></li>
<li>各发行版的早期版本 <code>用戶資料夾/rime.log</code></li>
</ul>
<p>按照日志级别分为 INFO/信息、WARNING/警告、ERROR/错误。后两类应重点关注，如果新方案部署后不可用或输出与设计不一致，原因可能在此。</p>
<p>没有任何错误信息，就是不好使，有可能是码表本身的问题，比如把码表中文字和编码两列弄颠倒了 &ndash; Rime 等你输入由汉字组成的编码，然而键盘没有可能做到这一点（否则也不再需要输入法了）。</p>
<p>后续有计划为输入方案创作者开发名为 <a href="http://rime.github.io/blog/2013/08/28/spelling-algebra-debugger/">「拼写运算调试器」</a> 的工具，能够较直观都看到第一步拼写运算的结果。有助于定义双拼这样大量使用拼写运算的方案。</p>
<h2 id="方案制作详解">方案制作详解</h2>
<p>更多参阅 <a href="https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md">雪齐的文档 </a>。</p>
<h3 id="开始之前">开始之前</h3>
<pre tabindex="0"><code># Rime schema
# encoding: utf-8
</code></pre><h3 id="描述档">描述档</h3>
<p>¹ <code>name</code>：方案的显示名称（即出现于方案选单中的方案名称，通常为中文）</p>
<p>² <code>schema_id</code>：方案内部名，在代码中引用此方案时以此名为正，通常由英文、数字、下划线组成。</p>
<p>³ <code>author</code> ：发明人、撰写者。如果你对方案做出了修改，请保留原作者名，并将自己的名字加在后面。</p>
<p>⁴ <code>description</code>：简要描述方案历史、码表来源、该方案规则等。</p>
<p>⁵ <code>dependencies</code>：如果本方案信赖于基字方案（通常来说会信赖其它方案做为反查，抑或是两种或多种方案混用时）。</p>
<p>⁶ <code>version</code>：版本号，在发布新版前请确保已升级版本号。</p>
<pre tabindex="0"><code>schema:
  name: &#34;仓颉检字法&#34;
  schema_id: cangjie6
  author:
    - &#34;发明人 朱邦復先生、沈紅蓮女士&#34;
  dependencies:
    - luna_pinyin
    - jyutping
    - zyenpheng
  description: |
    第六代仓颉输入法
    码表由雪齋、惜緣和crazy4u整理
  version: 0.19
</code></pre><h3 id="开关">开关</h3>
<p>通常包含以下数个，但并不限于此，<strong>自定义滤镜皆可设置开关调控</strong>。</p>
<p>¹ <code>ascii_mode</code>：是中英文转换开关，默认 <code>0</code> 为中文，<code>1</code> 为英文。</p>
<p>² <code>full_shape</code>：是全角符号 / 半角符号开关。<code>0</code> 为半角，<code>1</code> 为全角。注音，开启全角时英文字母亦为全角。</p>
<p>³ <code>extended_charset</code>：是字符集开关。<code>0</code> 为 CJK 基本字符集，<code>1</code> 为 CJK 全字符集。（仅 <code>table_translator</code> 可用）</p>
<p>⁴ <code>ascii_punct</code>：是中西文标点转换开关，<code>0</code> 为中文标点，<code>1</code> 为英文标点。</p>
<p>⁵ <code>simplification</code> ：是转化字开关。一般情况下与上同，<code>0</code> 为不开启转化，<code>1</code> 为开启转化。</p>
<p>所有开关名称可自定义，可用快捷键切换。该名称可用于 <code>key_binder/bindings</code> 中的 <code>toggle:</code> 后。</p>
<pre tabindex="0"><code>- name: simplification
  states: [&#34;漢字&#34;, &#34;汉字&#34;]
  reset: 0
</code></pre><p>亦可使用多选开关，同样支持快捷键：<code>options</code> 名称用于 <code>key_binder/bindings</code> 时，使用 <code>set_option:</code> 或 <code>unset_option:</code> 开启或关闭某一个。</p>
<pre tabindex="0"><code>- options: [ zh_trad, zh_cn, zh_mars ]
  states:
    - 字型 → 漢字
    - 字型 → 汉字
    - 字型 → 䕼茡
  reset: 0
</code></pre><p>其中：</p>
<ul>
<li><code>name</code> / <code>options</code> 名：需与 <code>simplifier</code> 中 <code>option_name</code> 相同；</li>
<li><code>states</code>：可不写，如不写则此开关存在但不可见，可由快捷键操作；</li>
<li><code>reset</code>：设定默认状态（<code>reset</code> 可不写，此时切换窗口时不会重置到默认状态）。</li>
</ul>
<pre tabindex="0"><code>switches:
  - name: ascii_mode
    reset: 0
    states: [&#34;中文&#34;, &#34;西文&#34;]
  - name: full_shape
    states: [&#34;半角&#34;, &#34;全角&#34;]
  - name: extended_charset
    states: [&#34;通用&#34;, &#34;增廣&#34;]
  - name: simplification
    states: [&#34;漢字&#34;, &#34;汉字&#34;]
  - name: ascii_punct
    states: [&#34;句讀&#34;, &#34;符號&#34;]
</code></pre><h3 id="引擎">引擎</h3>
<p>以下<strong>加粗</strong>项为可细配者，<em>斜体</em>为不常用者。</p>
<p>引擎分四组。</p>
<p>❶ <code>processors</code></p>
<p>这批组件处理各类按键消息。</p>
<p>¹ <code>ascii_composer</code> 处理西文模式及中西文切。</p>
<p>² <strong><code>recognizer</code></strong> 与 <code>matcher</code> 搭配，处理符合特定规则的输入码，如网址、反查等 <code>tags</code>。</p>
<p>³ <strong><code>key_binder</code></strong> 在特定条件下将按键绑定到其他按键，如重定义逗号、句号为候选翻页、开关快捷键等。</p>
<p>⁴ <strong><code>speller</code></strong> 拼写处理器，接受字符按键，编辑输入。</p>
<p>⁵ <strong><code>punctuator</code></strong> 句读处理器，将单个字符按键直接映射为标点符号或文字。</p>
<p>⁶ <code>selector</code> 选字处理器，处理数字选字键（可以换成别的）、上、下选定位、换页。</p>
<p>⁷ <code>navigator</code> 处理输入栏内的光标移动。</p>
<p>⁸ <code>express_editor</code> 编辑器，处理空格、回车上屏、回退键。</p>
<p>⁹  <em><code>fluid_editor</code></em> 句式编辑器，用于以空格断词、回车上屏的「 注音、语句流 」等输入方案，替换  <code>express_editor</code>。</p>
<p>¹⁰ <em><code>chord_composer</code></em> 和弦作曲家或曰并击处理器，用于「 宫保拼音 」等多键并击的输入方案。</p>
<p>¹¹ <code>lua_processor</code> 使用 <code>lua</code> 自定义按键，后接 <code>@</code> + <code>lua 函数名</code> 。<code>lua 函数名</code> 即用户文件夹内 <code>rime.lua</code> 中的函数名，参数为 <code>(key, env)</code>。</p>
<blockquote>
<p>:: 当然，现在的版本已经支持 <code>*.lua</code> 脚本自动执行了。</p>
</blockquote>
<p>❷ <code>segmentors</code></p>
<p>这批组件识别不同内容类型，将输入码分段并加上 <code>tag</code> 。</p>
<p>¹ <code>ascii_segmentor</code> 标识西文段落（比如在西文模式下）字母直接上屏。</p>
<p>² <code>matcher</code> 配合 <code>recognizer</code> 标识符合特定规则的段落，如网址、反查等，加上选定 <code>tag</code> 。</p>
<p>³ <strong><code>abc_segmentor</code></strong> 标识常规的文字段落，加上 <code>abc</code> 这个 <code>tag</code> 。</p>
<p>⁴ <code>punct_segmentor</code> 标识句读段落（键入标点符号用），加上 <code>punct</code> 这个 <code>tag</code>。</p>
<p>⁵ <code>fallback_segmentor</code> 标识其他示标识段落。</p>
<p>⁶ <strong><code>affix_segmentor</code></strong> 用户自定义 <code>tag</code>。此项可加载多个实例，后接 <code>@</code> + <code>tag</code> 名。</p>
<p>⁷ <em><code>lua_segmentor</code></em> 使用 <code>lua</code> 自定义切分，后接  <code>@</code> + <code>tag</code> 函数名。</p>
<p>❸ <code>translators</code></p>
<p>这批组件翻译特定类型的编码段为一组候选文字。</p>
<p>¹ <code>echo_translator</code> 没有其它候选字时，回显输入码（输入码可以 <code>Shift</code> + <code>Enter</code> 上屏）。</p>
<p>² <code>punct_translator</code> 配合 <code>punct_segmentor</code> 转换标点符号。</p>
<p>³ <strong><code>table_translator</code></strong> 码表翻译器，用于仓颉、五笔等基于码表的输入方案。此项可加载多个实例，后接 <code>@</code> +  <code>翻译器名 </code> （如 <code>cangjie</code> 、<code>wubi</code>）等。</p>
<p>⁴ <strong><code>script_translator</code></strong> 脚本翻译器，用于拼音、粤拼等基于音节表的输入方案。此项可加载多个实例，后接 <code>@</code> +  <code>翻译器名 </code> （如 <code>pinyin</code> 、<code>jyutping</code>）等。</p>
<p>⁵ <em><code>reverse_lookup_translator</code></em> 反查翻译器，用另一种编码方案查码。</p>
<p>⁶ <em><code>history_translator</code></em> 产生 commit 历史候选。其中：</p>
<ul>
<li><code>tag</code> 同 Translator 说明；</li>
<li><code>initial_quality</code> 同 Translator 说明；</li>
<li><code>size</code> 设定候选记录量，预设为 <code>0</code> 等同（<code>commit_record</code> 最大储存量为 <code>20</code>）；</li>
<li><code>input</code> 触发此翻译器的字串。</li>
</ul>
<p>⁷ <strong><code>lua_translator</code></strong> 使用 <code>lua</code> 自定义输入，例如动态输入当前日期、时间，后接 <code>@</code> + <code>lua</code> 函数名。其中：</p>
<ul>
<li><code>lua</code> 函数名即用户文件夹内 <code>rime.lua</code> 中函数名，参数为 <code>(input, seg, env)</code>；</li>
<li>可以 <code>env.engine.context:get_option(&quot;option_name&quot;)</code> 方式绑定到 <code>switch</code> 开关 / <code>key_binder</code> 快捷键。</li>
</ul>
<p>❹ <code>filters</code></p>
<p>这批组件过滤翻译的结果，自定义滤镜皆可使用开关调控。</p>
<p>¹ <code>uniquifier</code> 过滤重复的候选字，有可能来自 <strong><code>simplifier</code></strong>。</p>
<p>² <code>cjk_minifier</code> 字符集过滤（仅用于 <code>script_translator</code>，使之支援 <code>extended_charset</code> 开关）。</p>
<p>³ <strong><code>single_char_filter</code></strong> 单字过滤器，如加载此组件，则屏蔽词典中的词组（仅 <code>table_translator</code> 有效）。</p>
<p>⁴ <strong><code>simplifier</code></strong> 用字转换。</p>
<p>⁵ <strong><code>reverse_lookup_filter</code></strong> 反查滤镜，以更灵活的方式反查，Rime1.0 后替代 <em><code>reverse_lookup_translator</code></em>。此项可加载多个实例，后接 <code>@</code> +滤镜名〔如：<code>pinyin_lookup</code>、<code>jyutping_lookup</code> 等〕。</p>
<p>⁶ <strong><code>lua_filter</code></strong> 使用 <code>lua</code> 自定义过滤，例如过滤字符集、高速排序，后接 <code>@</code> + <code>lua</code> 函数名。其中：</p>
<ul>
<li><code>lua</code> 函数名即用户文件夹内 <code>rime.lua</code> 中函数名，参数为 <code>(input, seg, env)</code>；</li>
<li>可以 <code>env.engine.context:get_option(&quot;option_name&quot;)</code> 方式绑定到 <code>switch</code> 开关 / <code>key_binder</code> 快捷键。</li>
</ul>
<p><code>&gt; cangjie6.schema.yaml</code></p>
<pre tabindex="0"><code>engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - affix_segmentor@pinyin
    - affix_segmentor@jyutping
    - affix_segmentor@pinyin_lookup
    - affix_segmentor@jyutping_lookup
    - affix_segmentor@reverse_lookup
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - table_translator
    - script_translator@pinyin
    - script_translator@jyutping
    - script_translator@pinyin_lookup
    - script_translator@jyutping_lookup
    - lua_translator@get_date
  filters:
    - simplifier@zh_simp
    - uniquifier
    - cjk_minifier
    - reverse_lookup_filter@middle_chinese
    - reverse_lookup_filter@pinyin_reverse_lookup
    - reverse_lookup_filter@jyutping_reverse_lookup
    - lua_filter@single_char_first
</code></pre><h3 id="细项配置">细项配置</h3>
<p>凡 <code>comment_format</code>、<code>preedit_format</code>、<code>speller/algebra</code> 所用之正则表达式，请参阅 <a href="http://www.boost.org/doc/libs/1_49_0/libs/regex/doc/html/boost_regex/syntax/perl_syntax.html">「Perl 正则表达式」</a> 。</p>
<p>引擎中所举之加粗者堍可在正文详细描述，格式为：</p>
<pre tabindex="0"><code>name:
  branches: configurations
</code></pre><p>或</p>
<pre tabindex="0"><code>name:
  branches:
    - configurations
</code></pre><h4 id="speller"><code>speller</code></h4>
<p>¹ <code>alphabet:</code> 定义本方案定义本方案输入键。</p>
<p>² <code>initials:</code> 定义仅作始码之键。</p>
<p>³ <code>finals:</code> 定义仅作末码之键。</p>
<p>⁴ <code>delimiter:</code> 上屏时的音节间分音符。</p>
<p>⁵ <code>algebra:</code> 拼写运算规则，由之算出的拼写汇入 <code>prism</code> 中。</p>
<p>⁶ <code>max_code_length:</code> 形码最大码长，超过则顶字上屏（<code>number</code>）。</p>
<p>⁷ <code>auto_select:</code> 自动上屏（ <code>true</code> 或 <code>false</code>）。</p>
<p>⁸  <code>auto_select_pattern:</code> 自动上屏规则，以正则表达式描述，当输入串可以被匹配时自动顶字上屏。</p>
<p>⁹ <code>use_space:</code> 以空格作输入码（<code>true</code> 或 <code>false</code>）。</p>
<p><code>speller</code> 的演算包含：</p>
<pre tabindex="0"><code>xform  -- 改写〔不保留原形〕
derive -- 衍生〔保留原形〕
abbrev -- 简拼〔出字优先级较上两组更低〕
fuzz   -- 略拼〔此种简拼仅组词，不出单字〕
xlit   -- 变换〔适合大量一对一变换〕
erase  -- 刪除
</code></pre><p><code>&gt; luna_pinyin.schema.yaml</code></p>
<pre tabindex="0"><code>speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba
  delimiter: &#34; &#39;&#34;
  algebra:
    - erase/^xx$/
    - abbrev/^([a-z]).+$/$1/
    - abbrev/^([zcs]h).+$/$1/
    - derive/^([nl])ve$/$1ue/
    - derive/^([jqxy])u/$1v/
    - derive/un$/uen/
    - derive/ui$/uei/
    - derive/iu$/iou/
    - derive/([aeiou])ng$/$1gn/
    - derive/([dtngkhrzcs])o(u|ng)$/$1o/
    - derive/ong$/on/
    - derive/ao$/oa/
    - derive/([iu])a(o|ng?)$/a$1$2/
</code></pre><h4 id="segmentor"><code>segmentor</code></h4>
<p><code>segmentor</code> 配合 <code>recognizer</code> s 标记出 <code>tag</code>，这里会用到 <code>affix_segmentor</code> 和 <code>abc_segmentor</code>。</p>
<p><code>tag</code> 用在 <code>translator</code>、<code>reverse_lookup_filter</code>、<code>simplifier</code> 中用以标定各自作用范围。如果不需要用到 extra_tags 则不需要单独配置 segmentor。其中：</p>
<ol>
<li><code>tag:</code> 设定其 <code>tag</code> ；</li>
<li><code>prefix:</code> 设定其前缀标识，可不填，不填则无前缀；</li>
<li><code>suffix:</code> 设定其尾缀标识，可不填，不填则无尾缀；</li>
<li><code>tips:</code> 设定其输入前提示符，可不填，不填则无提示符；</li>
<li><code>closing_tips:</code> 设定其结束输入提示符，可不填，不填则无提示符；</li>
<li><code>extra_tags:</code> 为此 <code>segmentor</code> 所标记的段落插上其它 <code>tag</code> 。</li>
</ol>
<p><strong>当 <code>affix_segmentor</code> 和 <code>translator</code> 重名时，两者可并在一直配置，此处1-5 条对应下面 21-25 条。<code>abc_segmentor</code> 仅可设 <code>extra_tags</code></strong>。</p>
<p><code>&gt; cangjie6.schema.yaml</code></p>
<pre tabindex="0"><code>reverse_lookup:
  tag: reverse_lookup
  prefix: &#34;`&#34;
  suffix: &#34;;&#34;
  tips: &#34;【反查】&#34;
  closing_tips: &#34;【蒼頡】&#34;
  extra_tags:
    - pinyin_lookup
    - jyutping_lookup
</code></pre><h4 id="translator"><code>translator</code></h4>
<p>每个方案都有一个主 <code>translator</code>，在引擎列表不以 <code>@</code> + 翻译器名定义，在细项配置时直接以 <code>translator:</code> 命名。以下加粗项为可以主 <code>translator</code> 中定义之项，其它可在副〔以 <code>@</code> + 翻译器名命名〕 <code>translator</code> 中定义。</p>
<p>¹ <strong><code>enable_charset_filter:</code></strong> 是否开启字符集过滤〔仅 <code>table_translator</code> 有效。启用 <code>cjk_minifier</code> 后可适用于 <code>script_translator</code> 〕</p>
<p>² <strong><code>enable_encoder:</code></strong> 是否开启自动造词〔仅 <code>table_translator</code> 有效〕</p>
<p>³ <strong><code>encode_commit_history:</code></strong> 是否对已上屛词自动成词〔仅 <code>table_translator</code> 有效〕</p>
<p>⁴ <strong><code>max_phrase_length:</code></strong> 最大自动成词词长〔仅 <code>table_translator</code> 有效〕</p>
<p>⁵ <strong><code>enable_completion:</code></strong> 提前显示尚未输入完整码的字〔仅 <code>table_translator</code> 有效〕</p>
<p>⁶ <strong><code>enable_correction:</code></strong> 启用自动纠错〔仅 <code>script_translator</code> 有效〕</p>
<p>⁷ <strong><code>sentence_over_completion:</code></strong> 在无全码对应字而仅有逐键提示时也开启智能组句〔仅 <code>table_translator</code> 有效〕</p>
<p>⁸ <strong><code>strict_spelling:</code></strong> 配合 <code>speller</code> 中的 <code>fuzz</code> 规则，仅以略拼码组词〔仅 <code>table_translator</code> 有效〕</p>
<p>⁹ <strong><code>disable_user_dict_for_patterns:</code></strong> 禁止某些编码录入用户词典</p>
<p>¹⁰ <strong><code>enable_sentence:</code></strong> 是否开启自动造句</p>
<p>¹¹ <strong><code>enable_user_dict:</code></strong> 是否开启用户词典〔 用户词典记录动态字词频、用户词〕，以上选填 <code>true</code> 或 <code>false</code> 。</p>
<p>¹². <strong><code>dictionary:</code></strong> 翻译器将调取此字典文件</p>
<p>¹³ <strong><code>prism:</code></strong> 设定由此主翻译器的 <code>speller</code> 生成的棱鏡文件名，或此副编译器调用的棱鏡名</p>
<p>¹⁴ <strong><code>user_dict:</code></strong> 设定用戶詞典名</p>
<p>¹⁵ <strong><code>db_class:</code></strong> 设定用戶词典类型，可设 <code>tabledb</code> 〔文本〕或 <code>userdb</code> 〔二进制〕</p>
<p>¹⁶ <strong><code>preedit_format:</code></strong> 上屛码自定义</p>
<p>¹⁷ <strong><code>comment_format:</code></strong> 提示码自定义</p>
<p>¹⁸ <strong><code>spelling_hints:</code></strong> 设定多少字以內候选标注完整带拼音〔仅 <code>script_translator</code> 有效〕</p>
<p>¹⁹ <strong><code>always_show_comments:</code></strong>  始终显示提示码〔仅 <code>script_translator</code> 有效〕</p>
<p>²⁰ <strong><code>initial_quality:</code></strong> 设定此翻译器出字优先级</p>
<p>²¹ <code>tag:</code> 设定此翻译器针对的 <code>tag</code>。可不填，不填则仅针对 <code>abc</code></p>
<p>²² <code>prefix:</code> 设定此翻译器的前缀标识，可不填，不填则无前缀</p>
<p>²³ <code>suffix:</code> 设定此翻译器的尾缀标识，可不填，不填则无尾缀</p>
<p>²⁴ <code>tips:</code> 设定此翻译器的输入前提示符，可不填，否则则无提示符</p>
<p>²⁵ <code>closing_tips:</code> 设定此翻译器的结束输入提示符，可不填，不填则无提示符</p>
<p>²⁶ <code>contextual_suggestions:</code> 是否使用语言模型优化输出结果〔需配合 <code>grammar</code> 使用〕</p>
<p>²⁷ <code>max_homophones:</code> 最大同音簇长度〔需配合 <code>grammar</code> 使用〕</p>
<p>²⁸ <code>max_homographs:</code> 最大同形簇长度〔需配合 <code>grammar</code> 使用〕</p>
<p><code>&gt; cangjie6.schema.yaml 仓颉主翻译器</code></p>
<pre tabindex="0"><code>translator:
  dictionary: cangjie6
  enable_charset_filter: true
  enable_sentence: true
  enable_encoder: true
  encode_commit_history: true
  max_phrase_length: 5
  preedit_format:
    - xform/^([a-z ])$/$1｜\U$1\E/
    - xform/(?&lt;=[a-z])\s(?=[a-z])//
    - &#34;xlit|ABCDEFGHIJKLMNOPQRSTUVWXYZ|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|&#34;
  comment_format:
    - &#34;xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片・|&#34;
  disable_user_dict_for_patterns:
    - &#34;^z.$&#34;
  initial_quality: 0.75
</code></pre><p><code>&gt; cangjie6.schema.yaml 拼音副翻译器</code></p>
<pre tabindex="0"><code>pinyin:
  tag: pinyin
  dictionary: luna_pinyin
  enable_charset_filter: true
  prefix: &#39;P&#39; # 需配合recognizer
  suffix: &#39;;&#39; # 需配合recognizer
  preedit_format:
    - &#34;xform/([nl])v/$1ü/&#34;
    - &#34;xform/([nl])ue/$1üe/&#34;
    - &#34;xform/([jqxy])v/$1u/&#34;
  tips: &#34;【漢拼】&#34;
  closing_tips: &#34;【蒼頡】&#34;
</code></pre><p><code>&gt; pinyin_simp.schema.yaml 拼音・简化字主翻译器</code></p>
<pre tabindex="0"><code>translator:
  dictionary: luna_pinyin
  prism: luna_pinyin_simp
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue/$1üe/
    - xform/([jqxy])v/$1u/
</code></pre><p><code>&gt; luna_pinyin.schema.yaml 朙月拼音用戶短语</code></p>
<pre tabindex="0"><code>custom_phrase: #這是一個table_translator
  dictionary: &#34;&#34;
  user_dict: custom_phrase
  db_class: tabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: 1
</code></pre><h4 id="reverse_lookup_filter"><code>reverse_lookup_filter</code></h4>
<p>此滤镜需挂在 <code>translator</code> 上，不影响该 <code>translator</code> 工作。</p>
<p>¹ <code>tags:</code> 设定其作用范围。</p>
<p>² <code>overwrite_comment:</code> 是否覆盖其他提示。</p>
<p>³ <code>dictionary:</code> 反查所得提示码之码表。</p>
<p>⁴ <code>comment_format:</code> 自定义提示码格式。</p>
<p>⁵ <code>apply_comment:</code></p>
<p><code>&gt; cangjie6.schema.yaml</code></p>
<pre tabindex="0"><code>pinyin_reverse_lookup:    # 该反查滤镜名
  tags: [ pinyin_lookup ] # 挂在这个 tag 所对应的翻译器上
  overwrite_comment: true
  dictionary: cangjie6    # 反查所得为仓颉码
  comment_format:
    - &#34;xform/$/〕/&#34;
    - &#34;xform/^/〔/&#34;
    - &#34;xlit|abcdefghijklmnopqrstuvwxyz |日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片、|&#34;
</code></pre><h4 id="simplifier"><code>simplifier</code></h4>
<p>¹  <code>option_name:</code> 对应 <code>switches</code> 中设定的切换项名，即 <code>key_binder/binding</code> 中所用名。</p>
<p>² <code>opencc_config:</code> 用字转换配置文件。位于 <code>rime_dir/opencc/</code>，自带配置文件包含：</p>
<ol>
<li>繁转简〔默认〕：<code>t2s.json</code></li>
<li>繁转台湾：<code>t2tw.json</code></li>
<li>繁转香港：<code>t2hk.json</code></li>
<li>简转繁：<code>s2t.json</code></li>
</ol>
<p>³ <code>tags:</code> 设定转换范围。</p>
<p>⁴ <code>tips:</code> 设定是否显示转换前的字，可填 <code>none</code>（或不填）、<code>char</code>（仅对单字有效）、<code>all</code> 。</p>
<p>⁵ <code>comment_format:</code> 自定义提示码格式。</p>
<p>⁶ <code>allow_erase_comment:</code> 是否允许返回空提示码（默认 <code>false</code>）。</p>
<p>⁷ <code>show_in_comment:</code> 设定是否将转换结果显示在备注中。</p>
<p>⁸ <em><code>excluded_types:</code></em> 取消选定范围（一般为 <em><code>reverse_lookup_translator</code></em> ）转化用字。</p>
<p>修改自 <code>luna_pinyin_kunki.schema</code></p>
<pre tabindex="0"><code>zh_tw:
  option_name: zh_tw
  opencc_config: t2tw.json
  tags: [ abc ] # abc 对应 abc_segmentor
  tips: none
  allow_erase_comment: true
  comment_format:
    - xform/.*//
</code></pre><h4 id="chord_composer"><em><code>chord_composer</code></em></h4>
<p>并击把键盘分两半，相当于两块键盘。两边同时击键，系统默认在其中一半上按的键等于另一半，由此得出上屏码。</p>
<p>¹ <code>alphabet:</code> 字母表，包含用于并击的按键。击键虽有先后，形成并击时，一律以字母表顺序排列。</p>
<p>² <code>algebra:</code> 拼写运算规则，将一组并击编码转换为拼音音节。</p>
<p>³ <code>output_format:</code> 并击完成后套用的式样，追加隔音符号。</p>
<p>⁴ <code>prompt_format:</code> 并击过程中套用的式样，加方括号弧。</p>
<p><code>&gt; combo_pinyin.schema.yaml</code></p>
<pre tabindex="0"><code>chord_composer:
  # 字母表，包含用于并击的按键
  # 击键虽有先后，形成并击时，一律以字母表顺序排列
  alphabet: &#34;swxdecfrvgtbnjum ki,lo.&#34;
  # 拼写运算规则，将一级并击编码转换为拼音音节
  algebra:
    # 先将物理按键字符对应到宫保拼音键位中的拼音字母
    - &#39;xlit|swxdecfrvgtbnjum ki,lo.|sczhlfgdbktpRiuVaNIUeoE|&#39;
    # 以下根据宫保拼音的键位分别变换声母、韵母部分
    # 组合声母
    - xform/^zf/zh/
    - xform/^cl/ch/
    - xform/^fb/m/
    - xform/^ld/n/
    - xform/^hg/r/
    ……
    # 声母独用时补足隐含的韵母
    - xform/^([bpf])$/$1u/
    - xform/^([mdtnlgkh])$/$1e/
    - xform/^([mdtnlgkh])$/$1e/
    - xform/^([zcsr]h?)$/$1i/
  # 并击完成后套用的式样，追加隔音符号
  output_format:
    - &#34;xform/^([a-z]+)$/$1&#39;/&#34;
  # 并击过程中套用的式样，加方括弧
  prompt_format:
    - &#34;xform/^(.*)$/[$1]/&#34;
</code></pre><h4 id="lua"><code>lua</code></h4>
<p>可以参考 <a href="https://github.com/hchunhui/librime-lua">Extending RIME with Lua scripts</a> 以寻求更多灵感。</p>
<ol>
<li><code>lua_translator</code></li>
<li><code>lua_filter</code></li>
<li><code>lua_processor</code></li>
<li><code>lua_segmentor</code></li>
</ol>
<p><code>&gt; rime.lua</code></p>
<pre tabindex="0"><code>function get_date(input, seg, env)
  --- 以 show_date 为开关名或 key_binder 中 toggle 的对象
  on = env.engine.context:get_option(&#34;show_date&#34;)
  if (on and input == &#34;date&#34;) then
    --- Candidate(type, start, end, text, comment)
    yield(Candidate(&#34;date&#34;, seg.start, seg._end, os.date(&#34;%Y年%m月%d日&#34;), &#34; 日期&#34;))
  end
end
---
function single_char_first(input, env)
  --- 以 single_char 为开关名或 key_binder 中 toggle 的对象
  on = env.engine.context:get_option(&#34;single_char&#34;)
  local cache = {}
  for cand in input:iter() do
    if (not on or utf8.len(cand.text) == 1) then
      yield(cand)
    else
      table.insert(cache, cand)
    end
  end
  for i, cand in ipairs(cache) do
    yield(cand)
  end
end
</code></pre><h4 id="其它">其它</h4>
<p>包括 <code>recognizer、key_binder、punctuator</code>。标点、快捷键、二三选重、特殊字符等均于此设置。</p>
<p>¹ <code>import_preset:</code> 由外部统一文件导入。</p>
<p>² <code>grammar:</code> 下设：</p>
<ul>
<li><code>language:</code> 取值 <code>zh-han[ts]-t-essay-bg[wc]</code> ;</li>
<li><code>collocation_max_length:</code> 最大搭配长度（整句输入可忽略此项）；</li>
<li><code>collocation_min_length:</code> 最小搭配长度（整句输入可忽略此项）。</li>
</ul>
<p>³ <code>recognizer:</code> 下设 <code>patterns:</code> 配合 <code>segmentor</code> 的 <code>prefix</code> 和 <code>suffix</code> 完成段落划分、<code>tag</code> 分配。 前字段可以为以 <code>affix_segmentor@someTag</code> 定义的 <code>Tag</code> 名，或者 <code>punct、reverse_lookup</code> 两个内设的字段。其它字段不调用输入法引擎，输入即输出（如 <code>url</code> 等字段）。</p>
<p>⁴ <code>key_binder:</code> 下设 <code>bindings:</code> 设置功能性快捷键。</p>
<p>每一条 <code>binding</code> 包含： <code>when</code> 作用范围、<code>accept</code> 实际所按之键，以及期望的操作。</p>
<p>操作可为以下任意一个：<code>send</code> 输出按键、<code>toggle</code> 切换开关、<code>send_sequence</code> 输出一串按键、<code>set_option</code> 开某多选开关、<code>unset_option</code> 开某种多选开关、<code>select</code> 选候选字。</p>
<ul>
<li><code>toggle</code> 可用字段包含各开关名；</li>
<li><code>set_option</code>、<code>unset_option</code> 可用字段包含多选开关名；</li>
<li><code>when</code> 可用字段包含：</li>
</ul>
<pre tabindex="0"><code>- paging     翻页用
- has_menu   操作候选项用
- composing  操作输入码用
- always     全域
</code></pre><ul>
<li><code>accept</code> 选 <code>send</code> 可用字段除 A-Za-z0-9 外，还包含以下键盘上实际有的键：</li>
</ul>
<pre tabindex="0"><code>BackSpace	    退格
Tab	            水平定位符（制表符）
Linefeed	    换行
Clear	        清除
Return	        回車
Pause	        暫停
Sys_Req	        印屏
Escape	        退出
Delete	        刪除
Home	        原位
Left	        左箭头
Up	            上箭头
Right	        右箭头
Down	        下箭头
Prior、Page_Up	上翻
Next、Page_Down	下翻
End	            末位
Begin	        始位
Shift_L	左Shift
Shift_R	右Shift
Control_L	    左Ctrl
Control_R	    右Ctrl
Meta_L	        左Meta
Meta_R	        右Meta
Alt_L	        左Alt
Alt_R	        右Alt
Super_L	        左Super
Super_R	        右Super
Hyper_L	        左Hyper
Hyper_R	        右Hyper
Caps_Lock	    大写锁
Shift_Lock	    上档锁
Scroll_Lock	    滚动锁
Num_Lock	    小键盘锁
Select	        选定
Print	        打印
Execute	        执行
Insert	        插入
Undo	        还原
Redo	        重做
Menu	        菜单
Find	        查寻
Cancel	        取消
Help	        帮助
Break	        中断
space
exclam	     !
quotedbl	 &#34;
numbersign	 #
dollar	     $
percent	     %
ampersand	 &amp;
apostrophe	 &#39;
parenleft	 (
parenright	 )
asterisk	 *
plus	     +
comma	     ,
minus	     -
period	     .
slash	     /
colon	     :
semicolon	 ;
less	     &lt;
equal	     =
greater	     &gt;
question	 ?
at	         @
bracketleft	 [
backslash	
bracketright ]
asciicircum	 ^
underscore	 _
grave	     `
braceleft	 {
bar	         |
braceright	 }
asciitilde	 ~


KP_Space	            小键板空格
KP_Tab	                小键板水平定位符
KP_Enter	            小键板回车
KP_Delete	            小键板刪除
KP_Home	                小键板原位
KP_Left	                小键板左箭头
KP_Up	                小键板上箭头
KP_Right	            小键板右箭头
KP_Down	                小键板下箭头
KP_Prior、KP_Page_Up	小键板上翻
KP_Next、KP_Page_Down	小键板下翻
KP_End	                小键板末位
KP_Begin	            小键板始位
KP_Insert	            小键板插入
KP_Equal	            小键板等于
KP_Multiply	            小键板乘号
KP_Add	                小键板加号
KP_Subtract	            小键板減号
KP_Divide	            小键板除号
KP_Decimal	            小键板小数点
KP_0	                小键板0
KP_1	                小键板1
KP_2	                小键板2
KP_3	                小键板3
KP_4	                小键板4
KP_5	                小键板5
KP_6	                小键板6
KP_7	                小键板7
KP_8	                小键板8
KP_9	                小鍵板9
</code></pre><p>⁵ <code>editor</code> 用以定制操作键（不支持 <code>import_preset:</code>），键盘键名同 <code>key_binder/bindings</code> 中的 <code>accept</code> 和 <code>send</code>，效果定义如下：</p>
<pre tabindex="0"><code>confirm	            上屏候选项
commit_comment	    上屏候选项備注
commit_raw_input	上屏原始输入
commit_script_text	上屏变换后输入
commit_composition	语句流单字上屏
revert	            撤消上次输入
back	            按字符回退
back_syllable	    按音节回退
delete_candidate	刪除候选项
delete	            向后刪除
cancel	            取消输入
noop	            空
</code></pre><p>⁶ <code>punctuator:</code> 下设 <code>full_shape:</code> 选 <code>half_shape:</code> 分别控制全角模式下的符号选半角模式下的符号，另有 <code>use_space:</code> 空格顶字（<code>true</code> 或 <code>false</code>）。</p>
<p>每条标点项可加 <code>commit</code> 直接上屏选 <code>pair</code> 交替上屏两种模式，默认为选单模式。</p>
<p><code>&gt; 修改自 cangjie6.schema.yaml</code></p>
<pre tabindex="0"><code>
key_binder:
  import_preset: default
  bindings:
    - {accept: semicolon, send: 2, when: has_menu}  # 分号选第二重码
    - {accept: apostrophe, send: 3, when: has_menu} # 引号选第三重码
    - {accept: &#34;Control+1&#34;, select: .next, when: always}
    - {accept: &#34;Control+2&#34;, toggle: full_shape, when: always}
    - {accept: &#34;Control+3&#34;, toggle: simplification, when: always}
    - {accept: &#34;Control+4&#34;, toggle: extended_charset, when: always}
editor:
  bindings:
    Return: commit_comment
punctuator:
  import_preset: symbols
  half_shape:
    &#34;&#39;&#34;: {pair: [&#34;「&#34;, &#34;」&#34;]} # 第一次按是「，第二次是」
    &#34;(&#34;: [&#34;〔&#34;, &#34;［&#34;]         # 弹出选单
    .: {commit: &#34;。&#34;}         # 无选单，直接上屏。优先级最高
recognizer:
  import_preset: default
  patterns:
    email: &#34;^[a-z][-_.0-9a-z]*@.*$&#34;
    url: &#34;^(www[.]|https?:|ftp:|mailto:).*$&#34;
    reverse_lookup: &#34;`[a-z]*;?$&#34;
    pinyin_lookup: &#34;`P[a-z]*;?$&#34;
    jyutping_lookup: &#34;`J[a-z]*;?$&#34;
    pinyin: &#34;(?&lt;!`)P[a-z&#39;]*;?$&#34;
    jyutping: &#34;(?&lt;!`)J[a-z&#39;]*;?$&#34;
    punct: &#34;/[a-z]*$&#34; # 配合 symbols.yaml 中的特殊字符输入
</code></pre><p>⁷ 外观</p>
<p>Rime 还为每个方案提供选单选一定的外面定制能力。</p>
<p>通常情况下 <code>menu</code> 在 <code>default.yaml</code> 中定义（或用户修改档 <code>default.custom.yaml</code>），<code>style</code> 在 <code>squirrel.yaml</code> 或 <code>weasel.yaml</code> （或用户修改档 <code>squirrel.custom.yaml</code> 或 <code>weasel.custom.yaml</code>）。</p>
<pre tabindex="0"><code>
menu:
  alternative_select_labels: [ ①, ②, ③, ④, ⑤, ⑥, ⑦, ⑧, ⑨ ]  # 修改候选标签
  alternative_select_keys: ASDFGHJKL  # 如编码字符占用数字键则需另设选字键
  page_size: 5                        # 选单每页显示个数
style:
  font_face: &#34;HanaMinA, HanaMinB&#34;     # 字体〔小狼毫得且仅得设一个字体；鼠须管得设多个字体，后面的字体自动补前面字体中不含的字〕
  font_point: 15       # 字号
  label_format: &#39;%s&#39;   # 候选标签格式
  horizontal: false    # 橫／直排
  line_spacing: 1      # 行距
  inline_preedit: true # 输入码內嵌
</code></pre><h2 id="词典详解">词典详解</h2>
<pre tabindex="0"><code># Rime dict
# encoding: utf-8
〔你还可以在这注释字典来源、变动记录等〕
</code></pre><h3 id="描述档-1">描述档</h3>
<p>¹ <code>name:</code> 内部字典名，也即 <code>schma</code> 所引用的字典名，确保与文件名相一致。</p>
<p>² <code>version:</code> 如果发布，请确保每次发动升级版本号。</p>
<pre tabindex="0"><code>name: &#34;cangjie6.extended&#34;
version: &#34;0.1&#34;
</code></pre><h3 id="配置">配置</h3>
<p>¹ <code>sort:</code> 字典 <strong>初始</strong> 排序，可选 <code>original</code> 或 <code>by_weight</code> 。</p>
<p>² <code>use_preset_vocabulary:</code> 是否引入「 八股文 」（含字词频、词库）。</p>
<p>³ <code>vocabulary:</code> 引入其他词库（含字词频、词库），此时 <code>use_preset_vocabulary</code> 不可设定为 <code>true</code> 。</p>
<p>⁴ <code>max_phrase_length:</code> 配合  <code>use_preset_vocabulary:</code> ，设定导入词条最大词长。</p>
<p>⁵ <code>min_phrase_weight:</code> 配合  <code>use_preset_vocabulary:</code> ，设定导入词条最小词频。</p>
<p>⁶ <code>columns:</code> 定义码表以 <code>Tab</code> 分隔出的各列，可设 <code>text</code>（文本）、<code>code</code>（码）、<code>weight</code>（权重）、<code>stem</code>（造词码）。</p>
<p>⁷ <code>import_tables:</code> 加载其它外部码表。</p>
<p>⁸ <code>encoder:</code> 形码造词规则。</p>
<ul>
<li><code>exclude_patterns:</code> ；</li>
<li><code>rules:</code> 可用 <code>length_equal:</code> 和 <code>length_in_range:</code> 定义。大写字母表示字序，小写字母表示其所跟随的大写字母所以表的字中的编码序；</li>
<li><code>tail_anchor:</code> 造词码包含结构分隔符（仅用于仓颉）；</li>
<li><code>exclude_patterns</code> 取消某编码的造词资格。</li>
</ul>
<p><code>&gt; cangjie6.extended.dict.yaml</code></p>
<pre tabindex="0"><code>sort: by_weight
use_preset_vocabulary: false
import_tables:
  - cangjie6 # 单字码表由 cangjie6.dict.yaml 导入
columns:     # 此字典为纯词典，无单字编码，仅有字和词频
  - text     # 字／词
  - weight   # 字／词频
encoder:
  exclude_patterns:
    - &#39;^z.*$&#39;
  rules:
    - length_equal: 2         # 对于二字詞
      formula: &#34;AaAzBaBbBz&#34;   # 取第一字首尾码、第二字首次尾码
    - length_equal: 3         # 对于三字詞
      formula: &#34;AaAzBaYzZz&#34;   # 取第一字首尾码、第二字首尾码、第三字尾码
    - length_in_range: [4, 5] # 对于四至五字詞
      formula: &#34;AaBzCaYzZz&#34;   # 取第一字首码，第二字尾码、第三字首码、倒数第二字尾码、最后一字尾码
  tail_anchor: &#34;&#39;&#34;
</code></pre><h3 id="码表">码表</h3>
<p>以 <code>Tab</code> 分隔各列，各列依 <code>columns:</code> 定义排列。</p>
<p><code>&gt; cangjie6.dict.yaml</code></p>
<pre tabindex="0"><code>columns:
  - text   # 第一列字／词
  - code   # 第二列码
  - weight # 第三列字／词频
  - stem   # 第四列造词码
</code></pre><p><code>&gt; cangjie6.dict.yaml</code></p>
<pre tabindex="0"><code>個	owjr	246268	ow&#39;jr
看	hqbu	245668
中	l	243881
呢	rsp	242970
來	doo	235101
嗎	rsqf	221092
爲	bhnf	211340
會	owfa	209844
她	vpd	204725
與	xyc	203975
給	vfor	193007
等	hgdi	183340
這	yymr	181787
用	bq	168934	b&#39;q
</code></pre><h3 id="词典扩展包">词典扩展包</h3>
<h4 id="概述">概述</h4>
<p>librime 1.6.0 增加了一种扩展词典内容的机制——词典扩展包。可用於为固定音节表的输入方案添加词汇。</p>
<p>固态词典包含 <code>*.table.bin</code> 和 <code>*.prism.bin</code> 两个文件。 前者用於存储来自词典源文件<code>*.dict.yaml</code> 的数据，后者综合了从词典源文件中提取的音节表和输入方案定义的拼写规则。</p>
<p>扩充固态词典内容，旧有在词典文件的 YAML 配置中使用 <code>import_tables</code> 从其他词典源文件导入码表的方法。 此法相当於将其他源文件中的码表内容追加到待编译的词典文件中，再将合併的码表编译成二进制词典文件。</p>
<p>词典扩展包可以达到相似的效果。其实现方式有所不同。 编译过程中，将额外的词典源文件 <code>*.dict.yaml</code> 生成对应的 <code>*.table.bin</code>，其音节表与主码表的音节表保持一致。 使用输入方案时，按照 <code>translator/packs</code> 配置列表中的包名加载额外的 <code>*.table.bin</code> 文件，多表并用，从而一併查得扩充的词汇。</p>
<h4 id="示例">示例</h4>
<p>我有一例，请诸位静观。</p>
<pre tabindex="0"><code># 在 Linux 环境做出 librime 及命令行工具
cd librime
make

# 準备示例文件（有三）
# 做一个构建扩展包专用的方案，以示如何独立於主词典的构建流程。
# 如果不需要把扩展包和主词典分开製备，也可以用原有的输入方案。
cat &gt; build/bin/luna_pinyin_packs.schema.yaml &lt;&lt;EOF
# Rime schema
schema:
  schema_id: luna_pinyin_packs

translator:
  dictionary: luna_pinyin_packs
  packs:
    - sample_pack
EOF

# 代用的主词典。因为本示例只构建扩展包。
# 做这个文件的目的是不必费时地编译导入了预设词汇表的朙月拼音主词典。
# 如果在主词典的构建流程生成扩展包，则可直接使用主词典文件。
cat &gt; build/bin/luna_pinyin_packs.dict.yaml &lt;&lt;EOF
# Rime dict
---
name: luna_pinyin_packs
version: &#39;1.0&#39;
sort: original
use_preset_vocabulary: false
import_tables:
  - luna_pinyin
...

EOF

# 扩展包源文件
cat &gt; build/bin/sample_pack.dict.yaml &lt;&lt;EOF
# Rime dict
---
name: sample_pack
version: &#39;1.0&#39;
sort: original
use_preset_vocabulary: false
...

粗鄙之语	cu bi zhi yu
EOF

# 製作扩展包
(cd build/bin; ./rime_deployer --compile luna_pinyin_packs.schema.yaml)
# 构建完成后可丢弃代用的主词典，只留扩展包
rm build/bin/build/luna_pinyin_packs.*

# 重新配置朙月拼音输入方案，令其加载先时生成的词典扩展包
(cd build/bin; ./rime_patch luna_pinyin &#39;translator/packs&#39; &#39;[sample_pack]&#39;)
# 验证词典可查到扩展包中的词语
echo &#39;cubizhiyu&#39; | (cd build/bin; ./rime_console)
</code></pre><h4 id="总结">总结</h4>
<p>与编译词典时导入码表的方法相比，使用词典扩展包有两项优势：</p>
<ul>
<li>扩展包可以独立於主词典及其他扩展包单独构建，增量添加扩展包不必重复编译完整的主词典，减少编译时间及资源开销；</li>
<li>词典扩展包的编译单元与词典源文件粒度一致，方便组合使用，增减扩展包只须重新配置输入方案。</li>
</ul>
<p>需要注意的是，查询时使用主词典的音节表，这要求扩展包使用相同的音节表构建。 目前 librime 并没有机制保证加载的扩展包与主词典兼容。用家须充分理解该功能的实现机制，保证数据文件的一致性。 这也意味着二进制扩展包不宜脱离於主词典而製作和分发。</p>
<h2 id="定制指南详解">定制指南详解</h2>
<p>先来一个阅读自检吧~</p>
<ul>
<li>[[#必知必会]]</li>
<li>[[#Rime 中的数据文件分布及作用]]</li>
<li>[[#方案制作详解]]</li>
<li>[[#定制指南]]</li>
</ul>
<pre tabindex="0"><code>patch:
  &#34;一组设定项/二级设定项/三级设定项&#34;: 新的设定值
  &#34;另一个设定项&#34;: 新的设定值
  &#34;再一个设定项&#34;: 新的设定值
  &#34;含列表的设定项/@0&#34;: 列表第一个元素新的设定值
  &#34;含列表的设定项/@last&#34;: 列表最后一个元素新的设定值
  &#34;含列表的设定项/@before 0&#34;: 在列表第一个元素之前插入新的设定值（不建议在补丁中使用）
  &#34;含列表的设定项/@after last&#34;: 在列表最后一个元素之后插入新的设定值（不建议在补丁中使用）
  &#34;含列表的设定项/@next&#34;: 在列表最后一个元素之后插入新的设定值（不建议在补丁中使用）
</code></pre><h3 id="定制每页候选数">定制每页候选数</h3>
<p>Rime 中，默认每页至多显示 5 个候选项，而允许的范围是 1~9（个别 Rime 发行版可支持 10 个候选）。</p>
<p>设定每页候选个数的默认值为 9，在用户目录建立文档 <code>default.custom.yaml</code> ：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;menu/page_size&#34;: </span><span style="color:#099">9</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>重新布置即可生效。</p>
<p><strong>〔注意〕</strong> 如果 <code>default.custom.yaml</code> 里面已经有其他设定内容，只要以相同的缩进方式添加 <code>patch:</code> 以下部分，不可重复 <code>patch:</code> 这一行。</p>
<p>若只需要将单独一个输入方案的每页候选数设为 9 ，以朙月拼音为例，建立文档 <code>luna_pinyin.custom.yaml</code> 写入相同内容，重新部署即可生效。</p>
<h3 id="定制标点符号">定制标点符号</h3>
<p>有的用户习惯以 <code>/</code> 键输入标点 <code>、</code>。</p>
<p>仍以朙月拼音为例，输入方案有以下设定：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>解释：</p>
<p><code>punctuator</code> 是 Rime 中负责转换标点符号的组件。该组件会从设定中读取符号映射表，而知道该做哪些转换。</p>
<p><code>punctuator/import_preset</code> 是说，本方案要继承一组预设的符号映射表，要从另一个设定档 <code>default.yaml</code> 导入。</p>
<p>查看 <code>default.yaml</code> ，确有如下符号表：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">full_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic"># ……其他……</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>／, &#34;/&#34;, ÷ ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic"># ……其他……</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">half_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic"># ……其他……</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#d14">&#34;/&#34;</span>,<span style="color:#bbb"> </span>／, ÷ ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#998;font-style:italic"># ……其他……</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>可见按键 <code>/</code> 是被指定到  <code>&quot;/&quot;, ／, ÷</code> 等一组符号了。并且全角和半角状态下，符号有不同的定义。</p>
<p>欲令 <code>/</code> 键直接输出 <code>、</code>，可如此定制  <code>luna_pinyin.custom.yaml</code>:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">punctuator/full_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;、&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">punctuator/half_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;、&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>以上在输入方案设定中写入两组新值，合并后的输入方案成为：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">punctuator</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">import_preset</span>:<span style="color:#bbb"> </span>default<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">full_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;、&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">half_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#d14">&#34;/&#34;</span><span style="color:#bbb"> </span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;、&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>含义是在由 <code>default</code> 导入的符号表之上，覆写对按键 <code>/</code> 的定义。</p>
<p>通过这种方法，即直接继承了大多数符号的默认定义，又做到了局部的修改化。</p>
<h3 id="定制简化字输出">定制简化字输出</h3>
<p>注意，如果你只需要 Rime 输出简化字，敲 <code>Ctrl+~</code> 组合键，从菜单中选择「漢字→汉字」即可！</p>
<p>本例说明旨在说明其中原理，以及通过设定档修改预设输出字形的方法。</p>
<p>Rime 预设的词汇表中使用传统汉字。这是因为传统汉字较简化字提供了更多信息，做「繁→简」转换能够保证较高的精度。</p>
<p>Rime 中的过滤器组件 <code>simplifier</code>，完成对候选词的繁简转换。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">switches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>ascii_mode<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">reset</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>中文, 西文 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>full_shape<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>半角, 全角 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>simplification   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 转换开关</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>漢字, 汉字 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- simplifier           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 必要组件一</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- uniquifier           <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 必要组件二</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>以上是朙月拼音中有关繁简转换功能的设定。</p>
<p>在 <code>engine/filters</code> 中，除了 <code>simplifier</code>，还用了一件 <code>uniquifier</code>。 这是因为有些时候，不同的候选会转化为相同的简化字，例如「鐘→钟」、「鍾→钟」。 <code>uniquifier</code> 的作用是在 <code>simplifier</code> 执行转换之后，将文字相同的候选项合并。</p>
<p>该输入方案设有三个状态开关：中／西文、全／半角、繁简字。即 <code>switches</code> 之下三项。</p>
<p>每个开关可以在两种状态（<code>states</code>）之间转换，<code>simplifier</code> 依据名为 <code>simplification</code> 的开关状态来决定是否做简化：</p>
<ul>
<li>初始状态下，输出为传统汉字，〔 方案选单 〕中的开关选项显示为「漢字→汉字」；</li>
<li>选择该项后，输出为简化汉字，〔 方案选单 〕中显示 「汉字→漢字」；</li>
<li>Rime 会记忆你的选择，下次打开输入法时，直接切换到所选的字形；</li>
<li>亦可无视上次记住的选择，在方案中重设初始值：<code>reset</code> 设为 <code>0</code> 或 <code>1</code>，分别选中 <code>states</code> 列表中的两种状态。</li>
</ul>
<p>如日常应用以简化字为主，则每每在〔 方案选单 〕中切换十分不便。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">switches</span>:<span style="color:#bbb">                   </span><span style="color:#998;font-style:italic"># 注意缩进</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>ascii_mode<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">reset</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">                </span><span style="color:#998;font-style:italic"># reset 0 的作用是当从其他输入方案切换到本方案时，</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>中文, 西文 ]  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 重设为指定的状态，而不保留在前一 个方案中设定的状态。</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>full_shape        <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 选择输入方案后通常需要立即输入中文，故重设 ascii_mode = 0；</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>半角, 全角 ]  <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 而全／半角則可沿用之前方案中的用法。</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>simplification<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">reset</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">                </span><span style="color:#998;font-style:italic"># 增加这一行：默認啓用「繁→简」转换。</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>漢字, 汉字 ]<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其实预设输入方案中就提供一丈朙月拼音的简化字版本，名为简化字，以应大家“填表”之需。看他的代码如何与上篇定制档写得不同：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin_simp.schema.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">switches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>ascii_mode<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">reset</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>中文, 西文 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>full_shape<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>半角, 全角 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>zh_simp          <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 注意这里（※1）</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">reset</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">states</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span>漢字, 汉字 ]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">simplifier</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">option_name</span>:<span style="color:#bbb"> </span>zh_simp     <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 和这里（※2）</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>前方说，<code>simplifier</code> 这个组件会检查名为 <code>simplification</code> 的开关状态；而这款简化字方案却用了一个不同名的开关 <code>zh_simp</code> ，即  ※1 处所示；并通过在 ※2 行设定  <code>simplifier/option_name</code> 告知  <code>simplifier</code> 组件所需关注的开关名字。</p>
<p>何故？</p>
<p>还记是否，前文对「全／半角」这个开关的讨论 &ndash; 当切换方案时，未明确使用 <code>reset</code> 重置的开关，会保持之前设定过的状态。</p>
<p>朙月拼音等多数方案，并未重设  <code>simplification</code> 这个选项 &ndash; 因为用户换了一种输入编码的方式，并不意味着需要变更输出的字形。</p>
<p>而简化字这一方案不同，恰恰是表达变更输出字形的需求；用户再从简化字切回朙月拼音时，一定是为了回到繁体输出模式。所以令简化字使用独立命名的开关、而非方案间共用的 <code>simplification</code> 开关，以避免影响其他输入方案的繁简转换状态。</p>
<h3 id="默认英文输出">默认英文输出</h3>
<p>有些用户习惯默认英文输出，在需要用中文时再做切换。这就需要键们在方案中重设状态开关初始值。</p>
<p>还记得吗？我们可用 <code>reset</code> 设定项在方案中为某些状态开关重设初始值：<code>reset</code> 设为 0 或 1，分别选中 <code>states</code> 列表中的两种状态。</p>
<p>我们以朙月拼音为例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;switches/@0/reset&#34;: </span><span style="color:#099">1</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 表示将 switcher 列表中的第一个元素（即 ascii_mode 开关）的初始值重設为状态1（即「英文」）。</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="定制方案选单">定制方案选单</h3>
<p>在「 小狼毫 」方案选单设定介面上勾勾选选，就可以如此定制输入方案列表：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># default.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">schema_list</span>:<span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 对于列表类型，现在没有办法指定如何添加、消除或单一修改某项，于是要在定制档中将整个列表替换</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">schema</span>:<span style="color:#bbb"> </span>luna_pinyin<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">schema</span>:<span style="color:#bbb"> </span>cangjie5<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">schema</span>:<span style="color:#bbb"> </span>luna_pinyin_fluency<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">schema</span>:<span style="color:#bbb"> </span>luna_pinyin_simp<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#000080">schema</span>:<span style="color:#bbb"> </span>my_coolest_ever_schema <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 这样就启用了未曾有过的高级输入方案，其实这么好的方案应该排在最前面哈</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>没有设定界面时，又想启用、禁用某个输入方案，手写这样一份定制档，重新部署就好啦。</p>
<h3 id="定制唤出方案选单的快捷键">定制唤出方案选单的快捷键</h3>
<p>呼出方案选单，默认快捷键为 <code>Ctrl+~</code> 或 <code>F4</code> 。</p>
<p>不过有些同学电脑上默认快捷键与其他软件有冲突，那么如何定义更好的键位呢？</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># default.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;switcher/hotkeys&#34;: </span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 这个列表里第项定义一个快捷键，使哪个都可以</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;Control+s&#34;</span><span style="color:#bbb">      </span><span style="color:#998;font-style:italic"># 添加 Ctrl+s</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#34;Control+grave&#34;</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 你看写法并不是 Ctrl+` 而是与 IBus 一致的表示法</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- F4<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>按键定义的格式为「 修饰符甲 + 修饰符乙 + &hellip; + 按键名称 」，加号为分隔符，要写出。</p>
<p>所谓修饰符，就是以下组合键的状态标识或是按键弹起的标识：</p>
<ul>
<li>Release —— 按键被放开，而不是按下；</li>
<li>Shift</li>
<li>Control</li>
<li>Alt——Windows 上 <code>Alt+字母</code> 会被系统优先识别为程序菜单项的快捷键，当然 Alt+Tab 也不可用；</li>
<li>嗯，Linux 发行版还支持 Super, Meta 等組合键，不过最好选每个平台都能用的啦。</li>
</ul>
<p>按键的名称，大小写字母选数字都用它们自己表示，其他按键名称参考 [[#其它|细项配置-按键]] 章节。</p>
<h3 id="定制小狼毫字体字号">定制小狼毫字体字号</h3>
<p>虽然与输入方案无关，也在此列出以作参考。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># weasel.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;style/font_face&#34;: </span><span style="color:#d14">&#34;明兰&#34;</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 字体名称，从记事本等处的系统字体对话框里能看到</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;style/font_point&#34;: </span><span style="color:#099">14</span><span style="color:#bbb">     </span><span style="color:#998;font-style:italic"># 字号，只认数字，不认「五号」、「小五」这样的</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="定制小狼毫配色方案">定制小狼毫配色方案</h3>
<p>注：这款配色已经在新版本的小狼毫里预设了，做练习时，你可以将文中  <code>starcraft</code> 换成自己命名的标识。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># weasel.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;style/color_scheme&#34;: </span>starcraft   <span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 这项用于选中下面定义的新方案</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#34;preset_color_schemes/starcraft&#34;: </span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 在配色方案列表里加入标识为 starcraft 的新方案</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>星際我爭霸／StarCraft<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">author</span>:<span style="color:#bbb"> </span>Contralisk &lt;contralisk@gmail.com&gt;, original artwork by Blizzard Entertainment<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">text_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0xccaa88</span><span style="color:#bbb">             </span><span style="color:#998;font-style:italic"># 编码行文字顏色，24位色值，用十六进制书写方便些，順序是蓝绿红 0xBBGGRR</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">candidate_text_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0x30bb55</span><span style="color:#bbb">   </span><span style="color:#998;font-style:italic"># 候选项文字颜色，当与文字颜色不同时指定</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">back_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0x000000</span><span style="color:#bbb">             </span><span style="color:#998;font-style:italic"># 底色</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">border_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0x1010a0</span><span style="color:#bbb">           </span><span style="color:#998;font-style:italic"># 边框颜色，与底色相同则为无边框的效果</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">hilited_text_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0xfecb96</span><span style="color:#bbb">     </span><span style="color:#998;font-style:italic"># 高亮文字，即与当前高亮候选对应的那部份输入码</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">hilited_back_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0x000000</span><span style="color:#bbb">     </span><span style="color:#998;font-style:italic"># 设定高亮文字的底色，可起到突显高亮部份的作用</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">hilited_candidate_text_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0x60ffa8</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 高亮候选项的文字颜色，要醒目！</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">hilited_candidate_back_color</span>:<span style="color:#bbb"> </span><span style="color:#099">0x000000</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 高亮候选项的底色，若与背景色不同就会显出光棒</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>效果自己看！</p>
<p>也可以参照这张比较直观的图：</p>
<p>![[assets/Pasted image 20250109111833.png]]</p>
<p>另，此处有现成的配色方案工具供用户调配：</p>
<ul>
<li>🌟 小狼毫： <a href="https://bennyyip.github.io/Rime-See-Me/">https://bennyyip.github.io/Rime-See-Me/</a></li>
<li>鼠须管： <a href="https://gjrobert.github.io/Rime-See-Me-squirrel/">https://gjrobert.github.io/Rime-See-Me-squirrel/</a></li>
</ul>
<h2 id="配置文件详解">配置文件详解</h2>
<p>Rime 配置文件，用於设置输入法引擎、输入法客户端的运行参数，也包括输入方案及词典配置。</p>
<p>文件格式：採用 UTF-8 编码的 YAML 文本。</p>
<p>位置及组织方式： Rime 所使用的配置文件在 用户文件夹 及 共享文件夹。</p>
<h3 id="语法">语法</h3>
<p>在 YAML 语法的基础上，增设以下编译指令：</p>
<h4 id="包含">包含</h4>
<p><code>__include:</code> 指令在当前位置包含另一 YAML 节点的内容。</p>
<p>可写在配置源文件任一 YAML map 节点下。其语法为</p>
<pre tabindex="0"><code>include_example_1:
  __include: local/node

local:
  node: contents to include
</code></pre><p>被引用的节点可以来自另一个配置文件。 目标配置节点的路径以 <code>&lt;filename&gt;:/ </code>开始，可省略扩展名 <code>.yaml</code>。</p>
<pre tabindex="0"><code>include_example_2:
  __include: config:/external/node

include_example_3:
  __include: config.yaml:/external/node
</code></pre><p>包含整个文件，可指定路径为目标配置文件的根节点：</p>
<pre tabindex="0"><code>include_example_4:
  __include: config.yaml:/
</code></pre><p>包含另一个 YAML map 节点后，源文件中 <code>__include:</code> 指令所在 map 除编译指令外的其他数据与被包含的 map 合併：</p>
<pre tabindex="0"><code>include_example_5:
  __include: some_map
  occupation: journalist # new key and value
  simplicity: very # override value for included key

some_map:
  simplicity: somewhat
  naivety: sometimes
</code></pre><p>合併发生在 <code>__include:</code> 指令所在节点，不会修改被引用节点 <code>some_map</code> 的内容。</p>
<p>包含 YAML 列表，则指令所在 map 节点替换为所引用的 YAML 列表。 该 map 节点不应包含任何编译指令以外的 key-value，因为不相容於 YAML 列表类型。</p>
<p>也不能直接在该节点下追加列表项，因为 YAML 语法不允许混合 map 与 list。 在包含列表后追加、修改列表项，必须使用下文介绍的<code> __append:</code> 或 <code>__patch:</code> 指令。</p>
<pre tabindex="0"><code>include_example_6:
  __include: some_list
  __append:
    - someone else

some_list:
  - youngster
  - elder
</code></pre><h4 id="补靪">补靪</h4>
<p>修改某一相对路径下的配置节点，而非当前节点的整体。 基本语法为：</p>
<pre tabindex="0"><code>__patch:
  key/alpha: value A
  key/beta: value B
</code></pre><p>目标节点路径的写法为将各级 map 的 key 用 / 分隔。 因此 key 如果包含 / 字符，则不能作为节点路径的一部分。</p>
<p>可在节点路径末尾添加 /+ 操作符，表示合併 list 或 map 节点； 或者（可选地）添加 /= 表示用指定的值替换目标节点原有的值。 若未指定操作符，<code>__patch:</code> 指令的默认操作为替换。</p>
<p>以下是一些示例：</p>
<pre tabindex="0"><code>patch_example_1:
  sibling: old value
  append_to_list:
    - existing item
  merge_with_map:
    key: value
  replace_list:
    - item 1
    - item 2
  replace_map:
    a: value
    b: value
  __patch:
    sibling: new value
    append_to_list/+:
      - appended item
    merge_with_map/+:
      key: new value
      new_key: value
    replace_list/=:
      - only item
    replace_map/=:
      only_key: value
</code></pre><p>以上示例仅为表现 <code>__patch</code>: 的作用方式。 实际上在当前节点和补靪内容均为字面值的情况下，没有打补靪的必要。 字面值补靪通常用於当前节点包含了其他节点，并需要修改部份配置项的场景：</p>
<pre tabindex="0"><code>patch_example_2:
  __include: patch_example_1
  __patch:
    sibling: even newer value
    append_to_list/+:
      - another appended item
</code></pre><p>由於 YAML map 的 key 是无序的，书写顺序并不决定编译指令的先后。</p>
<p>同一节点下，编译指令的执行顺序为： <code>__include:</code> 包含指定节点 → 合併当前节点下的其他 key-value 数据 → <code>__patch:</code> 修改子节点。</p>
<p><code>__patch:</code> 指令的另一种主要用法是引用另一个节点中的补靪内容，并作用於指令所在节点：</p>
<pre tabindex="0"><code>patch_example_3:
  __patch: changes
  some_list:
    - youngster
    - elder
  some_map:
    simplicity: somewhat
    naivety: sometimes

changes:
  some_list/+:
    - someone else
  some_map/simplicity: too much
</code></pre><p>YAML 语法不允许 map 有重复的 key。 如果要引用不同位置的多项补靪，可以为 <code>__patch:</code> 指定一个列表，其中每项通过节点引用定义一组补靪：</p>
<pre tabindex="0"><code>patch_example_4:
  __include: base_config
  __patch:
    - company_standard
    - team_convention
    - personal_preference

base_config:
  actors: []
  company_info:
    based_in: unknown location
  favorites: {}

company_standard:
  company_info/based_in: american san diego

team_convention:
  actors/+:
    - feifei
    - meimei
    - riri

personal_preference:
  favorites/fertilizer: jinkela
</code></pre><h4 id="用补靪指令修改列表">用补靪指令修改列表</h4>
<p>补靪指令中，目标节点路径由各级节点的 key 组成。 若某一节点为 list 类型，可以 @&lt;下标&gt; 形式指定列表项。下标从 0 开始计数。 无论列表长度，末位列表元素可表示为 @last。</p>
<pre tabindex="0"><code>patch_list_example_1:
  some_list/@0/simplicity: very
  some_list/@last/naivety: always

some_list:
  - simplicity: somewhat
  - naivety: sometimes
</code></pre><p>在指定元素之前、之后插入列表元素，用 @before &lt;下标&gt;、@after &lt;下标&gt;。 @after last 可简写为 @next，向列表末尾添加元素：</p>
<pre tabindex="0"><code>patch_list_example_2:
  &#39;some_list/@before 0/youthfulness&#39;: too much
  &#39;some_list/@after last/velocity&#39;: greater than westerners
  some_list/@next/questions: no good
</code></pre><h4 id="可选的包含与补靪">可选的包含与补靪</h4>
<p>若包含或补靪指令的目标是以 ? 结尾的节点路径， 则当该路径对应的节点（或所属外部配置文件）不存在时，不產生编译错误。</p>
<p>如：</p>
<pre tabindex="0"><code>__patch: default.custom:/patch?

nice_to_have:
  __include: optional_config?
</code></pre><h4 id="追加与合併">追加与合併</h4>
<p>追加指令 <code>__append:</code> 将其下的列表项追加到该指令所在的节点。 合併指令 <code>__merge:</code> 将其下的 map 合併到该指令所在的节点。</p>
<p>这两条指令只能用在 <code>__include:</code> 指令所在节点及其（字面值）子节点。</p>
<pre tabindex="0"><code>append_merge_example_1:
  __include: starcraft
  __merge:
    made_by: blizzard entertainment
    races:
      __append:
        - protoss
        - zerg

starcraft:
  first_release: 1998
  races:
    - terrans
</code></pre><p>实际书写配置时，<code>__merge:</code> 指令往往省略。 因为 <code>__include:</code> 指令自动合併其所在节点下的 key-value 并递归地合併所有 map 类型的子节点。</p>
<p>而对於类型为 list 的子节点，默认操作是替换整个列表。 如果要以向后追加列表项的方式合併，除了 <code>__append:</code> 指令之外，还可以採用 /+ 操作符：</p>
<pre tabindex="0"><code>append_merge_example_2:
  __include: starcraft
  made_by: blizzard entertainment
  races/+:
    - protoss
    - zerg
</code></pre><p>在 <code>__include:</code> 指令自动合併的节点树中，如果要对某个 map 类型的子节点整体替换，可使用 /= 操作符：</p>
<pre tabindex="0"><code>revealed_map:
  __include: old_map
  terran_command_center/=:
    x: 3.14
    y: 6.28
old_map:
  terran_command_center:
    location: unexplored
  protoss_nexus: {x: 128, y: 256}
  zerg_hatchary: {x -1024, y: 0}
</code></pre><p>案例解析：</p>
<p><a href="https://github.com/rime/librime/pull/192#issuecomment-371202389">https://github.com/rime/librime/pull/192#issuecomment-371202389</a></p>
<h3 id="配置编译器插件">配置编译器插件</h3>
<p>自动添加一些隐含的编译指令，用来实现对原有补靪机制以及导入成套组件配置等语法的兼容。</p>
<p>这些插件的作用是将当前输入方案所需的全部配置内容在部署期间汇总到一份编译结果文件里。使输入法程序不必在运行时打开众多的配置文件。</p>
<h4 id="自动应用补靪">自动应用补靪</h4>
<p>配置文件的根节点如果没有使用 <code>__patch:</code> 指令，则在源文件编译完成后，自动插入以下指令：</p>
<p>（註：请将实际的配置名称代入 <code>&lt;config&gt;</code>）</p>
<pre tabindex="0"><code># &lt;config&gt;.yaml 或 &lt;config&gt;.schema.yaml 的根节点
__patch: &lt;config&gt;.custom:/patch?
</code></pre><p>如果存在与旧版本 librime 兼容的补靪文件，则从中加载补靪：</p>
<pre tabindex="0"><code># &lt;config&gt;.custom.yaml
patch:
  key: value
</code></pre><p>以上插件的效果相当於</p>
<pre tabindex="0"><code># &lt;config&gt;.yaml 或 &lt;config&gt;.schema.yaml 的根节点
__patch:
  key: value
</code></pre><p>如果源文件的根节点使用了 <code>__patch:</code> 指令，则不论其是否加载 <code>&lt;config&gt;.custom:/patch</code>，都不再添加自动补靪指令。 如果这种情况下仍希望支持补靪文件，须将其列为 <code>__patch:</code> 列表中的一项：</p>
<pre tabindex="0"><code># &lt;config&gt;.yaml 或 &lt;config&gt;.schema.yaml 的根节点
__patch:
  - other_patch # ...
  - &lt;config&gt;.custom:/patch?
</code></pre><h4 id="应用默认配置">应用默认配置</h4>
<p>输入方案中未指定以下配置项时，自动导入默认配置 default.yaml 的定义：</p>
<pre tabindex="0"><code>menu:
  page_size: # ...
</code></pre><h4 id="导入成套组件配置">导入成套组件配置</h4>
<p>将部份组件配置中的 <code>&lt;component&gt;/import_preset: &lt;config&gt;</code> 语法翻译为</p>
<p>（註：请将实际的配置名称和组件名称代入 <code>&lt;config&gt;、&lt;component&gt;</code>）</p>
<pre tabindex="0"><code>&lt;component&gt;:
  __include: &lt;config&gt;:/&lt;component&gt;
  # 以下为输入方案覆盖定义的内容
</code></pre><p>注意：如果指定的配置节点 <code>&lt;config&gt;:/&lt;component&gt;</code> 不存在会导致输入方案编译错误。</p>
<p>导入韵书配置
（尚未实现）导入 <code>*.dict.yaml</code> 的 YAML 配置部份。</p>
<h3 id="加载规则">加载规则</h3>
<p>以上介绍的编译指令及编译器插件，仅对交给 配置编译器 处理的 源文件 有效。</p>
<p>配置源文件的位置详见 用户文件夹 及 共享文件夹。</p>
<p>输入法程序运行时读取的配置文件是 编译结果文件（可能是 YAML 格式或二进制格式）。 编译结果只包含直接供程序读取的配置内容，而不再包含有特殊含义的编译指令。</p>
<p>配置的编译结果文件与源文件并非一一对应的关系， 而是合併重组为编译后的默认配置 <code>default</code> 以及各输入方案的配置。</p>
<p>其他不经过编译处理而直接在运行时由输入法程序存取的配置文件有： <code>installation.yaml</code>, <code>user.yaml</code> 等。</p>
<p>韵书 文件中的 YAML 配置部份目前也不支持配置编译指令。</p>
<p>TODO(rime/docs): 详解 YAML 节点树及编译指令的解析、执行顺序。</p>
<h3 id="配置组件调用方式">配置组件调用方式</h3>
<p>TODO(rime/engine): 完成本节</p>
<h3 id="代码风格">代码风格</h3>
<p>YAML 书写样式参照 yaml.org 的示例。推荐以下风格：</p>
<p>配置文件开头用註释行简述文件的内容和使用方法。</p>
<p>缩进：用两个空格缩进。</p>
<p>字符串值：无特殊字符时不使用引号； 需要使用引号时，优先用单引号，以减少双引号引起的字符转义问题。</p>
<p>flow-style list: 仅在节点树的最内层使用。不嵌套使用。元素较多时不用。</p>
<p>flow-style map: 仅在节点树的最内层使用。不嵌套使用。元素较多时不用。</p>
<p>仅包含一对 key-value 的 map 作为列表项时，省略 <code>{ }</code> 并与 <code>-</code> 写在同一行。</p>
<p>不推荐使用 YAML 的锚点（<code>&amp;</code>）和别名引用（<code>*</code>）。请用本文介绍的 <code>__include:</code> 编译指令。</p>
<h3 id="错误处理">错误处理</h3>
<p>部署后出现错误，请查看 INFO 日誌（参考）， 找到行首字符为 E 的记录，根据错误信息以及上下文排查出错的配置文件。</p>
<p>未出现错误信息，配置亦未达到预期效果，请对照 &lt;用户文件夹&gt;/build/ 文件夹内的编译结果文件，检查配置源文件与补靪。</p>
<h3 id="版本控制">版本控制</h3>
<p>输入方案及配置的版本可以用文件中的一项 字符串值 记录。如：version: &lsquo;3.14&rsquo;</p>
<p>版本号习惯以形为 X.Y.Z 的多个数字组成。 为避免将版本号解析为 YAML 数值类型而发生错误，如 0.10（〇点十）不同於 0.1（〇点一）， 应一律为版本号加上引号 &lsquo;3.14&rsquo; 以示其为字符串类型。</p>
<h3 id="分发">分发</h3>
<p>输入方案设计师完成输入方案及配套韵书后，将源文件发佈在一间 GitHub 代码库， 用家便可通过 Rime 配置管理工具 东风破 获取输入方案的最新版本并安装到输入法。</p>
<h2 id="diy-处方集">DIY 处方集</h2>
<p>已将一些定制 Rime 的常见问题、解法及定制档链接收录于此。</p>
<p>建议你首先读完《 定制指南 》，通晓相关原理，以正确运用这些处方。</p>
<h3 id="初始设定">初始设定</h3>
<h4 id="在方案选单中添加五笔双拼">在方案选单中添加五笔、双拼</h4>
<p><a href="https://gist.github.com/2309739">https://gist.github.com/2309739</a></p>
<p>在 Rime 输入方案选单中添加五笔、双拼、粤拼、注音，保留你需要的。</p>
<pre tabindex="0"><code># default.custom.yaml
# save it to: 
#   ~/.config/ibus/rime  (linux)
#   ~/Library/Rime       (macos)
#   %APPDATA%\Rime       (windows)

patch:
  schema_list:
    - schema: luna_pinyin          # 朙月拼音
    - schema: luna_pinyin_simp     # 朙月拼音 简化字模式
    - schema: luna_pinyin_tw       # 朙月拼音 臺灣正體模式
    - schema: terra_pinyin         # 地球拼音 dì qiú pīn yīn
    - schema: bopomofo             # 注音
    - schema: bopomofo_tw          # 注音 臺灣正體模式
    - schema: jyutping             # 粵拼
    - schema: cangjie5             # 倉頡五代
    - schema: cangjie5_express     # 倉頡 快打模式
    - schema: quick5               # 速成
    - schema: wubi86               # 五笔86
    - schema: wubi_pinyin          # 五笔拼音混合輸入
    - schema: double_pinyin        # 自然碼雙拼
    - schema: double_pinyin_mspy   # 微軟雙拼
    - schema: double_pinyin_abc    # 智能ABC雙拼
    - schema: double_pinyin_flypy  # 小鶴雙拼
    - schema: wugniu               # 吳語上海話（新派）
    - schema: wugniu_lopha         # 吳語上海話（老派）
    - schema: sampheng             # 中古漢語三拼
    - schema: zyenpheng            # 中古漢語全拼
    - schema: ipa_xsampa           # X-SAMPA 國際音標
    - schema: emoji                 # emoji表情
</code></pre><p>看这个例子，可以应用任一预设或自定义输入方案，如【粵拼】、【注音】等。（详解：参见前方 [[#定制方案选单]] 一节）。</p>
<p>如果下载自己制作了非预设输入方案，将源文件复制到用户文件夹后，也用上面的方法将方案标识加入选单。</p>
<p>修改后重新部署生效。</p>
<h4 id="小狼毫外观设定">【小狼毫】外观设定</h4>
<p>上文已介绍设定字体、字号、制作配色方案的方法。</p>
<p>使用横向候选栏，嵌入式编码行：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># weasel.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">style/horizontal</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">         </span><span style="color:#998;font-style:italic"># 候选橫排</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">style/inline_preedit</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">     </span><span style="color:#998;font-style:italic"># 內嵌编码（仅支持TSF）</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">style/display_tray_icon</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 显示托盘图标</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="鼠须管外观与键盘设定">【鼠须管】外观与键盘设定</h4>
<p>鼠须管从  0.9.6 版本开始支持选择配色方案，用  <code>squirrel.custom.yaml</code> 保存用户的设定。</p>
<p><a href="https://gist.github.com/2290714">https://gist.github.com/2290714</a></p>
<p><code>&gt; 【鼠鬚管】定製檔</code></p>
<pre tabindex="0"><code># 適用於【鼠鬚管】0.9.13+
# 位置：~/Library/Rime/squirrel.custom.yaml
# 用法：想要哪項生效，就刪去該行行首的#字符，但注意保留用於縮進的空格

patch:
#  us_keyboard_layout: true      # 鍵盤選項：應用美式鍵盤佈局
#  show_notifications_when: growl_is_running  # 狀態通知，默認裝有Growl時顯示，也可設爲全開（always）全關（never）
#  style/horizontal: true        # 候選窗横向顯示
#  style/inline_preedit: false   # 非內嵌編碼行
#  style/font_face: &#34;儷黑 Pro&#34;    # 我喜歡的字體名稱
#  style/font_point: 21          # 字號
#  style/corner_radius: 10       # 窗口圓角半徑
#  style/border_height: 0        # 窗口邊界高度，大於圓角半徑才有效果
#  style/border_width: 0         # 窗口邊界寬度，大於圓角半徑才有效果
#  style/color_scheme: luna      # 選擇配色方案

# 註：預設的配色方案及代碼（指定爲 style/color_scheme ）
#   系統默認色系 - native
#   碧水 - aqua
#   青天 - azure
#   明月 - luna
#   墨池 - ink
#   孤寺 - lost_temple
#   暗堂 - dark_temple
#   星際我爭霸 - starcraft
#   谷歌 - google
#   曬經石 - solarized_rock
#   简约白 - clean_white
</code></pre><p>ibus用户： <code>ibus_rime.custom.yaml</code> 不包含控制配色、字体字号等外观样式的设定。</p>
<h3 id="在特定程序里开关中文输入">在特定程序里开关中文输入</h3>
<p>【鼠须管】0.9.9 开始支持这项设定：</p>
<p>这指定的应用程序中，改变输入法的初始转换状态。如在：</p>
<ul>
<li>终端 <code>Terminal / iTerm</code> ；</li>
<li>代码编辑器 <code>MacVim</code> ；</li>
<li>快速启动工具 <code>QuickSilver / Alfred</code> 等程序里很少需要輸入中文，于是鼠须管在這些程序里置信不开启中文输入。</li>
</ul>
<p>自定义 Mac 应用程序的初始转换状态，首先查看应用的 <code>Info.plist</code> 文件得到该应用的  <code>Bundle Identifier</code>，通常是形如 <code>com.apple.Xcode</code> 的字符串。</p>
<p>例如，要在 <code>Xcode</code> 里面默认开关中文输入，又要在 <code>Alfred</code> 里面恢复开启中文输入，可如此设定：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># example squirrel.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">app_options/com.apple.Xcode</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">ascii_mode</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">app_options/com.alfredapp.Alfred</span>:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注：一些版本的 <code>Xcode</code> 标识为 <code>com.apple.dt.Xcode</code>，请注意查看 <code>Info.plist</code>。</p>
<p>【小狼毫】0.9.16 亦开始支持这项设定。</p>
<p>例如，要在 <code>gVim</code> 里面默认开关中文输入，可如此设定：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># example weasel.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">app_options/gvim.exe</span>:<span style="color:#bbb">  </span><span style="color:#998;font-style:italic"># 程序名字全用小写字母</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">ascii_mode</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="输入习惯">输入习惯</h3>
<h4 id="使用-control-键切换中西文">使用 Control 键切换中西文</h4>
<p><a href="https://gist.github.com/2981316">https://gist.github.com/2981316</a></p>
<p><code>&gt; 使用 Control 键切换中西文，上屏已输入的编码；令 Caps Lock 改变字母的大小写</code></p>
<pre tabindex="0"><code># 中西文切换键的默认设置写在 default.yaml 里面
# 以下的 default.custom.yaml 在全局范围重定义该组快速键
#
# 可用的按键有 Caps_Lock, Shift_L, Shift_R, Control_L, control_R
# Mac 系统上的鼠鬚管不能区分左、右，因此只有对 Shift_L, Control_L 的设定起作用
#
# 已输入编码时按切换键，可以进一步设定输入法中西文切换的形式。
# 可选的临时切换策略有三：
# inline_ascii 在输入法的临时西文编辑区内输入字母、数字、符号、空格等，回车上屏后自动复位到中文
# commit_text 已输入的候选文字上屏并切换至西文输入模式
# commit_code 已输入的编码字符上屏并切换至西文输入模式
# 设为 noop，屏蔽该切换键
#
# 如果要把 Caps Lock 设为只改变字母的大小写而不做中西文切换，可将 Caps_Lock 对应的切换方式设为 noop
# 如果要以 Caps Lock 切换到西文模式，默认输出小写字母，请置 ascii_composer/good_old_caps_lock: false
# 如果要以 Caps Lock 切换到西文模式，默认输出大写字母，请使用以下设置：

patch:
  ascii_composer/good_old_caps_lock: true
  ascii_composer/switch_key:
    Caps_Lock: commit_code
    Shift_L: noop
    Shift_R: noop
    Control_L: commit_code
    Control_R: commit_code
</code></pre><p>以及修改 Caps Lock、左右 Shift、左右 Control 键的行为，提供三种切换方式。 详見 Gist 代码注释。</p>
<h4 id="方便地输入含数字的西文用戶名">方便地输入含数字的西文用戶名</h4>
<p>通常，输入以小写拉丁字母组成的编码后，数字键的作用是选择相应序号的候选字。</p>
<p>假设我的邮箱地址是  <code>rime123@company.com</code>，则需要在输入 Rime 之后上屏或做临时中西文切换，方便可输入数字部分。</p>
<p>为了更方便输入我的用户名 <code>rime123</code>，设置一组特例，将 <code>rime</code> 与其后的数字优先识别西文。</p>
<p><a href="https://gist.github.com/3076166">https://gist.github.com/3076166</a></p>
<p><code>&gt; 自动识别西文及数字组成的用户名</code></p>
<pre tabindex="0"><code># default.custom.yaml
# 全局范围识别输入串为 rime + 任意数字序列，以及形如 rimeime-1.2.3 的常用西文短语
# 也可将本组 patch 写入 &lt;输入方案ID&gt;.custom.yaml 使这组规则仅在一款输入方案中有效
#
# 第一例，输入 rime 之后，再输入任意一个数字，则立即识别为西文输入
# 再加上 default.yaml 原有的 email 规则，识别包含 @ 字符的邮箱，於是可以一气呵成 rime123@company.com 
# 第二例，输入到 rimeime 时，立即识别为西文输入，并可跟随任意位数字及指定的符号

patch:
  recognizer/patterns/rime123: &#34;^rime[0-9]+$&#34;
  recognizer/patterns/rimeime: &#34;^rimeime[-_.0-9]*$&#34;
</code></pre><h4 id="以方括号键换页">以方括号键换页</h4>
<p><a href="https://gist.github.com/2316704">https://gist.github.com/2316704</a></p>
<p>在 Rime 中加入&quot;<code>[</code>&ldquo;和&rdquo;<code>]</code>&ldquo;翻页按键绑定（以【明月拼音】为例）</p>
<pre tabindex="0"><code># luna_pinyin.custom.yaml
# save it to: 
#   ~/.config/ibus/rime  (linux)
#   ~/Library/Rime  (macos)
#   %APPDATA%\Rime  (windows)

patch:
  &#34;key_binder/bindings&#34;:
    - { when: paging, accept: bracketleft, send: Page_Up }
    - { when: has_menu, accept: bracketright, send: Page_Down }
</code></pre><p>添加 Mac 风格的翻页键 <code>[ ]</code> 。这是比较直接的设定方式。下一则示例给出了麦种更系统、可重用的设定方式。</p>
<h4 id="使用西文标点兼以方括号键换页">使用西文标点兼以方括号键换页</h4>
<p><a href="https://gist.github.com/2334409">https://gist.github.com/2334409</a></p>
<p><code>&gt; Rime 别样设定，使用西文标点、[]键换页</code></p>
<pre tabindex="0"><code># Rime alternative settings
# encoding: utf-8
#
# difference from default settings:
# 1. ascii-style punctuation in half-shape mode
# 2. [ ] as paging keys
#
# save this file as:
# (Linux)   ~/.config/ibus/rime/alternative.yaml
# (Mac OS)  ~/Library/Rime/alternative.yaml
# (Windows) &#34;%APPDATA%\Rime\alternative.yaml&#34;
# 
# edit &lt;SCHEMA_ID&gt;.custom.yaml:
# &gt;&gt; patch:
# &gt;&gt;   &#39;punctuator/import_preset&#39;: alternative
# &gt;&gt;   &#39;key_binder/import_preset&#39;: alternative
#
# for detailed explanation, refer to:
# http://code.google.com/p/rimeime/wiki/CustomizationGuide#%E4%BD%BF%E7%94%A8%E5%85%A8%E5%A5%97%E8%A5%BF%E6%96%87%E6%A8%99%E9%BB%9E 

config_version: &#34;0.3&#34;

punctuator:
  full_shape:
    &#34; &#34; : { commit: &#34;　&#34; }
    &#34;,&#34; : { commit: ， }
    &#34;.&#34; : { commit: 。 }
    &#34;&lt;&#34; : [ 《, 〈, «, ‹ ]
    &#34;&gt;&#34; : [ 》, 〉, », › ]
    &#34;/&#34; : [ 、, ／, &#34;/&#34;, ÷ ]
    &#34;?&#34; : { commit: ？ }
    &#34;;&#34; : { commit: ； }
    &#34;:&#34; : ：
    &#34;&#39;&#34; : { pair: [ &#34;‘&#34;, &#34;’&#34; ] }
    &#34;\&#34;&#34; : { pair: [ &#34;“&#34;, &#34;”&#34; ] }
    &#34;\\&#34; : [ 、, ＼, &#34;\\&#34; ]
    &#34;|&#34; : [ ・, ｜, &#34;|&#34;, &#34;§&#34;, &#34;¦&#34; ]
    &#34;`&#34; : [ ｀, &#34;`&#34; ]
    &#34;~&#34; : [ 〜, &#34;~&#34;, ～, 〰 ]
    &#34;!&#34; : { commit: ！ }
    &#34;@&#34; : [ ＠, &#34;@&#34;, ☯ ]
    &#34;#&#34; : [ ＃, &#34;#&#34;, ⌘ ]
    &#34;%&#34; : [ ％, &#34;%&#34;, &#34;°&#34;, &#34;℃&#34; ]
    &#34;$&#34; : [ ￥, &#34;$&#34;, &#34;€&#34;, &#34;£&#34;, &#34;¥&#34;, &#34;¢&#34;, &#34;¤&#34; ]
    &#34;^&#34; : { commit: …… }
    &#34;&amp;&#34; : [ ＆, &#34;&amp;&#34; ]
    &#34;*&#34; : [ ＊, &#34;*&#34;, ・, ×, ※, ❂, · ]
    &#34;(&#34; : （
    &#34;)&#34; : ）
    &#34;-&#34; : [ －, &#34;-&#34; ]
    &#34;_&#34; : ——
    &#34;+&#34; : [ ＋, &#34;+&#34; ]
    &#34;=&#34; : [ ＝, &#34;=&#34; ]
    &#34;[&#34; : [ 「, 【, 〔, ［ ]
    &#34;]&#34; : [ 」, 】, 〕, ］ ]
    &#34;{&#34; : [ 『, 〖, ｛ ]
    &#34;}&#34; : [ 』, 〗, ｝ ]
  half_shape:
    &#34;,&#34; : { commit: &#34;,&#34; }
    &#34;.&#34; : { commit: &#34;.&#34; }
    &#34;&lt;&#34; : &#34;&lt;&#34;
    &#34;&gt;&#34; : &#34;&gt;&#34;
    &#34;/&#34; : &#34;/&#34;
    &#34;?&#34; : { commit: &#34;?&#34; }
    &#34;;&#34; : { commit: &#34;;&#34; }
    &#34;:&#34; : { commit: &#34;:&#34; }
    &#34;&#39;&#34; : &#34;&#39;&#34;
    &#34;\&#34;&#34; : &#34;\&#34;&#34;
    &#34;\\&#34; : &#34;\\&#34;
    &#34;|&#34; : &#34;|&#34;
    &#34;`&#34; : &#34;`&#34;
    &#34;~&#34; : &#34;~&#34;
    &#34;!&#34; : { commit: &#34;!&#34; }
    &#34;@&#34; : &#34;@&#34;
    &#34;#&#34; : &#34;#&#34;
    &#34;%&#34; : &#34;%&#34;
    &#34;$&#34; : &#34;$&#34;
    &#34;^&#34; : &#34;^&#34;
    &#34;&amp;&#34; : &#34;&amp;&#34;
    &#34;*&#34; : &#34;*&#34;
    &#34;(&#34; : &#34;(&#34;
    &#34;)&#34; : &#34;)&#34;
    &#34;-&#34; : &#34;-&#34;
    &#34;_&#34; : &#34;_&#34;
    &#34;+&#34; : &#34;+&#34;
    &#34;=&#34; : &#34;=&#34;
    &#34;[&#34; : &#34;[&#34;
    &#34;]&#34; : &#34;]&#34;
    &#34;{&#34; : &#34;{&#34;
    &#34;}&#34; : &#34;}&#34;

key_binder:
  bindings:
    # commonly used paging keys
    - { when: composing, accept: ISO_Left_Tab, send: Page_Up }
    - { when: composing, accept: Shift+Tab, send: Page_Up }
    - { when: composing, accept: Tab, send: Page_Down }
    - { when: has_menu, accept: minus, send: Page_Up }
    - { when: has_menu, accept: equal, send: Page_Down }
    - { when: paging, accept: comma, send: Page_Up }
    - { when: has_menu, accept: period, send: Page_Down }
    - { when: paging, accept: bracketleft, send: Page_Up }
    - { when: has_menu, accept: bracketright, send: Page_Down }
</code></pre><p>详见上文「使用全套西文标点」一节。</p>
<h4 id="以回车键清除编码兼以分号单引号选字">以回车键清除编码兼以分号、单引号选字</h4>
<p><a href="https://gist.github.com/2390510">https://gist.github.com/2390510</a></p>
<p><code>&gt; Rime 设定：以回车清除编码串，分号、单引号键选择 2、3 候选</code></p>
<pre tabindex="0"><code># cangjie5.custom.yaml
# save it to:
# ~/.config/ibus/rime (linux)
# ~/Library/Rime (macos)
# %APPDATA%\Rime (windows)

patch:
  &#34;key_binder/bindings&#34;:
    - { when: composing, accept: Return, send: Escape }
    - { when: has_menu, accept: semicolon, send: 2 }
    - { when: has_menu, accept: apostrophe, send: 3 }
</code></pre><p>适合一些形码输入法（如五笔、郑码）的快手。</p>
<h4 id="开关逐键提示">开关逐键提示</h4>
<p><code>table_translator</code> 默认开启逐键提示。若要只出精确匹配输入码的候选字，可关闭这一选项。</p>
<p>以【仓颉五代】为例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># cangjie5.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translator/enable_completion</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="关闭用戶词典和字频调整">关闭用戶词典和字频调整</h4>
<p>以【五笔 86】为例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># wubi86.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translator/enable_user_dict</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="关闭码表输入法连打">关闭码表输入法连打</h4>
<p>注：这个选项仅针对 <code>table_translator</code>，用于屏蔽仓颉、五笔中带有太级图章「☯」的连打词句选项，不可作用于拼音、注音、速成等输入方案。</p>
<p>以「 仓颉 」为例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># cangjie5.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translator/enable_sentence</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="开关仓颉与拼音混打">开关仓颉与拼音混打</h4>
<p>默认，给出仓颉与拼音候选的混合列表。</p>
<p>如此设定，直接敲字母只认作仓颉码，但仍可在敲 <code>~</code> 之后输入拼音：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># cangjie5.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">abc_segmentor/extra_tags</span>:<span style="color:#bbb"> </span>{}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="空码时按空格键清空输入码">空码时按空格键清空输入码</h4>
<p>首先需要关闭码表输入法连打（参见上文），这样才可以在打空时不出候选词。</p>
<p>然后设定（以五笔 86 为例）：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># wubi86.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translator/enable_sentence</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">key_binder/bindings</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- {<span style="color:#000080">when: has_menu, accept: space, send</span>:<span style="color:#bbb"> </span>space}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- {<span style="color:#000080">when: composing, accept: space, send</span>:<span style="color:#bbb"> </span>Escape}<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="模糊音">模糊音</h3>
<h4 id="朙月拼音模糊音定制模板">【朙月拼音】模糊音定制模板</h4>
<p><a href="https://gist.github.com/2320943">https://gist.github.com/2320943</a></p>
<p><code>&gt; 朙月拼音 模糊音定制模板</code></p>
<pre tabindex="0"><code># luna_pinyin.custom.yaml
#
# 【朙月拼音】模糊音定製模板
#   佛振配製 :-)
#
# 位置：
# ~/.config/ibus/rime  (Linux)
# ~/Library/Rime  (Mac OS)
# %APPDATA%\Rime  (Windows)
#
# 於重新部署后生效
#

patch:
  &#39;speller/algebra&#39;:
    - erase/^xx$/                      # 第一行保留

    # 模糊音定义
    # 需要哪组就删去行首的 # 号，单双向任选
    #- derive/^([zcs])h/$1/             # zh, ch, sh =&gt; z, c, s
    #- derive/^([zcs])([^h])/$1h$2/     # z, c, s =&gt; zh, ch, sh

    #- derive/^n/l/                     # n =&gt; l
    #- derive/^l/n/                     # l =&gt; n

    # 这两组一般是单向的
    #- derive/^r/l/                     # r =&gt; l

    #- derive/^ren/yin/                 # ren =&gt; yin, reng =&gt; ying
    #- derive/^r/y/                     # r =&gt; y

    # 下面 hu &lt;=&gt; f 这组写法复杂一些，分情况讨论
    #- derive/^hu$/fu/                  # hu =&gt; fu
    #- derive/^hong$/feng/              # hong =&gt; feng
    #- derive/^hu([in])$/fe$1/          # hui =&gt; fei, hun =&gt; fen
    #- derive/^hu([ao])/f$1/            # hua =&gt; fa, ...

    #- derive/^fu$/hu/                  # fu =&gt; hu
    #- derive/^feng$/hong/              # feng =&gt; hong
    #- derive/^fe([in])$/hu$1/          # fei =&gt; hui, fen =&gt; hun
    #- derive/^f([ao])/hu$1/            # fa =&gt; hua, ...

    # 韵母部份
    #- derive/^([bpmf])eng$/$1ong/      # meng = mong, ...
    #- derive/([ei])n$/$1ng/            # en =&gt; eng, in =&gt; ing
    #- derive/([ei])ng$/$1n/            # eng =&gt; en, ing =&gt; in

    # 样例足够了，其他请自己总结……

    # 反模糊音？
    # 谁说方言没有普通话精确、有模糊音，就能有反模糊音。
    # 示例为分尖团的中原官话：
    #- derive/^ji$/zii/   # 在设计者安排下鳩佔鹊巢，尖音i只好双写了
    #- derive/^qi$/cii/
    #- derive/^xi$/sii/
    #- derive/^ji/zi/
    #- derive/^qi/ci/
    #- derive/^xi/si/
    #- derive/^ju/zv/
    #- derive/^qu/cv/
    #- derive/^xu/sv/
    # 韵母部份，只能从大面上覆盖
    #- derive/^([bpm])o$/$1eh/          # bo =&gt; beh, ...
    #- derive/(^|[dtnlgkhzcs]h?)e$/$1eh/  # ge =&gt; geh, se =&gt; sheh, ...
    #- derive/^([gkh])uo$/$1ue/         # guo =&gt; gue, ...
    #- derive/^([gkh])e$/$1uo/          # he =&gt; huo, ...
    #- derive/([uv])e$/$1o/             # jue =&gt; juo, lve =&gt; lvo, ...
    #- derive/^fei$/fi/                 # fei =&gt; fi
    #- derive/^wei$/vi/                 # wei =&gt; vi
    #- derive/^([nl])ei$/$1ui/          # nei =&gt; nui, lei =&gt; lui
    #- derive/^([nlzcs])un$/$1vn/       # lun =&gt; lvn, zun =&gt; zvn, ... 
    #- derive/^([nlzcs])ong$/$1iong/    # long =&gt; liong, song =&gt; siong, ...
    # 这个办法虽从拼写上做出了区分，然而受词典制约，候选字仍是混的。
    # 只有真正的方音输入方案纔能做到！但「反模糊音」这个玩法快速而有效！

    # 模糊音定义先於简拼定义，方可令简拼支持以上模糊音
    - abbrev/^([a-z]).+$/$1/           # 简拼（首字母）
    - abbrev/^([zcs]h).+$/$1/          # 简拼（zh, ch, sh）

    # 以下是一组容错拼写，《汉语拼音》方案以前者为正
    - derive/^([nl])ve$/$1ue/          # nve = nue, lve = lue
    - derive/^([jqxy])u/$1v/           # ju = jv,
    - derive/un$/uen/                  # gun = guen,
    - derive/ui$/uei/                  # gui = guei,
    - derive/iu$/iou/                  # jiu = jiou,

    # 自动纠正一些常见的按键错误
    - derive/([aeiou])ng$/$1gn/        # dagn =&gt; dang 
    - derive/([dtngkhrzcs])o(u|ng)$/$1o/  # zho =&gt; zhong|zhou
    - derive/ong$/on/                  # zhonguo =&gt; zhong guo
    - derive/ao$/oa/                   # hoa =&gt; hao
    - derive/([iu])a(o|ng?)$/a$1$2/    # tain =&gt; tian

  # 分尖团后 v =&gt; ü 的改写条件也要相应地扩充：
  #&#39;translator/preedit_format&#39;:
  #  - &#34;xform/([nljqxyzcs])v/$1ü/&#34;
</code></pre><p>【明月拼音·简化字／臺灣正體／语句流】也適用， 只需将模板保存到 <code>luna_pinyin_simp.custom.yaml</code> 、 <code>luna_pinyin_tw.custom.yaml</code> 或 <code>luna_pinyin_fluency.custom.yaml</code> 。</p>
<p>对比模糊音定制模板与 <a href="https://github.com/rime/rime-luna-pinyin/blob/master/luna_pinyin.schema.yaml">【朙月拼音】方案原件</a>， 可见模板的做法是，在 <code>speller/algebra</code> 原有的规则中插入了一些定义模糊音的代码行。</p>
<p>类似方案如双拼、粤拼等可参考模板演示的方法改写 <code>speller/algebra</code> 。</p>
<h4 id="吳語模糊音定制模板">【吳語】模糊音定制模板</h4>
<p><a href="https://gist.github.com/2015335">https://gist.github.com/2015335</a></p>
<p><code>&gt; Rime 吴语输入方案模糊音定制档</code></p>
<pre tabindex="0"><code># 文件名： wugniu.custom.yaml
# 为 wugniu.schema.yaml 打补靪
# #号为註释符号，要是不需要开始某一行模糊功能请在该行前头加#号，要是需要该行模糊功能请去掉前面#号。注意要使用的行的对齐。
patch:
  &#34;speller/algebra&#34;:
    - abbrev/^([bcdfghjklprstvwxyz]).+$/$1/       # 对齐标準行
    - derive/^tzi/ci/                             # 以下四行是模糊分尖团音
    - derive/^tsi/chi/
    - derive/^zi/ji/
    - derive/^si/xi/
    - derive/^(ch|d?j|gn|x|y)i([aeou])/$1$2/      # 本行不要改动
    - derive/^tzyu/tzy/                           # 以下四行是模糊“书”“诗”
    - derive/^tsyu/tsy/
    - derive/^zyu/zy/
    - derive/^syu/sy/
    - derive/(.*)ij/$1i/                          # 模糊“烟”“衣”
    - derive/(.*)iaq/$1iq/                        # 模糊“约”“一”
    - derive/^yaq/yiq/                            # 模糊“药”“页”
    - derive/(.*)aon/$1an/                        # 模糊前后an
    - derive/(.*)aq/$1eq/                         # 模糊“搭”“得”
    - derive/(.*)eq/$1aq/
    - derive/^yeu/yu/                             # 模糊“远”“与”
    - derive/(.*)ieu/$1iu/                        # 模糊“宛”“餵”
    - derive/^vu/wu/                              # 模糊“无”“何”
    - derive/(.*)ueu/$1eu/                        # 模糊“碗”“按”
    - derive/^weu/reu/                            # 模糊“换”“汗”
    #- derive/^au/u/                               # 模糊“查”“坐”
</code></pre><h3 id="编码反查">编码反查</h3>
<h4 id="设定速成的反查码为粵拼">设定【速成】的反查码为粵拼</h4>
<p><a href="https://gist.github.com/2944320">https://gist.github.com/2944320</a></p>
<p><code>&gt; Rime 定制档：设定「 速成 」的反查码为粤拼</code></p>
<pre tabindex="0"><code># 将反查词典改为粤拼。
# 注意【速成】支持全码、简码混合输入，反查出来的实为仓頡全码。

patch:
  reverse_lookup/dictionary: jyutping
  reverse_lookup/tips: 〔粤拼〕
  reverse_lookup/preedit_format: []
</code></pre><h4 id="设定仓颉的反查码为双拼">设定【仓颉】的反查码为双拼</h4>
<p><a href="https://gist.github.com/2944319">https://gist.github.com/2944319</a></p>
<p><code>&gt; Rime 定制档：设定「 仓颉 」的反查码为双拼</code></p>
<pre tabindex="0"><code># 因为【双拼】使用的词典就是【朙月拼音】的词典，所以输入方案中原有的
# reverse_lookup/dictionary: luna_pinyin 保持不变，另外指定一项 prism

patch:
  reverse_lookup/prism: double_pinyin
  reverse_lookup/tips: 〔双拼〕
  reverse_lookup/preedit_format: []
</code></pre><h3 id="在-mac-系统上输入-emoji-表情">在 Mac 系统上输入 emoji 表情</h3>
<p>以下配置方法已过时，新的 emoji 用法见 <a href="https://github.com/rime/rime-emoji">https://github.com/rime/rime-emoji</a></p>
<h3 id="五笔简入繁出">五笔简入繁出</h3>
<p>【小狼毫】用家请到 <a href="https://github.com/rime/home/wiki/Downloads">下载页</a>取得「扩展方案集」。</p>
<p>安裝完成后，执行输入法设定，添加【五筆·簡入繁出】输入方案。</p>
<p>其他版本请参考这篇说明：</p>
<p><a href="https://gist.github.com/3467172">https://gist.github.com/3467172</a></p>
<p><code>&gt; README</code></p>
<pre tabindex="0"><code>一，安装简体-&gt;繁体映射码表：（该项目由opencc维护：http://code.google.com/p/opencc）
文件1：http://code.google.com/p/rimeime/source/browse/trunk/misc/opencc/data/simp_to_trad_characters.ocd
文件2:http://code.google.com/p/rimeime/source/browse/trunk/misc/opencc/data/simp_to_trad_phrases.ocd
安装位置：共享资料目录
如：/Library/Input Methods/Squirrel.app/Contents/SharedSupport/opencc

二，添加opencc简繁配置文件：
详见：zhs2zht.ini
安装位置：共享资料目录
如：/Library/Input Methods/Squirrel.app/Contents/SharedSupport/opencc

三，自定义五笔拼音输入法配置（同时可用於86版，本文仅提供五笔拼音配置文件）
详见：wubi_pinyin.custom.yaml
安装位置：用户资料目录
如：~/Library/Rime
</code></pre><p><code>&gt; wubi_pinyin.custom.yaml</code></p>
<pre tabindex="0"><code>patch:
  switches:
    - name: ascii_mode
      reset: 0
      states: [ 中文, 西文 ]
    - name: full_shape
      states: [ 半角, 全角 ]
    - name: simplification
      states: [ 漢字, 汉字 ]

  simplifier/opencc_config: zhs2zht.ini

  engine/filters:
    - simplifier
    - uniquifier
</code></pre><p><code>&gt; zhs2zht.ini</code></p>
<pre tabindex="0"><code>; Open Chinese Convert
;
; Copyright 2010 BYVoid &lt;byvoid.kcp@gmail.com&gt;
;
; Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;      http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.

title = simp_to_trad
description = Standard Configuration for Conversion from Simplified Chinese to Traditional Chinese
dict0 = OCD opencc/simp_to_trad_phrases.ocd
dict0 = OCD opencc/simp_to_trad_characters.ocd
</code></pre><h4 id="修正不对称繁简字">修正不对称繁简字</h4>
<p>繁→简即时转换比简体转繁体要轻松许多，却也免不了个别的错误。</p>
<p>比如这一例，「 乾 」字是一繁对多简的典型。由它组成的常用词组，opencc 做了了仔细分辨。但是遇到比较生僻的词组、专名，就比较头疼：</p>
<p><a href="http://tieba.baidu.com/p/1909252328">http://tieba.baidu.com/p/1909252328</a></p>
<h3 id="活用标点创建自定义词组">活用标点创建自定义词组</h3>
<p>在【朙月拼音】里添加一些自定义文字、符号。可以按照上文设定「 emoji 表情 」的方式为自定义词组创建一个专门的词典。</p>
<p>可是建立词典稍显繁琐，而活用自定义标点，不失为一个便捷的方法：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># luna_pinyin.custom.yaml</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># 如果不需要 `键的仓颉反查拼音功能，則可利用 ` 键输入自定义词组</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">recognizer/patterns/reverse_lookup</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#39;punctuator/half_shape/`&#39;</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#39;佛振 &lt;chen.sst@gmail.com&gt;&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#d14">&#39;http://rime.github.io&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- 上天赋予你高的智商，教你用到有用的地方。<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上例 <code>recognizer/patterns/reverse_lookup:</code> 作用是开关 <code>~</code> 键的反查功能。若选用其他符号则不需要这行。又一例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">&#39;punctuator/half_shape/*&#39;</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;*_*&#39;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>'punctuator/half_shape/*'</code> 因为字符串包含符号，最好用 <strong>单引号</strong> 括起來；尽量不用双引号以避免符号的转义问题。</p>
<p>然而，重定义「/」「+」「=」这些符号时，因其在节点路径中有特殊含义，无法用上面演示的路径连写方式。因此对于标点符号，推荐的定制方法为在输入方案里覆盖定义  <code>half_shape</code> 或 <code>full_shape</code> 节点：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">patch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">punctuator/half_shape</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#000080">&#39;/&#39;</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#d14">&#39;/&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;/hello&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;/bye&#39;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#39;/* TODO */&#39;</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#000080">&#39;+&#39;</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;+_+&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#000080">&#39;=&#39;</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;=_=&#39;</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lua-脚本开发指南">Lua 脚本开发指南</h2>
<p>librime-lua 是 Rime输入法引擎的一个插件，它为用户提供了使用 Lua 脚本语言扩展输入法的能力。通过 Lua ，你可以实现单纯使用配置文件难以做到的灵活多样的功能，比如输入任意动态短语（日期时间、大写数字、计算器……）、自由重排 / 过滤候选词、甚至云输入等。</p>
<p>要理解本项目的工作原理，需先了解 Rime 功能组件的基本概念与工作流程，见 <a href="https://rimeinn.github.io/rime/schema-design.html#%E8%AF%A6%E8%A7%A3%E8%BE%93%E5%85%A5%E6%96%B9%E6%A1%88">Rime 输入方案</a>。简而言之，librime-lua 提供了处理器 <code>processor</code> 、分段器 <code>segmentor</code> 、翻译器 <code>translator</code> 和过滤器 <code>filter</code> 这四类组件的开发接口。</p>
<p>本文通过一个例子来说明使用 librime-lua 开发组件的完整流程，然后在下一个章节中详细介绍各类组件的编程接口。</p>
<h3 id="例子输入今天的日期">例子：输入今天的日期</h3>
<p>我们通过「 输入今天的日期 」这个例子，来说明开发定制的流程。一共分三步：编写代码、配置方案、重新部署。</p>
<p>❶ 编写代码</p>
<p>我们希望在输入 “date” 之后，在输入法候选框中得到今天的日期。为此，我们需要一个能产生今天日期的翻译器。我们在 Rime 的用户目录下新建一个 <code>rime.lua</code> 文件，这是 Lua 脚本的总入口。在文件中添加以下内容：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- rime.lua</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">date_translator</span>(input, segment)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (input <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;date&#34;</span>) <span style="color:#000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">--- Candidate(type, start, end, text, comment)</span>
</span></span><span style="display:flex;"><span>        yield(Candidate(<span style="color:#d14">&#34;date&#34;</span>, segment.start, segment._end, os.date(<span style="color:#d14">&#34;%Y年%m月%d日&#34;</span>), <span style="color:#d14">&#34; 日期&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面实现了一个叫做 <code>date_translator</code> 的函数。它的输入是 <code>input</code> 和 <code>segment</code> ，分别传入了翻译器需要翻译的内容和它在输入串中的位置。这个函数会判断输入的是否是 <code>date</code> ，如果是，则生成一个内容为今天日期的候选项。</p>
<p>候选项的构造函数为 <code>Candidate</code> ，该函数有五个参数：</p>
<ul>
<li><strong>类型</strong> ，可以是任意字符串，这里用了 <code>'date'</code> ；</li>
<li><strong>开始、结束位置</strong>，一般用 <code>segment.start</code> 和 <code>segment._end</code> 就可以，它表示了我们要将整个待翻译的输入串替换为候选内容；</li>
<li><strong>候选内容</strong>，是使用 Lua 的函数库生成的日期；</li>
<li><strong>候选注释</strong>，是 <code>日期</code> ，这会显示在候选框中展示在候选内容旁边。</li>
</ul>
<p>候选项生成以后是通过 <code>yield</code> 发出的，<code>yield</code> 在这里可以简单理解为 <code>发送一个选项到候选框中</code> 。一个函数可以 <code>yield</code> 任意次，这里我们只有一个候选项，所以只有一个 <code>yield</code> 。</p>
<p>❷ 配置方案</p>
<p>我们已经编写了输入日期的翻译器。为了让它生效，需要修改输入方案的配置文件。以朙月拼音为例，找到 <code>luna_pinyin.schema.yaml</code>，在 <code>engine/translators</code> 中加入一项 <code>lua_translator@date_translator</code> ，如下：</p>
<pre tabindex="0"><code># luna_pinyin.schema.yaml
engine:
  ...
  translators:
    - lua_translator@date_translator
    ...
</code></pre><p>这样就完成了配置。它表示从 lua 执行环境中找到名为 <code>date_translator</code> 的对象，将它作为一种翻译器添加到引擎之中。其他类型的组件配置类推，分别为 <code>lua_processor</code>、<code>lua_segmentor</code>、<code>lua_filter</code> 。</p>
<p>❸ 重新部署</p>
<p>以上完成了所有开发和配置。点击 「 重新部署 」 ，输入 <code>date</code> ，就可以看到候选框中出现了今天的日期。</p>
<p>在 <a href="https://github.com/hchunhui/librime-lua/tree/master/sample">本项目的示例目录 </a> 下，还有更多的例子。配合其中的注释并稍加修改，就可以满足大部分的日常需求。</p>
<h3 id="模块化">模块化</h3>
<p>到目前为止，我们的代码完全集中在 <code>rime.lua</code> 中，本节说明 librime-lua 对模块化的支持。</p>
<p>模块化是指把脚本分门别类，放到独立的文件中，避免各自的修改互相干扰，也方便把自己的作品分享给他人使用。</p>
<p>我们仍以 <code>date_translator</code> 为例。</p>
<p>❶ 分离脚本内容</p>
<p>首先需要把原来写在 <code>rime.lua</code> 的脚本搬运到独立的文件中。删掉 <code>rime.lua</code> 原有的内容后，在 Rime 的用户目录下新建一个 <code>lua</code> 目录，在该目录下再建立一个 <code>date_translator.lua</code> 文件，录入以下内容：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- lua/date_translator.lua</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">translator</span>(input, seg)
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">if</span> (input <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;date&#34;</span>) <span style="color:#000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">--- Candidate(type, start, end, text, comment)</span>
</span></span><span style="display:flex;"><span>      yield(Candidate(<span style="color:#d14">&#34;date&#34;</span>, seg.start, seg._end, os.date(<span style="color:#d14">&#34;%Y年%m月%d日&#34;</span>), <span style="color:#d14">&#34; 日期&#34;</span>))
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> translator
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到主要内容与之前一致，但有两点不同：</p>
<p>¹ <strong>使用 <code>local</code></strong> 。lua 脚本的变量作用域默认是全局的，如果不同模块的变量或函数正好用了相同的名字，就会导致互相干扰，出现难以排查的问题。因此，尽量使用 <code>local</code> 把变量作用域限制在局部。</p>
<p>² <strong>新增 <code>return</code></strong> 。 librime-lua 是借助 lua 的 require 机制实现模块加载。引用模块时，整个文件被当作一个函数执行，返回模块内容。在被里返回的是一个翻译器组件。</p>
<p>❷ 配置方案直接引用模块</p>
<p>我们已经建立了一个名叫 <code>date_translator</code> 的模块。我们可以在输入方案配置文件中写入以下内容来直接引用被个模块所返回的组件，而不是从全局的 <code>rime.lua</code> 中的获取组件：</p>
<pre tabindex="0"><code># luna_pinyin.schema.yaml
engine:
  ...
  translators:
    - lua_translator@*date_translator
  ...
</code></pre><p>与之前的区别是第一个 <code>@</code> 之后多了一个 <code>*</code> 。👻 它表示什么？</p>
<p>这个星号 <code>*</code> 表示后面的名字是模块名而还是全局变量名。当遇到星号时，librime-lua 会使用 require 机制加载模块，然后将其返回值作为 Rime 组件加载到输入法框架中。</p>
<p>❸ 更多引用方式</p>
<p>首先，你可以对同一个 Lua 组件加载多个实例，此时需要用 <code>@namespace</code> 的语法标注出命名空间以区分不同的实例：</p>
<pre tabindex="0"><code>engine:
  translators: 
    - lua_translator@*date_translator      # name_space &#34;date_translator&#34;
    - lua_translator@*date_translator@date # namespace &#34;date&#34;
</code></pre><p>其次，你还可以引用位于 <code>lua/</code> 文件夹下的子文件夹中的模块，此时路径的分隔符可以用 <code>.</code> ，也可以用 <code>/</code> ，例如：</p>
<pre tabindex="0"><code>engine:
  translators:
    - lua_translator@*date.translator        # lua/date/translator.lua
    - lua_translator@*date/translator        # lua/date/translator.lua
    - lua_translator@*date/subdir/translator # lua/date/subdir/translator.lua
</code></pre><p>最后，若一个文件通过 Lua 表的方式导出了多个组件，使用 <code>*</code> 还可以在表中进一步搜索，例如：</p>
<pre tabindex="0"><code>engine:
  translators:
    - lua_translator@*module_name*subtable1*subtable2*tran@name_space
  processors:
    - lua_translator@*module_name*subtable1*subtable2*proc@name_space
</code></pre><p>对应了以下的用表组织起来的多个组件：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- lua/module_name.lua</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> {
</span></span><span style="display:flex;"><span>  subtable1 <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>     subtable2 <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>        tran <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (input, segment, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>        proc <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (key, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>        filter <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (translation, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>     },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  subtable2 <span style="color:#000;font-weight:bold">=</span> { ... },                            
</span></span><span style="display:flex;"><span>  subtable3 <span style="color:#000;font-weight:bold">=</span> { ... },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>❹ 旧版 librime-lua 的使用方式</p>
<p>如果使用的是较旧的 librime-lua ，则配置文件不能直接载入在子目录中的 Lua 模块。在将模块分离出去之后，仍然需要在 <code>rime.lua</code> 内输入以下内容：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>date_translator <span style="color:#000;font-weight:bold">=</span> require(<span style="color:#d14">&#34;date_translator&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>前一个 <code>date_translator</code> 是全局变量名，后一个是模块名。librime-lua 将 Rime 的用户目录和 Rime 共享目录下的 <code>lua</code> 目录加入了模块搜索路径，因此本句的意义是搜索 <code>date_translator</code> 模块，并将返回的组件绑定到同名的全局变量上。被样就可以输入方案配置文件中使用了，方法与之前一致。</p>
<p>❺ 配方补丁</p>
<p>以上我们实现了 lua 脚本的模块化。但为引用组件，仍需修改 <code>schema.yaml</code> 配置文件。那么如何模块化都修改配置文件呢？</p>
<p>请参考 <a href="https://rimeinn.github.io/rime/configuration.html">Rime 配置文件</a> 中关于补丁的讲解。</p>
<h3 id="编程接口">编程接口</h3>
<p>本节详细介绍编程接口。根据我们此前讲过的约定，以下假定所编写的 Lua 组件位于 <code>lua/my_rime</code> 子文件夹下，即为 <code>lua/my_ime/xxx.lua</code>，且导入时不指定相关的命名空间。你也可以使用上面介绍过的命空间、子文件夹以及 Lua 表等方式来更灵活都组织你的脚本。</p>
<p>❶ Lua 处理器 <code>lua_processor</code></p>
<p><code>lua_processor</code> 提供了处理器的开发接口，它在配置文件的 <code>engine/processors</code> 中配置：</p>
<pre tabindex="0"><code>engine:
  processors:
    - lua_processor@*my_ime.my_processor
</code></pre><p><code>my_processor</code> 所指对象有多种形式：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_processor</span>(key_event)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_processor</span>(key_event, env)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 完整形式</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> my_processor <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>  init <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>  func <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(key_event, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>  fini <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span>(env) ... <span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>简化形式是一个 Lua 函数，此函数执行处理器的逻辑，参数为：</p>
<ul>
<li><code>key_event</code> ： <a href="https://github.com/hchunhui/librime-lua/wiki/objects#keyevent"><code>KeyEvent</code> 对象</a>，为待处理的按键（包括带修饰符的组合键）；</li>
<li><code>env</code>：<code>Env</code> 对象，包括 <code>engine</code> 和 <code>name_space</code> 两个成员，分别是  <a href="https://github.com/hchunhui/librime-lua/wiki/objects#engine"><code>Engine</code> 对象</a>和前述 <code>name_space</code> 配置字符串。</li>
</ul>
<p>返回值为 <code>0、1、2</code> ：</p>
<p>¹ <code>0</code> 表示 <code>kRejected</code>，声称本组件和其他组件都不响应该输入事件，结束处理流程，交还操作系统按默认方式响应（例如 ASCII 字符上屏、方向翻页等功能作用于客户程序或系统全局等）。</p>
<p>注意：如果组件已响应该输入事件但返回 <code>kRejected</code> ，则按键会再被操作系统处理一次，有可能产生 「 处理了两次 」的效果。</p>
<p>² <code>1</code> 表示 <code>KAccepted</code>，声称本组件已响应该输入事件，结束处理流程，之后的组件以及操作系统都不再响应应该输入事件。</p>
<p>注意：如何组件未响应该输入事件但返回 <code>KAccepted</code>，相当于禁用这个按键。</p>
<p>³ <code>2</code> 表示 <code>KNoop</code>，声称本函数不响应该输入事件，交给接下来的处理器决定。</p>
<p>注意：如果组件已响应该输入事件但返回 <code>KNoop</code>，则按键会被接下来的组件处理一次或多次，有可能产生 「 处理了多次 」的效果。如果所有处理器都返回 <code>KNoop</code>，则交还由操作系统按默认方式响应。</p>
<p>完整形式是一个 Lua 表，其中 <code>func</code> 与简化形式意义相同。<code>init</code> 与 <code>fini</code> 分别在组件构造与析构时调用。</p>
<p>❷ Lua 分段器 <code>lua_segmentor</code></p>
<p><code>lua_segmentor</code> 提供了分段器的开发接口，它在配置文件的 <code>engine/segmentor</code> 中配置：</p>
<pre tabindex="0"><code>engine:
  segmentors:
    - lua_segmentor@*my_ime.my_segmentor
</code></pre><p><code>my_segmentor</code> 所指对象有多种形式：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_segmentor</span>(segmentation)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_segmentor</span>(segmentation, env)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 完整形式</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> my_segmentor <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>  init <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>  func <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (segmentation, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>  fini <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (env) ... <span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>简化形式是一个 Lua 函数，此函数执行分段器的逻辑，参数为：</p>
<ul>
<li><code>segmentation</code>： <a href="https://github.com/hchunhui/librime-lua/wiki/objects#segmentation"><code>Segmentation</code> 对象</a>；</li>
<li><code>env</code>：<code>Env</code> 对象，含义同前。</li>
</ul>
<p>而返回值为布尔类型：</p>
<ul>
<li><code>true</code>: 交由下一个分段器处理；</li>
<li><code>false</code>: 终止分段器处理流程。</li>
</ul>
<p>而完整形式是一个 Lua 表，其中 <code>func</code> 与简化形式意义相同。<code>init</code> 与 <code>fini</code> 分别在组件构造与析构时调用。</p>
<p>❸ Lua 翻译器 <code>lua_translator</code></p>
<p><code>lua_translator</code> 提供了翻译器的开发接口。它在配置文件的 <code>engine/translator</code> 中配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">translators</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- lua_translator@*my_ime.my_translator<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>my_translator</code> 所指对象有多种形式：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_translator</span>(input, segment)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_translator</span>(input, segment, env)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 完整形式</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> my_translator <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>  init <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>  func <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (input, segment, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>  fini <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (env) ... <span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>简化形式是一个 Lua 函数，此函数执行翻译器的逻辑，参数为：</p>
<ul>
<li><code>input</code>：<code>string</code> 类型的字符串，为待翻译串；</li>
<li><code>segment</code>： <a href="https://github.com/hchunhui/librime-lua/wiki/objects#segment"><code>Segment</code> 对象</a>；</li>
<li><code>env</code>：<code>Env</code> 对象，含义同前。</li>
</ul>
<p>函数无返回值，而是通过 <code>yield</code> 发送 <a href="https://github.com/hchunhui/librime-lua/wiki/objects#candidate-%E5%80%99%E9%80%89%E8%AF%8D"><code>Candidate</code> 对象</a>或其他的候选对象。</p>
<p>而完整形式是一个 Lua 表，其中 <code>func</code> 与简化形式意义相同。<code>init</code> 与 <code>fini</code> 分别在 <code>lua_translator</code> 构造与析构时调用。</p>
<p>❹ Lua 过滤器 <code>lua_filter</code></p>
<p><code>lua_filter</code> 提供了过滤器的开发接口。它在配置文件的 <code>engine/filters</code> 中配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">engine</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- lua_filter@*my_ime.my_filter<span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>my_filter</code> 所指对象有多种形式：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_filter</span>(translation)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 简化形式 2</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> <span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">my_filter</span>(translation, env)
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--- 完整形式</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">local</span> my_filter <span style="color:#000;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>   init <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>   func <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (translation, env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>   fini <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (env) ... <span style="color:#000;font-weight:bold">end</span>,
</span></span><span style="display:flex;"><span>   tags_match <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">function</span> (segment, env) ... <span style="color:#000;font-weight:bold">end</span>  <span style="color:#998;font-style:italic">--- 可选</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>简化形式是一个 Lua function，此函数执行过滤器的逻辑，参数为</p>
<ul>
<li><code>translation</code>： <a href="https://github.com/hchunhui/librime-lua/wiki/objects"><code>Translation</code> 对象</a>，为待过滤的 <code>Candidate</code> 流；</li>
<li><code>env</code>：<code>Env</code> 对象，含义同前。</li>
</ul>
<p>函数无返回值，而是通过 <code>yield</code> 发送 <code>Candidate</code> 对象或其他的候选对象。</p>
<p>而完整形式是一个 Lua 表，其中 <code>func</code> 与简化形式意义相同。<code>init</code> 与 <code>fini</code> 分别在 <code>lua_filter</code> 构造与析构时调用。另外，<code>tags_match</code> 出现时可以指定该过滤器只在某种特定情况下工作，通常是使用 <code>segment</code> 所包含的 <code>tag</code> 来判断。</p>
<h3 id="对象接口">对象接口</h3>
<blockquote>
<p>librime-lua 封装了 librime C++ 对象到 lua 中供脚本访问。需注意随着项目的开发，以下文档可能是不完整或过时的，敬请各位参与贡献文档。</p>
</blockquote>
<p>这个章节请直接参考 <a href="https://github.com/hchunhui/librime-lua/wiki/Objects">原链接 🔗</a> 。</p>
<h2 id="附录">附录</h2>
<h3 id="candget_genuinetext--t_cand-为什么没有修改候选项的内容"><code>cand:get_genuine().text = 't_cand'</code> 为什么没有修改候选项的内容</h3>
<p>在 Lua 的 Rime API 中，直接修改候选项（<code>Candidate</code> 对象）的 <code>text</code> 属性通常无效，因为 <strong><code>Candidate</code> 对象是只读的</strong>。你需要通过创建一个新的 <code>Candidate</code> 对象来替换现有的候选项，而不是试图直接修改它。</p>
<p>❶ 原因</p>
<ul>
<li><strong><code>cand:get_genuine()</code></strong> 返回的是原始候选项（<code>cand</code>），但 Rime 的候选项属性（如 <code>text</code> 和 <code>comment</code>）是不可变的，不能直接修改。</li>
<li>想要更改候选项的内容，你需要创建一个新的候选项，并在必要时将其插入到 <code>segment</code> 中。</li>
</ul>
<p>❷ 解决方法</p>
<ol>
<li>
<p><strong>创建新的候选项</strong> 使用 <code>Candidate</code> 构造函数创建一个新的候选项，并用新的 <code>text</code> 替换现有候选项。</p>
</li>
<li>
<p><strong>示例代码</strong> 假设你想在 <code>filter</code> 函数中修改候选项内容：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">function</span> <span style="color:#900;font-weight:bold">filter</span>(input, env)
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> cand <span style="color:#000;font-weight:bold">in</span> input:iter() <span style="color:#000;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">-- 创建新的候选项，修改内容</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">local</span> new_cand <span style="color:#000;font-weight:bold">=</span> Candidate(cand.type, cand.start, cand._end, <span style="color:#d14">&#34;t_cand&#34;</span>, cand.comment)
</span></span><span style="display:flex;"><span>        yield(new_cand) <span style="color:#998;font-style:italic">-- 使用 yield 替换原始候选项</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><strong><code>Candidate</code> 构造函数</strong>：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>Candidate(type, start, <span style="color:#000;font-weight:bold">end</span>, text, comment)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>type</code>: 候选项类型，例如 <code>&quot;completion&quot;</code>。</li>
<li><code>start</code> 和 <code>end</code>: 候选项在输入字符串中的范围。</li>
<li><code>text</code>: 候选项的实际显示文本。</li>
<li><code>comment</code>: 候选项的附加注释（可选）。</li>
</ul>
<p><strong>处理 <code>cand:get_genuine()</code></strong> 如果需要从原始候选项提取某些属性，可以使用 <code>cand:get_genuine()</code> 提取真正的候选项，然后基于这些信息创建新的候选项。</p>
<p>❸ 注意事项</p>
<ul>
<li><strong>顺序问题</strong>：确保修改后的候选项按需要的顺序插入到候选列表中。</li>
<li><strong>性能考虑</strong>：在大规模处理候选项时，尽量优化逻辑，避免不必要的重复操作。</li>
<li><strong>调试日志</strong>：在修改候选项时，添加调试日志可以帮助确认候选项是否正确被替换。例如：</li>
</ul>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>print(<span style="color:#d14">&#34;Original:&#34;</span>, cand.text, <span style="color:#d14">&#34;-&gt; Modified:&#34;</span>, new_cand.text)
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过上述方式，你可以正确修改 Rime 的候选项内容。</p>
<h3 id="五笔码表开头的那些属性是什么意思">五笔码表开头的那些属性是什么意思</h3>
<pre tabindex="0"><code>---
name: wubi86                      # 码表名称
version: &#34;0.7&#34;                    # 版本号
sort: by_weight                   # 词条按权重排序
columns:                          # 定义了数据表中每一列的含义
  - text                          # ... 字词
  - code                          # ... 对应的五笔编码
  - weight                        # ... 词条权重（用于排序和优先级）
  - stem                          # ... 词干编码（可能是词组的简化编码）
encoder:                          # 定义编码生成的规则和排除模式
  exclude_patterns:               # ... 排除某些编码模式              
    - &#39;^z.*$&#39;                     # ... 排除所有以字母 `z` 开头的编码
  rules:                          # 定义了不同长度词组的〔编码生成规则〕
    - length_equal: 2             # ... 长度为 2 的词组使用公式 `AaAbBaBb` 生成编码
      formula: &#34;AaAbBaBb&#34;
    - length_equal: 3             # ... 长度为 3 的词组使用公式 `AaBaCaCb` 生成编码
      formula: &#34;AaBaCaCb&#34;
    - length_in_range: [4, 10]    # ... 长度为 3 的词组使用公式 `AaBaCaZa` 生成编码
      formula: &#34;AaBaCaZa&#34;
</code></pre><p>上述 YAML 配置文件定义了一个 <strong>五笔 86 输入法</strong> 的架构。</p>
<p><strong>公式说明</strong></p>
<p>公式中的字母代表编码的生成规则：</p>
<ul>
<li><code>A</code>、<code>B</code>、<code>C</code> 等表示从词组的第 1、2、3 个字中提取编码。</li>
<li><code>a</code>、<code>b</code>、<code>c</code> 等表示提取编码的特定部分（如首字母或特定位置的字母）。</li>
<li><code>Z</code> 可能表示从整个词组中提取编码。</li>
</ul>
<p>例如：</p>
<ul>
<li><code>AaAbBaBb</code> 表示：
<ul>
<li>从第 1 个字提取编码的第 1 部分（<code>A</code>）和第 2 部分（<code>a</code>）。</li>
<li>从第 2 个字提取编码的第 1 部分（<code>B</code>）和第 2 部分（<code>b</code>）。</li>
</ul>
</li>
</ul>
<p>这个配置文件定义了一个五笔 86 输入法的编码规则和数据结构，支持不同长度的词组编码生成，并通过权重排序优化用户体验。排除模式和编码公式的设计使得输入法更加灵活和高效。</p>
    </div>

    

    <div class="container-comment-giscus">
        <script src="https://giscus.app/client.js"
        data-repo="loveminimal/comment"
        data-repo-id="R_kgDOJNJQ8g"
        data-category="General"
        data-category-id="DIC_kwDOJNJQ8s4CYl0m"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="noborder_light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
        </script>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=">
            

        </a>

        
        <a href="/about" target="_blank">
            
            将喜欢的一切留在身边，这便是努力的意义
            
        </a>
    </div>

    
    <div class="info">
        
        <a href="https://github.com/loveminimal/hugo-theme-virgo">🕊️</a> 2016 - <span id="info-date"></span>
    </div>

</div></div>
        <div class="cool-after" style="
            
                background-color: rgba(255, 255, 255, 0.69); 
                backdrop-filter: saturate(180%) blur(6px);
            
            "></div>
    </body>
</html>
